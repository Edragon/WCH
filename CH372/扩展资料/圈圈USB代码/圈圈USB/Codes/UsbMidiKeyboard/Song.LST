C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE SONG
OBJECT MODULE PLACED IN Song.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE Song.c BROWSE DEBUG OBJECTEXTEND TABS(1)

stmt level    source

   1          /******************************************************************
   2             本程序只供学习使用，未经作者许可，不得用于其它任何用途
   3             
   4                  欢迎访问我的USB专区：http://group.ednchina.com/93/
   5                  欢迎访问我的blog：   http://www.ednchina.com/blog/computer00
   6                                       http://computer00.21ic.org
   7          
   8                  感谢PCB赞助商――电子园： http://bbs.cepark.com/
   9          
  10          song.c file
  11          
  12          作者：电脑圈圈
  13          建立日期: 2008.08.12
  14          修改日期: 2008.08.13
  15          版本：V1.1
  16          版权所有，盗版必究。
  17          Copyright(C) 电脑圈圈 2008-2018
  18          All rights reserved            
  19          *******************************************************************/
  20          
  21          #include "MyType.h"
  22          #include "PDIUSBD12.H"
  23          #include "Key.h"
  24          #include "config.h"
  25          
  26          void DelayXms(uint16 x);
  27          
  28          //  5    6    7    1    2    3    4    5    6     7     1
  29          // 55   57    59   60   62  64    65   67   69    71    72
  30          
  31          //C  48 55 60 64
  32          //Em 40 55 59 64
  33          //Am 45 57 60 64
  34          //D  50 57 62 66
  35          //Dm 50 57 62 65
  36          //F  41 57 60 65
  37          //G  43 55 59 67
  38          
  39          //《容易受伤的女人》，4/4拍，78拍每分，每个4分音符时值约为769ms，实际取768ms。
  40          // 可以分解为32*24。
  41          //结构说明：
  42          //第一行为歌曲的总长度（行数）
  43          //接下来的每一行第一个元素表示本行内有多少个音符，如果是两个数字相加的，则前一个
  44          //表示该行中通道0（旋律乐器）的音符个数，后一个表示通道9（打击乐）的音符个数
  45          //后面每两个分别为音高和力度，一行有多少个音符，就重复多少个音高和力度。当遇到
  46          //一个0xFF时，表示通道切换（仅有一个通道0和一个通道9）。
  47          //每行最后一个表示该行演奏完后，停顿多久才演奏下一行。
  48          #define BT1 32,24
  49          
  50          #ifndef DEBUG0
  51          
  52          code uint8 SongTable[]=
  53          {
  54           373/256, 373%256,
  55          
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 2   

  56          //引子
  57           1, 83,70, BT1/2, //7
  58           2, 83,0, 84,90, BT1/2, //1
  59           2, 84,0, 86,90, BT1/2, //2
  60           2, 86,0, 91,90, BT1/2, //5
  61           2, 91,0, 89,90, BT1/2, //4
  62           2, 89,0, 81,90, BT1/2, //6
  63           2, 81,0, 79,90, BT1/2, //5
  64           2, 79,0, 88,90, BT1/2, //3 
  65          
  66           2, 88,0, 86,90, BT1/2, //2
  67           2, 86,0, 79,90, BT1/2, //5
  68           2, 79,0, 77,90, BT1/2, //4
  69           2, 77,0, 84,90, BT1/2, //1
  70           2, 84,0, 83,90, BT1/2, //7
  71           2, 83,0, 76,90, BT1/2, //3
  72           2, 76,0, 79,90, BT1/2, //5
  73           2, 79,0, 86,90, BT1/2, //2
  74           
  75           3, 0xFF, 58,120, 0xFF, 86,0, 91,90, BT1*4, //5
  76          
  77          //第一小节
  78          //C和弦
  79           2, 91,0, 48,70,BT1/2,
  80           1, 55,70,BT1/2,
  81           2, 55,0, 60,70,BT1/2,
  82           2, 60,0, 64,70,BT1/2,
  83          //C和弦 
  84           1, 64,70,BT1/2,
  85           1, 55,70,BT1/2,
  86           4, 48,0, 55,0,  60,70, 55,100,BT1/2,   //5
  87           4, 60,0, 55,0,  64,70, 57,100,BT1/2,  //6
  88          
  89          //第二小节
  90          //C和弦
  91           4, 64,0, 57,0, 48,101, 60,100,BT1/2,  //1
  92           3, 60,0, 55,70,  60,100,BT1/2,  //1
  93           4, 55,0, 60,0,   60,70,  60,100,BT1/2,   //1
  94           5, 48,0, 60,0,   60,0, 64,70, 62,100,BT1/4, //2
  95           2, 62,0, 64,100,BT1/4,    //3
  96          //Em和弦
  97           1+1, 0xFF, 74,90, 0xFF, 40,101,BT1/2,   //
  98           1+1, 0xFF, 64,90, 0xFF, 55,70,BT1/2,
  99           2+1, 0xFF, 63,90, 0xFF, 55,0, 59,70,BT1/2,  //0
 100           4+1, 0xFF, 64,90, 0xFF, 40,0, 59,0, 64,70,  64,100,BT1/4, //3
 101           1, 67,100,BT1/4,   //5   
 102          
 103          //第三小节
 104          //Am和弦
 105           4, 64,0, 67,0,  45,101, 69,100, BT1/2,  //6
 106           2, 57,70, 69,100,BT1/2,    //6
 107           4, 57,0, 69,0, 60,70, 71,100,BT1/3, //7
 108           2, 71,0, 69,100,BT1/6, //6
 109           3, 45,0, 60,0, 64,70,BT1/6,
 110           2, 69,0, 67,100,BT1/3,//5
 111          //Em和弦 
 112           4+1, 0xFF, 74,90, 0xFF, 64,0, 67,0, 40,101, 64,100,BT1/2,  //3
 113           1, 55,70,BT1/2,
 114           3, 55,0, 64,0, 59,70,BT1/2, //0
 115           4, 40,0, 59,0, 64,70, 64,100,BT1/2, //3
 116           
 117          //第四小节
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 3   

 118          //Dm和弦
 119           3, 64,0,  50,101, 62,100, BT1/2,  //2
 120           1, 57,70,BT1/2,
 121           4, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 122           1, 60,100,BT1/4,  //1
 123           5, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
 124           2, 57,0, 55,100,BT1/4,  //5
 125          //Am和弦
 126           4+1, 0xFF, 74,90, 0xFF, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 127           1+1, 0xFF, 64,90, 0xFF, 57,70,BT1/2,
 128           2+1, 0xFF, 63,90, 0xFF, 57,0, 60,70,BT1/2,
 129           3+1, 0xFF, 64,90, 0xFF, 45,0, 60,0, 64,70,BT1/4,  //0
 130           1, 55,100,BT1/4,     //5
 131           
 132          //第五小节
 133          //F和弦
 134           4, 64,0, 55,0, 41,101, 60,100, BT1/2,  //1
 135           1, 57,70, BT1/2,
 136           3, 57,0, 60,70,  60,100,BT1/2,  //1
 137           4, 41,0, 60,0, 64,70, 60,100,BT1/2,  //1
 138          //G和弦
 139           4+1, 0xFF, 74,90, 0xFF, 64,0, 60,0, 43,101, 62,100,BT1/2,  //2
 140           1, 55,70,BT1/2,
 141           2, 55,0, 59,70,BT1/2,  //0
 142           4, 59,0, 43,0, 67,70, 55,100,BT1/4, //5
 143           2, 55,0, 57,100,BT1/4,  //6
 144          
 145          //第六小节
 146          //C和弦
 147           4, 67,0, 57,0, 48,101, 60,100,BT1/2,  //1
 148           3, 60,0, 55,70,  60,100,BT1/2,  //1
 149           4, 55,0, 60,0,   60,70,  60,100,BT1/2,   //1
 150           5, 48,0, 60,0,   60,0, 64,70, 62,100,BT1/4, //2
 151           2, 62,0, 64,100,BT1/4,    //3
 152          //Em和弦
 153           1+1, 0xFF, 74,90, 0xFF, 40,101,BT1/2,   //
 154           1+1, 0xFF, 64,90, 0xFF, 55,70,BT1/2,
 155           2+1, 0xFF, 63,90, 0xFF, 55,0, 59,70,BT1/2,  //0
 156           4+1, 0xFF, 64,90, 0xFF, 40,0, 59,0, 64,70,  64,100,BT1/4, //3
 157           1, 67,100,BT1/4,   //5   
 158          
 159          //第七小节
 160          //Am和弦
 161           4, 64,0, 67,0,  45,101, 69,100, BT1/2,  //6
 162           2, 57,70, 69,100,BT1/2,    //6
 163           4, 57,0, 69,0, 60,70, 71,100,BT1/3, //7
 164           2, 71,0, 69,100,BT1/6, //6
 165           3, 45,0, 60,0, 64,70,BT1/6,
 166           2, 69,0, 67,100,BT1/3,//5
 167          //Em和弦 
 168           4+1, 0xFF, 74,90, 0xFF, 64,0, 67,0, 40,101, 64,100,BT1/2,  //3
 169           1, 55,70,BT1/2,
 170           3, 55,0, 64,0, 59,70,BT1/2, //0
 171           4, 40,0, 59,0, 64,70, 64,100,BT1/2, //3
 172           
 173          //第八小节
 174          //Dm和弦
 175           3, 64,0,  50,101, 62,100, BT1/2,  //2
 176           1, 57,70,BT1/2,
 177           4, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 178           1, 60,100,BT1/4,  //1
 179           5, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 4   

 180           2, 57,0, 55,100,BT1/4,  //5
 181          //Am和弦
 182           4+1, 0xFF, 74,90, 0xFF, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 183           1+1, 0xFF, 64,90, 0xFF, 57,70,BT1/2,
 184           2+1, 0xFF, 63,90, 0xFF, 57,0, 60,70,BT1/2,
 185           3+1, 0xFF, 64,90, 0xFF, 45,0, 60,100, 64,70,BT1/2,  //1
 186          
 187          //第九小节
 188          //Em和弦
 189           4, 60,0, 64,0, 40,101, 59,100,BT1/2,  //7
 190           1, 55,70,BT1/2,  
 191           4, 55,0, 59,0, 59,70, 57,100, BT1/2,  //6
 192           5, 40,0, 59,0, 57,0, 64,70, 55,100, BT1/2,  //5
 193          //Am和弦
 194           4+1, 0xFF, 74,90, 0xFF, 64,0, 55,0, 45,101, 57,100, BT1/2, //6
 195           1+1, 0xFF, 64,90, 0xFF, 57,70,BT1/2,
 196           3+1, 0xFF, 63,90, 0xFF, 57,0, 60,70, 60,100,BT1/2,  //1
 197           4+1, 0xFF, 64,90, 0xFF, 60,0, 45,0,  64,70, 62,100,BT1/2,  //2
 198          
 199          //第十小节
 200          //C和弦
 201           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 48,101, 64,100, BT1/2,  //3
 202           3+1, 0xFF, 75,90, 0xFF, 64,0, 55,70, 67,100,BT1/2,   //5
 203           4+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/4,  //3
 204           2, 64,0, 62,100,BT1/4, //2
 205           5, 48,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 206           2, 60,0, 62,100,BT1/4,  //2
 207          //Am和弦
 208           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 45,101, 64,100, BT1/2,  //3
 209           3+1, 0xFF, 35,90, 0xFF, 64,0, 57,70, 69,100,BT1/2,  //6
 210           4+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 69,0, 60,70, 64,100,BT1/4,  //3
 211           2, 64,0, 62,100,BT1/4, //2
 212           5, 45,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 213           2, 60,0, 62,100,BT1/4,  //2 
 214          
 215          //第十一小节
 216          //Em和弦
 217           4+2, 0xFF, 35,90, 42,90, 0xFF, 62,0, 64,0, 40,101, 64,100, BT1/2, //3
 218           3+1, 0xFF, 75,90, 0xFF, 64,0, 55,70, 71,100, BT1/2,  //7
 219           4+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 71,0,  59,70,  71,100,BT1/2,  //7
 220           5, 40,0, 59,0, 71,0, 64,70, 67,100,BT1/2, //5
 221          //Am和弦
 222           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0, 45,101, 69,100, BT1/2,  //6
 223           1+1, 0xFF, 35,90, 0xFF, 57,70,BT1/2,
 224           3+2, 0xFF, 37,90, 42,90,0xFF, 57,0, 60,70, 69,100,BT1/2, //6
 225           5, 45,0, 60,0, 69,0, 64,70, 67,100,BT1/2,  //5
 226            
 227          //第十二小节
 228          //F和弦
 229           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 69,0, 41,101, 69,100, BT1/2,  //6
 230           3+1, 0xFF, 75,90, 0xFF, 69,0, 57,70, 67,100,BT1/2,  //5
 231           4+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 67,0, 60,70, 69,100,BT1/4,  //6
 232           2, 69,0, 67,100, BT1/4, //5
 233           5, 41,0, 60,0, 67,0, 65,70, 64,100,BT1/4, //3
 234           2, 64,0, 62,100,BT1/4,  //2
 235          //C和弦
 236           4+2, 0xFF, 35,90, 42,90, 0xFF, 65,0, 62,0, 48,101, 64,100, BT1/2, //3
 237           3+1, 0xFF, 35,90, 0xFF, 64,0, 55,70, 67,100, BT1/2, //5
 238           4+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/2, //3
 239           5, 48,0, 60,0, 64,0, 64,70, 64,100, BT1/2, //3
 240          
 241          //第十三小节
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 5   

 242          //Dm和弦
 243           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 50,101, 62,100,BT1/2, //2
 244           1+1, 0xFF, 75,90, 0xFF, 57,70,BT1/2,
 245           3+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 62,70, 60,100,BT1/2, //1
 246           5, 50,0, 62,0, 60,0, 65,70, 62,100,BT1/2,  //2
 247          //Em和弦
 248           4+2, 0xFF, 35,90, 42,90, 0xFF, 65,0, 62,0, 40,101, 64,100, BT1/2, //3
 249           1+1, 0xFF, 35,90, 0xFF, 55,70, BT1/2,
 250           3+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 59,70, 60,100,BT1/2, //1
 251           5, 40,0, 59,0, 60,0, 64,70, 62,100,BT1/2, //2
 252          
 253          //第十四小节
 254          //C和弦
 255           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 48,101, 64,100, BT1/2,  //3
 256           3+1, 0xFF, 75,90, 0xFF, 64,0, 55,70, 67,100,BT1/2,   //5
 257           4+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/4,  //3
 258           2, 64,0, 62,100,BT1/4, //2
 259           5, 48,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 260           2, 60,0, 62,100,BT1/4,  //2
 261          //Am和弦
 262           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 45,101, 64,100, BT1/2,  //3
 263           3+1, 0xFF, 35,90, 0xFF, 64,0, 57,70, 69,100,BT1/2,  //6
 264           4+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 69,0, 60,70, 64,100,BT1/4,  //3
 265           2, 64,0, 62,100,BT1/4, //2
 266           5, 45,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 267           2, 60,0, 62,100,BT1/4,  //2 
 268          
 269          //第十五小节
 270          //Em和弦
 271           4+2, 0xFF, 35,90, 42,90, 0xFF, 62,0, 64,0, 40,101, 64,100, BT1/2, //3
 272           3+1, 0xFF, 75,90, 0xFF, 64,0, 55,70, 71,100, BT1/2,  //7
 273           4+2, 0xFF, 37,90, 42,90, 0xFF, 55,0, 71,0,  59,70,  71,100,BT1/2,  //7
 274           5, 40,0, 59,0, 71,0, 64,70, 67,100,BT1/2, //5
 275          //Am和弦
 276           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0, 45,101, 69,100, BT1/2,  //6
 277           1+1, 0xFF, 35,90, 0xFF, 57,70,BT1/2,
 278           3+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 60,70, 69,100,BT1/2, //6
 279           5, 45,0, 60,0, 69,0, 64,70, 67,100,BT1/4,  //5
 280           2, 67,0, 69,100,BT1/4,  //6
 281          
 282          //第十六小节
 283          //D和弦
 284           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 59,0, 50,101, 69,100,BT1/2, //6
 285           1+1, 0xFF, 75,90, 0xFF, 57,70, BT1/2,
 286           2+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 62,70, BT1/2, 
 287           5, 50,0, 62,0, 69,0, 66,70, 67,100, BT1/2, //5
 288          //D和弦
 289           4+2, 0xFF, 35,90, 42,90, 0xFF, 66,0, 67,0, 50,101, 69,100,BT1/2, //6
 290           3+1, 0xFF, 35,90, 0xFF, 69,0, 57,70, 72,100, BT1/2,  //1
 291           2+2, 0xFF, 37,90, 42,90, 0xFF, 57,0, 62,70, BT1/2,
 292           5, 50,0, 62,0, 72,0, 66,70, 69,100,BT1/2,  //6
 293          
 294          //第十七小节
 295          //G和弦
 296           4+1, 0xFF, 35,90, 0xFF, 66,0, 69,0, 43,101, 64,100, BT1/2, //3
 297           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 55,70, 67,100, BT1/2, //5
 298           2+1, 0xFF, 45,90, 0xFF, 55,0, 59,70, BT1/2, 
 299           3+2, 0xFF, 43,90, 46,90, 0xFF, 43,0, 59,0, 67,70,BT1/2,
 300          //G和弦
 301           1+1, 0xFF, 42,90, 0xFF, 43,60,BT1/2, 
 302           1+1, 0xFF, 46,90, 0xFF, 55,50,BT1/2,
 303           3+1, 0xFF, 42,90, 0xFF, 55,0, 67,0, 59,50,BT1/4,
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 6   

 304           1, 0xFF, 46,90, BT1/4,
 305           4+1, 42,90, 0xFF, 43,0, 59,0, 67,60, 55,100, BT1/4, //5
 306           2+2, 0xFF, 42,90, 46,90, 0xFF, 55,0, 57,100, BT1/4,  //6   
 307          
 308          //第十八小节
 309          //C和弦
 310           4+2, 0xFF, 35,90, 42,90, 0xFF, 67,0, 57,0, 48,101, 60,100,BT1/2,  //1
 311           3+1, 0xFF, 42,90, 0xFF, 60,0, 55,70,  60,100,BT1/2,  //1
 312           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 60,0,   60,70,  60,100,BT1/2,   //1
 313           5+1, 0xFF, 42,90, 0xFF, 48,0, 60,0,   60,0, 64,70, 62,100,BT1/4, //2
 314           2, 62,0, 64,100,BT1/4,    //3
 315          //Em和弦
 316           1+2, 0xFF, 35,90, 42,90, 0xFF, 40,101,BT1/2,   //
 317           1+2, 0xFF, 35,90, 42,90, 0xFF, 55,70,BT1/2,
 318           2+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 59,70,BT1/2,  //0
 319           4+2, 0xFF, 35,90, 42,90, 0xFF, 40,0, 59,0, 64,70,  64,100,BT1/4, //3
 320           1, 67,100,BT1/4,   //5   
 321          
 322          //第十九小节
 323          //Am和弦
 324           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0,  45,101, 69,100, BT1/2,  //6
 325           2+1, 0xFF, 42,90, 0xFF, 57,70, 69,100,BT1/2,    //6
 326           4+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 69,0, 60,70, 71,100,BT1/3, //7
 327           2, 71,0, 69,100,BT1/6, //6
 328           3+1, 0xFF, 42,90, 0xFF, 45,0, 60,0, 64,70,BT1/6,
 329           2, 69,0, 67,100,BT1/3,//5
 330          //Em和弦 
 331           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0, 40,101, 64,100,BT1/2,  //3
 332           1+2, 0xFF, 35,90, 42,90, 0xFF, 55,70,BT1/2,
 333           3+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 64,0, 59,70,BT1/2, //0
 334           4+2, 0xFF, 35,90, 42,90, 0xFF, 40,0, 59,0, 64,70, 64,100,BT1/2, //3
 335           
 336          //第二十小节
 337          //Dm和弦
 338           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0,  50,101, 62,100, BT1/2,  //2
 339           1+1, 0xFF, 42,90, 0xFF, 57,70,BT1/2,
 340           4+2, 0xFF, 38,90, 46,90, 0xFF, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 341           1, 60,100,BT1/4,  //1
 342           5+1, 0xFF, 42,90, 0xFF, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
 343           2, 57,0, 55,100,BT1/4,  //5
 344          //Am和弦
 345           4+2, 0xFF, 35,90, 42,90, 0xFF, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 346           1+2, 0xFF, 35,90, 42,90, 0xFF, 57,70,BT1/2,
 347           2+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 60,70,BT1/2,
 348           3+2, 0xFF, 35,90, 42,90, 0xFF, 45,0, 60,100, 64,70,BT1/2,  //1
 349          
 350          //第二十一小节
 351          //Em和弦
 352           4+2, 0xFF, 35,90, 42,90, 0xFF, 60,0, 64,0, 40,101, 59,100,BT1/2,  //7
 353           1+1, 0xFF, 42,90, 0xFF, 55,70,BT1/2,  
 354           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 59,0, 59,70, 57,100, BT1/2,  //6
 355           5+1, 0xFF, 42,90, 0xFF, 40,0, 59,0, 57,0, 64,70, 55,100, BT1/2,  //5
 356          //Am和弦
 357           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 55,0, 45,101, 57,100, BT1/2, //6
 358           1+2, 0xFF, 35,90, 42,90, 0xFF, 57,70,BT1/2,
 359           3+2, 0xFF, 46,90, 47,90, 0xFF, 57,0, 60,70, 60,100,BT1/4,  //1
 360           1,   0xFF, 47,90, BT1/4,
 361           4+2, 42,90, 43,90, 0xFF, 60,0, 45,0,  64,70, 62,100,BT1/2,  //2
 362          
 363          //第二十二小节
 364          //C和弦
 365           4+4, 0xFF, 38,90,57,90, 35,90, 42,90, 0xFF, 64,0, 62,0, 48,101, 64,100, BT1/2,  //3
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 7   

 366           3+1, 0xFF, 42,90, 0xFF, 64,0, 55,70, 67,100,BT1/2,   //5
 367           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/4,  //3
 368           2, 64,0, 62,100,BT1/4, //2
 369           5+1, 0xFF, 42,90, 0xFF, 48,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 370           2, 60,0, 62,100,BT1/4,  //2
 371          //Am和弦
 372           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 45,101, 64,100, BT1/2,  //3
 373           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 57,70, 69,100,BT1/2,  //6
 374           4+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 69,0, 60,70, 64,100,BT1/4,  //3
 375           2, 64,0, 62,100,BT1/4, //2
 376           5+2, 0xFF, 35,90, 42,90, 0xFF, 45,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 377           2, 60,0, 62,100,BT1/4,  //2 
 378          
 379          //第二十三小节
 380          //Em和弦
 381           4+2, 0xFF, 35,90, 42,90, 0xFF, 62,0, 64,0, 40,101, 64,100, BT1/2, //3
 382           3+1, 0xFF, 42,90, 0xFF, 64,0, 55,70, 71,100, BT1/2,  //7
 383           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 71,0,  59,70,  71,100,BT1/2,  //7
 384           5+1, 0xFF, 42,90, 0xFF, 40,0, 59,0, 71,0, 64,70, 67,100,BT1/2, //5
 385          //Am和弦
 386           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0, 45,101, 69,100, BT1/2,  //6
 387           1+2, 0xFF, 35,90, 42,90, 0xFF, 57,70,BT1/2,
 388           3+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 60,70, 69,100,BT1/2, //6
 389           5+2, 0xFF, 35,90, 42,90, 0xFF, 45,0, 60,0, 69,0, 64,70, 67,100,BT1/2,  //5
 390            
 391          //第二十四小节
 392          //F和弦
 393           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 69,0, 41,101, 69,100, BT1/2,  //6
 394           3+1, 0xFF, 42,90, 0xFF, 69,0, 57,70, 67,100,BT1/2,  //5
 395           4+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 67,0, 60,70, 69,100,BT1/4,  //6
 396           2, 69,0, 67,100, BT1/4, //5
 397           5+1, 0xFF, 42,90, 0xFF, 41,0, 60,0, 67,0, 65,70, 64,100,BT1/4, //3
 398           2, 64,0, 62,100,BT1/4,  //2
 399          //C和弦
 400           4+2, 0xFF, 35,90, 42,90, 0xFF, 65,0, 62,0, 48,101, 64,100, BT1/2, //3
 401           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 55,70, 67,100, BT1/2, //5
 402           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/2, //3
 403           5+2, 0xFF, 35,90, 42,90, 0xFF, 48,0, 60,0, 64,0, 64,70, 64,100, BT1/2, //3
 404          
 405          //第二十五小节
 406          //Dm和弦
 407           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 50,101, 62,100,BT1/2, //2
 408           1+1, 0xFF, 42,90, 0xFF, 57,70,BT1/2,
 409           3+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 62,70, 60,100,BT1/2, //1
 410           5+1, 0xFF, 42,90, 0xFF, 50,0, 62,0, 60,0, 65,70, 62,100,BT1/2,  //2
 411          //Em和弦
 412           4+2, 0xFF, 35,90, 42,90, 0xFF, 65,0, 62,0, 40,101, 64,100, BT1/2, //3
 413           1+2, 0xFF, 35,90, 42,90, 0xFF, 55,70, BT1/2,
 414           3+2, 0xFF, 46,90, 47,90, 0xFF, 55,0, 59,70, 60,100,BT1/4, //1
 415           1,   0xFF, 47,90, BT1/4, 
 416           5+2, 42,90, 43,90, 0xFF, 40,0, 59,0, 60,0, 64,70, 62,100,BT1/2, //2
 417          
 418          //第二十六小节
 419          //C和弦
 420           4+4, 0xFF, 38,90, 57,90, 35,90, 42,90, 0xFF, 64,0, 62,0, 48,101, 64,100, BT1/2,  //3
 421           3+1, 0xFF, 42,90, 0xFF, 64,0, 55,70, 67,100,BT1/2,   //5
 422           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 67,0, 60,70, 64,100,BT1/4,  //3
 423           2, 64,0, 62,100,BT1/4, //2
 424           5+1, 0xFF, 42,90, 0xFF, 48,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 425           2, 60,0, 62,100,BT1/4,  //2
 426          //Am和弦
 427           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 62,0, 45,101, 64,100, BT1/2,  //3
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 8   

 428           3+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 57,70, 69,100,BT1/2,  //6
 429           4+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 69,0, 60,70, 64,100,BT1/4,  //3
 430           2, 64,0, 62,100,BT1/4, //2
 431           5+2, 0xFF, 35,90, 42,90, 0xFF, 45,0, 60,0, 62,0, 64,70, 60,100,BT1/4,  //1
 432           2, 60,0, 62,100,BT1/4,  //2 
 433          
 434          //第二十七小节
 435          //Em和弦
 436           4+2, 0xFF, 35,90, 42,90, 0xFF, 62,0, 64,0, 40,101, 64,100, BT1/2, //3
 437           3+1, 0xFF, 42,90, 0xFF, 64,0, 55,70, 71,100, BT1/2,  //7
 438           4+2, 0xFF, 38,90, 46,90, 0xFF, 55,0, 71,0,  59,70,  71,100,BT1/2,  //7
 439           5+1, 0xFF, 42,90, 0xFF, 40,0, 59,0, 71,0, 64,70, 67,100,BT1/2, //5
 440          //Am和弦
 441           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 67,0, 45,101, 69,100, BT1/2,  //6
 442           1+2, 0xFF, 35,90, 42,90, 0xFF, 57,70,BT1/2,
 443           3+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 60,70, 69,100,BT1/2, //6
 444           5+2, 0xFF, 35,90, 42,90, 0xFF, 45,0, 60,0, 69,0, 64,70, 67,100,BT1/4,  //5
 445           2, 67,0, 69,100,BT1/4,  //6
 446          
 447          //第二十八小节
 448          //D和弦
 449           4+2, 0xFF, 35,90, 42,90, 0xFF, 64,0, 59,0, 50,101, 69,100,BT1/2, //6
 450           1+1, 0xFF, 42,90, 0xFF, 57,70, BT1/2,
 451           2+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 62,70, BT1/2, 
 452           5+1, 0xFF, 42,90, 0xFF, 50,0, 62,0, 69,0, 66,70, 67,100, BT1/2, //5
 453          //D和弦
 454           4+2, 0xFF, 35,90, 42,90, 0xFF, 66,0, 67,0, 50,101, 69,100,BT1/2, //6
 455           3+2, 0xFF, 35,90, 42,90, 0xFF, 69,0, 57,70, 72,100, BT1/2,  //1
 456           2+2, 0xFF, 38,90, 46,90, 0xFF, 57,0, 62,70, BT1/2,
 457           5+2, 0xFF, 35,90, 42,90, 0xFF, 50,0, 62,0, 72,0, 66,70, 69,100,BT1/2,  //6
 458          
 459          //第二十九小节
 460          //G和弦
 461           4+4, 0xFF, 38,90, 35,90, 42,90, 57,90, 0xFF, 66,0, 69,0, 43,101, 64,100, BT1/2, //3
 462           3+1, 0xFF, 42,90, 0xFF, 64,0, 55,70, 67,100, BT1/4, //5
 463           1,   0xFF, 35,90, BT1/4,
 464           2+2, 42,90, 47,90, 0xFF, 55,0, 59,70, BT1/2,
 465           3+3, 0xFF, 46,90, 42,90, 57,90, 0xFF, 43,0, 59,0, 67,70,BT1/2,
 466          //G和弦
 467           1, 43,60,BT1/2, 
 468           1, 55,50,BT1/2,
 469           3, 55,0, 67,0, 59,50,BT1/2,
 470           4, 43,0, 59,0, 67,60, 55,100, BT1/4, //5
 471           2, 55,0, 57,100, BT1/4,  //6   
 472          
 473          //第三十小节
 474          //C和弦
 475           4, 67,0, 57,0, 48,101, 60,100,BT1/2,  //1
 476           3, 60,0, 55,70,  60,100,BT1/2,  //1
 477           4, 55,0, 60,0,   60,70,  60,100,BT1/2,   //1
 478           5, 48,0, 60,0,   60,0, 64,70, 62,100,BT1/4, //2
 479           2, 62,0, 64,100,BT1/4,    //3
 480          //Em和弦
 481           1, 40,101,BT1/2,   //
 482           1, 55,70,BT1/2,
 483           2, 55,0, 59,70,BT1/2,  //0
 484           4, 40,0, 59,0, 64,70,  64,100,BT1/4, //3
 485           1, 67,100,BT1/4,   //5   
 486          
 487          //第三十一小节
 488          //Am和弦
 489           4, 64,0, 67,0,  45,101, 69,100, BT1/2,  //6
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 9   

 490           2, 57,70, 69,100,BT1/2,    //6
 491           4, 57,0, 69,0, 60,70, 71,100,BT1/3, //7
 492           2, 71,0, 69,100,BT1/6, //6
 493           3, 45,0, 60,0, 64,70,BT1/6,
 494           2, 69,0, 67,100,BT1/3,//5
 495          //Em和弦 
 496           4, 64,0, 67,0, 40,101, 64,100,BT1/2,  //3
 497           1, 55,70,BT1/2,
 498           3, 55,0, 64,0, 59,70,BT1/2, //0
 499           4, 40,0, 59,0, 64,70, 64,100,BT1/2, //3
 500           
 501          //第三十二小节
 502          //Dm和弦
 503           3, 64,0,  50,101, 62,100, BT1/2,  //2
 504           1, 57,70,BT1/2,
 505           4, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 506           1, 60,100,BT1/4,  //1
 507           5, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
 508           2, 57,0, 55,100,BT1/4,  //5
 509          //Am和弦
 510           4, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 511           1, 57,70,BT1/2,
 512           2, 57,0, 60,70,BT1/2,
 513           3, 45,0, 60,100, 64,70,BT1/2,  //1
 514          
 515          //第三十三小节
 516          //Em和弦
 517           4, 60,0, 64,0, 40,101, 59,100,BT1/2,  //7
 518           1, 55,70,BT1/2,  
 519           4, 55,0, 59,0, 59,70, 57,100, BT1/2,  //6
 520           5, 40,0, 59,0, 57,0, 64,70, 55,100, BT1/2,  //5
 521          //Am和弦
 522           4, 64,0, 55,0, 45,101, 57,100, BT1/2, //6
 523           1, 57,70,BT1/2,
 524           2, 57,0, 60,70,BT1/2,
 525           4, 60,0, 45,0, 64,70, 57,0,BT1/2,
 526          
 527          //第三十四小节
 528          //Dm和弦
 529           3, 64,0,  50,101, 62,100, BT1/2,  //2
 530           1, 57,70,BT1/2,
 531           4, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 532           1, 60,100,BT1/4,  //1
 533           5, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
 534           2, 57,0, 55,100,BT1/4,  //5
 535          //Am和弦
 536           4, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 537           1, 57,70,BT1/2,
 538           2, 57,0, 60,70,BT1/2,
 539           3, 45,0, 60,100, 64,70,BT1/2,  //1
 540          
 541          //第三十五小节
 542          //Em和弦
 543           4, 60,0, 64,0, 40,101, 59,100,BT1/2,  //7
 544           1, 55,70,BT1/2,  
 545           4, 55,0, 59,0, 59,70, 57,100, BT1/2,  //6
 546           5, 40,0, 59,0, 57,0, 64,70, 55,100, BT1/2,  //5
 547          //Am和弦
 548           4, 64,0, 55,0, 45,101, 57,100, BT1/2, //6
 549           1, 57,70,BT1/2,
 550           2, 57,0, 60,70,BT1/2,
 551           4, 60,0, 45,0, 64,70, 57,0,BT1/2,
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 10  

 552           //第三十六小节
 553           
 554          //Dm和弦
 555           3, 64,0,  50,101, 62,100, BT1/2,  //2
 556           1, 57,70,BT1/2,
 557           4, 57,0,  62,0, 62,70, 62,100, BT1/4, //2
 558           1, 60,100,BT1/4,  //1
 559           5, 62,0, 60,0, 50,0, 65,70, 57,100, BT1/4, //6   
 560           2, 57,0, 55,100,BT1/4,  //5
 561          //Am和弦
 562           4, 65,0, 55,0, 45,101, 57,100,BT1/2,  //6
 563           1, 57,70,BT1/2,
 564           2, 57,0, 60,70,BT1/2,
 565          //后面不直接用BT1表示，做渐慢处理
 566           3, 45,0, 60,100, 64,70,  36,24/2,  //1
 567          
 568          //第三十七小节
 569          //Em和弦
 570           4, 60,0, 64,0, 40,101, 59,100, 40,24/2,  //7
 571           1, 55,70,   44,24/2,  
 572           4, 55,0, 59,0, 59,70, 57,100,  48,24/2,  //6
 573           5, 40,0, 59,0, 57,0, 64,70, 55,100, 52,24/2,  //5
 574          //Am和弦
 575           4, 64,0, 55,0, 45,101, 57,100, 56,18, //6
 576           
 577           3, 45,0, 56,0, 76-12,70,BT1/4,
 578           1, 69,70,BT1/4,
 579           1, 72,70,BT1/4,
 580           1, 88,70,BT1,
 581           4, 76,0, 81,0, 84,0, 100,0, BT1
 582          };
 583          
 584          #else
              
              code uint8 SongTable[]=
              {
               0,8,
               //引子
               1, 83,70, BT1/2, //7
               2, 83,0, 84,90, BT1/2, //1
               2, 84,0, 86,90, BT1/2, //2
               2, 86,0, 91,90, BT1/2, //5
               2, 91,0, 89,90, BT1/2, //4
               2, 89,0, 81,90, BT1/2, //6
               2, 81,0, 79,90, BT1/2, //5
               2, 79,0, 88,90, BT1/2, //3
              };
              
              #endif
 601          
 602          
 603          /***********************自动播放歌曲*******************************/
 604          void PlaySong(void)
 605          {
 606   1       uint16 i,k,t;
 607   1       uint8 j,n;
 608   1       uint8 *p;
 609   1       
 610   1       uint8 Buf[4];
 611   1       
 612   1       Buf[0]=0x09; //Note On的MIDI事件消息包头
 613   1       Buf[1]=0x90; //在通道0上发送Note On消息
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 11  

 614   1       
 615   1       //开始播放前，关掉所有以前的声音 
 616   1       Buf[3]=0x00; //力度设置为0
 617   1       for(i=20;i<128;i++)
 618   1       {
 619   2        Buf[2]=i;
 620   2        //如果两个端点都在忙，则等待传输完成
 621   2        while((D12ReadEndpointStatus(5)&0x60)==0x60);
 622   2        D12WriteEndpointBuffer(5,4,Buf); 
 623   2       }
 624   1       DelayXms(500); //等待半秒钟安静了才开始播放
 625   1       KeyDown=0;  //清除按键事件
 626   1       
 627   1       p=SongTable; //歌曲音符数组
 628   1        
 629   1       i=0;
 630   1       //获取歌曲的行数
 631   1       k=p[i++];
 632   1       k=(k<<8)+p[i++];
 633   1       //播放所有行
 634   1       while(k--)
 635   1       {
 636   2        //获取该行有多少个音符
 637   2        n=p[i++];
 638   2        //依次发送所有音符
 639   2        for(j=0;j<n;j++)
 640   2        {
 641   3         if(p[i]==0xFF) //遇到0xFF则切换通道
 642   3         {
 643   4          if(Buf[1]==0x90)Buf[1]=0x99; //切换到打击乐通道
 644   4          else Buf[1]=0x90; //切换回旋律乐通道
 645   4          i++; //跳过本字节
 646   4         }
 647   3         //获取某一音符的音高和力度
 648   3         Buf[2]=p[i++];
 649   3         Buf[3]=p[i++];
 650   3         //如果两个端点都在忙，则等待传输完成
 651   3         while((D12ReadEndpointStatus(5)&0x60)==0x60);
 652   3         //发送4字节的Note On消息
 653   3         D12WriteEndpointBuffer(5,4,Buf);   
 654   3        }
 655   2        //计算实际的时间
 656   2        t=p[i++];
 657   2        t*=p[i++];
 658   2        //延时等待本行播放完毕
 659   2        DelayXms(t);
 660   2        
 661   2        //如果有按键按下，则退出播放
 662   2        if(KeyDown)
 663   2        {
 664   3         KeyDown=0;   //清除按键
 665   3         break;
 666   3        }
 667   2       }
 668   1       //退出播放时，要关闭所有音符
 669   1       Buf[1]=0x90; 
 670   1       Buf[3]=0x00;
 671   1       for(i=20;i<128;i++)
 672   1       {
 673   2        Buf[2]=i;
 674   2        //如果两个端点都在忙，则等待传输完成
 675   2        while((D12ReadEndpointStatus(5)&0x60)==0x60);
C51 COMPILER V7.06   SONG                                                                  04/13/2009 14:23:40 PAGE 12  

 676   2        D12WriteEndpointBuffer(5,4,Buf); 
 677   2       }
 678   1      }
 679          /*******************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    440    ----
   CONSTANT SIZE    =   4183    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
