C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE HPI
OBJECT MODULE PLACED IN HPI.OBJ
COMPILER INVOKED BY: F:\KEIL\C51\BIN\C51.EXE HPI.C DEBUG OBJECTEXTEND CODE

stmt level    source

   1          #include "common.h"
   2          
   3          extern XXGFLAGS bdata bXXGFlags;
   4          extern unsigned char xdata DBUF[BUFFER_LENGTH];
   5          //////////////////////////////////////////
   6          //CH_CMD_BLOCK xdata inblock;
   7          unsigned char xdata CHBUF[CHBUF_LENGTH];
   8          SYS_INFO_BLOCK xdata DeviceInfo;
   9          CH_CMD_BLOCK xdata CHCmdBlock;
  10          CH_RSP_BLOCK xdata CHRspBlock;
  11          FILE_INFO xdata ThisFile;
  12          extern FREE_FAT_INFO xdata FreeFat;
  13          
  14          
  15          unsigned char EnumMassDev(void)
  16          {
  17   1              PMBR_BLOCK pMBR;
  18   1              PBPB_BLOCK pBPB;
  19   1              if(!mInitDisk( ))
  20   1                  return FALSE;  /* 初始化USB存储器 */
  21   1              pMBR=(PMBR_BLOCK)DBUF;
  22   1              DeviceInfo.BPB_BytesPerSec=512; //暂假设为512
  23   1              if(!SPC_LockMedia())
  24   1                      return FALSE;
  25   1              if(!SPC_RequestSense())
  26   1                      return FALSE;
  27   1              if(!SPC_TestUnit())
  28   1                      return FALSE;
  29   1              if(!ReadCapacity())
  30   1                      return FALSE;
  31   1              if(!RBC_Read(0x0,1,DBUF))
  32   1                      return FALSE;
  33   1              if(DBUF[0]==0xeb||DBUF[0]==0xe9){
  34   2                      DeviceInfo.StartSector=0;
  35   2                      //DeviceInfo.TotalSector=SwapINT32(pMBR->TotalSector);
  36   2                      }
  37   1              else    {
  38   2                      DeviceInfo.StartSector=SwapINT32(pMBR->StartSector);
  39   2                      //DeviceInfo.TotalSector=SwapINT32(pMBR->TotalSector);
  40   2                      }
  41   1              pBPB=(PBPB_BLOCK)DBUF;
  42   1              if(!RBC_Read(DeviceInfo.StartSector,1,DBUF))
  43   1                      return FALSE;
  44   1              DeviceInfo.BPB_BytesPerSec=SwapINT16(pBPB->BPB_BytesPerSec);
  45   1              DeviceInfo.BPB_SecPerClus=pBPB->BPB_SecPerClus;
  46   1              DeviceInfo.BPB_NumFATs=pBPB->BPB_NumFATs;
  47   1              DeviceInfo.BPB_RootEntCnt=SwapINT16(pBPB->BPB_RootEntCnt);
  48   1              DeviceInfo.BPB_TotSec16=SwapINT16(pBPB->BPB_TotSec16);
  49   1              DeviceInfo.BPB_FATSz16=SwapINT16(pBPB->BPB_FATSz16);
  50   1              DeviceInfo.BPB_TotSec32=SwapINT32(pBPB->BPB_TotSec32);
  51   1              DeviceInfo.FatStartSector=DeviceInfo.StartSector+pBPB->BPB_RsvdSecCn[0];
  52   1              DeviceInfo.RootStartSector=DeviceInfo.StartSector+2*DeviceInfo.BPB_FATSz16+pBPB->BPB_RsvdSecCn[0];
  53   1              DeviceInfo.FirstDataSector=DeviceInfo.FatStartSector+2*DeviceInfo.BPB_FATSz16+32;
  54   1              ThisFile.bFileOpen=0;
  55   1              bXXGFlags.bits.SLAVE_IS_ATTACHED=1;
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 2   

  56   1              return TRUE;
  57   1      }
  58          
  59          //***********************************************
  60          unsigned char DetectDevice(void)      //检测设备
  61          {
  62   1      #define RspBlockDetectDevice CHRspBlock.RspBlock.Rsp_DetectDevice
  63   1              return bXXGFlags.bits.SLAVE_IS_ATTACHED;
  64   1      
  65   1      #undef RspBlockDetectDevice
  66   1      }
  67          
  68          unsigned char List(void)     //列表文件
  69          {
  70   1      #define RspBlockList CHRspBlock.RspBlock.Rsp_List
  71   1              unsigned int item,i;
  72   1              unsigned char j,k,bstop,sector;
  73   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
  74   1              {
  75   2              CHRspBlock.errcode=ERC_NODEVICE;
  76   2              return FALSE;
  77   2              }
  78   1              item=0;
  79   1              bstop=0;
  80   1              //RspBlockList.result=0x1;
  81   1              for(sector=0;sector<DeviceInfo.BPB_RootEntCnt>>4;sector++)
  82   1                  {
  83   2                      if(!RBC_Read(DeviceInfo.RootStartSector+sector,1,DBUF))
  84   2                              {
  85   3                              CHRspBlock.errcode=ERC_DEVICEERR;
  86   3                              return FALSE;
  87   3                              }
  88   2                      for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+32)
  89   2                              {
  90   3                              if(DBUF[i]==0x00)
  91   3                                      {bstop=1;
  92   4                                      break;}
  93   3                              else if(DBUF[i]==0xE5)
  94   3                                      continue;
  95   3                              else if((DBUF[i]&0x40==0x40)&&(DBUF[i+11]==0xff))
  96   3                                      {
  97   4                                      j=DBUF[i]&0x0F;
  98   4                                      j=j+1;
  99   4                                      for(k=0;k<j*32;k++)
 100   4                                              CHBUF[item*32+k]=DBUF[i+k];
 101   4                                      i=i+(j-1)*32;
 102   4                                      item=item+j;
 103   4                                      }
 104   3                              else
 105   3                                      {
 106   4                                      for(k=0;k<32;k++)
 107   4                                              CHBUF[item*32+k]=DBUF[i+k];
 108   4                                      item=item+1;
 109   4                                      }
 110   3                              }
 111   2                      if(bstop==1)break;
 112   2                  }
 113   1              //pBuf=(PREAD_CAPACITY_RSP)DBUF;
 114   1              RspBlockList.len=SwapINT16(item*32);
 115   1              CHRspBlock.len=item*32;
 116   1              return TRUE;
 117   1      
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 3   

 118   1      #undef RspBlockList
 119   1      
 120   1      }
 121          unsigned char OpenFile(unsigned char *pBuffer)
 122          {
 123   1      #define RspBlockOpenFile CHRspBlock.RspBlock.Rsp_OpenFile
 124   1              unsigned int i;
 125   1              unsigned char j,bstop,sector;
 126   1              PDIR_INFO pDirInfo;
 127   1      
 128   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 129   1              {
 130   2              CHRspBlock.errcode=ERC_NODEVICE;
 131   2              return FALSE;
 132   2              }
 133   1              ThisFile.bFileOpen=0;
 134   1              //RspBlockOpenFile.result=0x0;
 135   1              //RspBlockOpenFile.errcode=ERC_OK;
 136   1              for(sector=0;sector<DeviceInfo.BPB_RootEntCnt>>4;sector++)
 137   1                  {
 138   2                      if(!RBC_Read(DeviceInfo.RootStartSector+sector,1,DBUF))
 139   2                              {
 140   3                              CHRspBlock.errcode=ERC_DEVICEERR;
 141   3                              return FALSE;
 142   3      
 143   3                              }
 144   2                      for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+32)
 145   2                              {
 146   3                              if(DBUF[i]==0x00)
 147   3                                      {
 148   4                                      CHRspBlock.errcode=ERC_FILENOTFOUND;
 149   4                                      return FALSE;
 150   4                                      }
 151   3                              j=0;
 152   3                              while(DBUF[i+j]==*(pBuffer+j))
 153   3                                      {
 154   4                                       j=j+1;
 155   4                                       if(j>10)
 156   4                                              break;
 157   4                                      }
 158   3      
 159   3                              if(j>10)
 160   3                                  {
 161   4                                  for(j=0;j<32;j++)
 162   4                                      RspBlockOpenFile.item[j]=DBUF[i+j];
 163   4                                  //RspBlockOpenFile.result=0x1;
 164   4                                  ThisFile.bFileOpen=1;
 165   4                                  bstop=1;
 166   4                                   break;}
 167   3      
 168   3                              }
 169   2                      if(bstop==1)break;
 170   2                  }
 171   1      
 172   1                  if(sector>=DeviceInfo.BPB_RootEntCnt>>4)
 173   1                      {
 174   2                      CHRspBlock.errcode=ERC_FILENOTFOUND;
 175   2                      return FALSE;
 176   2                      }
 177   1              pDirInfo=(PDIR_INFO)RspBlockOpenFile.item;
 178   1              ThisFile.StartCluster=SwapINT16(pDirInfo->startCluster);
 179   1              ThisFile.LengthInByte=SwapINT32(pDirInfo->length);
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 4   

 180   1              ThisFile.ClusterPointer=ThisFile.StartCluster;
 181   1              ThisFile.SectorPointer=FirstSectorofCluster(ThisFile.StartCluster);
 182   1              ThisFile.OffsetofSector=0;
 183   1              ThisFile.SectorofCluster=0;
 184   1              ThisFile.FatSectorPointer=0;
 185   1              //ThisFile.bFileOpen=1;
 186   1              ThisFile.pointer=0;
 187   1              FreeFat.SectorNum=DeviceInfo.FatStartSector;
 188   1              FreeFat.OldSectorNum=DeviceInfo.FatStartSector;
 189   1              FreeFat.OffsetofSector=2;
 190   1      
 191   1              return TRUE;
 192   1      #undef RspBlockOpenFile
 193   1      }
 194          
 195          unsigned char ReadFile(unsigned int readLength,unsigned char *pBuffer)
 196          {
 197   1      #define RspBlockReadFile CHRspBlock.RspBlock.Rsp_ReadFile
 198   1              unsigned int idata len,i;
 199   1              unsigned char bSuccess;
 200   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 201   1              {
 202   2              CHRspBlock.errcode=ERC_NODEVICE;
 203   2              return FALSE;
 204   2              }
 205   1              if(!ThisFile.bFileOpen)
 206   1              {
 207   2              CHRspBlock.errcode=ERC_FILENOTOPENED;
 208   2              return FALSE;
 209   2              }
 210   1              ThisFile.bFileOpen=0;
 211   1              bSuccess=1;
 212   1              CHRspBlock.len=0;
 213   1              if(readLength>MAX_READ_LENGTH)
 214   1                      {
 215   2                      CHRspBlock.errcode=ERC_LENGTHEXCEED;
 216   2                      return FALSE;
 217   2                      }
 218   1              if(readLength+ThisFile.pointer>ThisFile.LengthInByte)
 219   1                      {
 220   2                      CHRspBlock.errcode=ERC_LENGTHEXCEED;
 221   2                      return FALSE;
 222   2                      }
 223   1                      while(readLength>0)
 224   1                      {
 225   2                         if(readLength+ThisFile.OffsetofSector>DeviceInfo.BPB_BytesPerSec)
 226   2                              len=DeviceInfo.BPB_BytesPerSec;
 227   2                         else
 228   2                              len=readLength+ThisFile.OffsetofSector;
 229   2                         if(ThisFile.OffsetofSector>0)
 230   2                              {
 231   3                              if(RBC_Read(ThisFile.SectorPointer,1,DBUF))
 232   3                                      {
 233   4                                      len=len-ThisFile.OffsetofSector;
 234   4                                      for(i=0;i<len;i++)
 235   4                                              *(pBuffer+i)=DBUF[ThisFile.OffsetofSector+i];
 236   4                                      ThisFile.OffsetofSector=ThisFile.OffsetofSector+len;
 237   4                                      }
 238   3                              else
 239   3                                      {
 240   4                                      CHRspBlock.errcode=ERC_DEVICEERR;
 241   4                                      return FALSE;
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 5   

 242   4                                      }
 243   3                              }
 244   2                         else
 245   2                              {
 246   3                                      if(!RBC_Read(ThisFile.SectorPointer,1,pBuffer+CHRspBlock.len))
 247   3                                      {
 248   4                                      CHRspBlock.errcode=ERC_DEVICEERR;
 249   4                                      return FALSE;
 250   4                                      }
 251   3                                      ThisFile.OffsetofSector=len;
 252   3                              }
 253   2                        // if(ThisFile.OffsetofSector>DeviceInfo.BPB_BytesPerSec-1)
 254   2                        //    ThisFile.OffsetofSector-=DeviceInfo.BPB_BytesPerSec;
 255   2                         readLength-=len;
 256   2                         CHRspBlock.len+=len;
 257   2                         if(ThisFile.OffsetofSector>DeviceInfo.BPB_BytesPerSec-1)
 258   2                         {
 259   3                              ThisFile.OffsetofSector-=DeviceInfo.BPB_BytesPerSec;
 260   3                              ThisFile.SectorofCluster+=1;
 261   3                              if(ThisFile.SectorofCluster>DeviceInfo.BPB_SecPerClus-1)
 262   3                              {
 263   4                                      ThisFile.SectorofCluster=0;
 264   4                                       ThisFile.ClusterPointer=GetNextClusterNum(ThisFile.ClusterPointer);
 265   4                                       if(ThisFile.ClusterPointer>0xffef)
 266   4                                              {
 267   5                                                 //RspBlockReadFile.errcode=ERC_REACHEND;
 268   5                                                 //RspBlockReadFile.result=0x0;
 269   5                                                 CHRspBlock.errcode=ERC_REACHEND;
 270   5                                                 return FALSE;
 271   5                                              }
 272   4                                       ThisFile.SectorPointer=FirstSectorofCluster(ThisFile.ClusterPointer);
 273   4                              }
 274   3                              else
 275   3                                      ThisFile.SectorPointer=ThisFile.SectorPointer+1;
 276   3                          }
 277   2                      }
 278   1              ThisFile.bFileOpen=1;
 279   1              ThisFile.pointer+=CHRspBlock.len;
 280   1              RspBlockReadFile.readLength=SwapINT16(CHRspBlock.len);
 281   1              return TRUE;
 282   1      #undef RspBlockReadFile
 283   1      }
 284          
 285          unsigned char CreateFile(unsigned char *pBuffer)                //创建文件
 286          {
 287   1      #define RspBlockCreateFile CHRspBlock.RspBlock.Rsp_CreateFile
 288   1              //unsigned long sectorNum;
 289   1              unsigned int sector,i,j;
 290   1              unsigned char bstop;
 291   1              PDIR_INFO pDirInfo;
 292   1      
 293   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)      //检测设备是否连入
 294   1              {
 295   2              CHRspBlock.errcode=ERC_NODEVICE;                        //否则返回错误
 296   2              return FALSE;
 297   2              }
 298   1              if(OpenFile( pBuffer))RemoveFile(pBuffer);
 299   1              //RspBlockCreateFile.result=0x1;
 300   1              //RspBlockCreateFile.errcode=ERC_OK;
 301   1              pDirInfo=(PDIR_INFO)pBuffer;
 302   1              //if(!SPC_TestUnit())
 303   1              //      return FALSE;
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 6   

 304   1              //////// Search the fat for a free cluster  ////////////
 305   1              pDirInfo->startCluster=SwapINT16(GetFreeCusterNum());
 306   1      
 307   1              if(pDirInfo->startCluster<0x2)
 308   1              {
 309   2              CHRspBlock.errcode=ERC_NODEVICE;
 310   2              return FALSE;
 311   2              }
 312   1              pDirInfo->length=0;
 313   1              /////// Search a free space in the root dir space and build the item ///
 314   1              ThisFile.bFileOpen=0;
 315   1              bstop=0;
 316   1              for(sector=0;sector<DeviceInfo.BPB_RootEntCnt>>4;sector++)
 317   1                  {
 318   2                      if(!RBC_Read(DeviceInfo.RootStartSector+sector,1,DBUF))
 319   2                              {
 320   3      
 321   3                              CHRspBlock.errcode=ERC_DEVICEERR;
 322   3                                      return FALSE;
 323   3                              }
 324   2                      for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+32)
 325   2                              {
 326   3                              if((DBUF[i]==0x00)||(DBUF[i]==0xE5))
 327   3                                      {
 328   4                                      for(j=0;j<32;j++)
 329   4                                              DBUF[i+j]=*(pBuffer+j);
 330   4                                      if(!RBC_Write(DeviceInfo.RootStartSector+sector,1,DBUF))
 331   4                                              {
 332   5                                              CHRspBlock.errcode=ERC_DEVICEERR;
 333   5                                              return FALSE;
 334   5                                              }
 335   4                                      bstop=1;
 336   4                                      break;
 337   4                                      }
 338   3                              }
 339   2                      if(bstop==1)break;
 340   2                  }
 341   1              //pDirInfo=(PDIR_INFO)RspBlockOpenFile.item;
 342   1              ThisFile.StartCluster=SwapINT16(pDirInfo->startCluster);
 343   1              ThisFile.LengthInByte=0;
 344   1              ThisFile.ClusterPointer=ThisFile.StartCluster;
 345   1              ThisFile.SectorPointer=FirstSectorofCluster(ThisFile.StartCluster);
 346   1              ThisFile.OffsetofSector=0;
 347   1              ThisFile.SectorofCluster=0;
 348   1              ThisFile.bFileOpen=1;
 349   1              ThisFile.pointer=0;
 350   1              ThisFile.FatSectorPointer=0;
 351   1              FreeFat.SectorNum=DeviceInfo.FatStartSector;
 352   1              FreeFat.OldSectorNum=DeviceInfo.FatStartSector;
 353   1              FreeFat.OffsetofSector=2;
 354   1      
 355   1              return TRUE;
 356   1      #undef RspBlockCreateFile
 357   1      }
 358          
 359          unsigned char WriteFile(unsigned int writeLength,unsigned char *pBuffer)
 360          {
 361   1      #define RspBlockWriteFile CHRspBlock.RspBlock.Rsp_WriteFile
 362   1              unsigned int len,sector,i;
 363   1              PDIR_INFO pDirInfo;
 364   1              unsigned char bSuccess,bStop,step;
 365   1      
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 7   

 366   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)   //U盘是否已经连接
 367   1              {
 368   2              CHRspBlock.errcode=ERC_NODEVICE;
 369   2              return FALSE;
 370   2              }
 371   1              if(!ThisFile.bFileOpen)                 //文件是否已经打开
 372   1              {
 373   2              CHRspBlock.errcode=ERC_FILENOTOPENED;
 374   2              return FALSE;
 375   2              }
 376   1              ThisFile.bFileOpen=0;
 377   1              bSuccess=1;
 378   1              bStop=0;
 379   1      
 380   1              CHRspBlock.len=0;
 381   1              //if(CHCmdBlock.CmdBlock.Cmd_WriteFile.writeLength)
 382   1              while(writeLength>0)
 383   1              {
 384   2                       if(ThisFile.OffsetofSector>0)
 385   2                              {
 386   3                              if(writeLength+ThisFile.OffsetofSector>DeviceInfo.BPB_BytesPerSec)
 387   3                                      len=DeviceInfo.BPB_BytesPerSec;
 388   3                              else
 389   3                                      len=writeLength+ThisFile.OffsetofSector;
 390   3                              if(!RBC_Read(ThisFile.SectorPointer,1,DBUF))
 391   3                                      {
 392   4                                      CHRspBlock.errcode=ERC_DEVICEERR;
 393   4                                      return FALSE;
 394   4                                      }
 395   3                              len=len-ThisFile.OffsetofSector;
 396   3                              for(i=0;i<len;i++)
 397   3                                      DBUF[ThisFile.OffsetofSector+i]=*(pBuffer+i);
 398   3                              if(!RBC_Write(ThisFile.SectorPointer,1,DBUF))
 399   3                                              {
 400   4                                              CHRspBlock.errcode=ERC_DEVICEERR;
 401   4                                              return FALSE;
 402   4                                              }
 403   3                              ThisFile.OffsetofSector=ThisFile.OffsetofSector+len;
 404   3                              }
 405   2                       else
 406   2                              {
 407   3                              if(writeLength>DeviceInfo.BPB_BytesPerSec)
 408   3                                      {
 409   4                                      step=writeLength/DeviceInfo.BPB_BytesPerSec;
 410   4                                      if(step>DeviceInfo.BPB_SecPerClus)
 411   4                                              {
 412   5                                              step=DeviceInfo.BPB_SecPerClus-ThisFile.SectorofCluster;
 413   5                                              len=step*DeviceInfo.BPB_BytesPerSec;
 414   5                                              }
 415   4                                      else
 416   4                                              {
 417   5                                              step=step-ThisFile.SectorofCluster;
 418   5                                              len=step*DeviceInfo.BPB_BytesPerSec;
 419   5                                              }
 420   4                                      }
 421   3                              else
 422   3                                      {
 423   4                                      step=1;
 424   4                                      len=writeLength;
 425   4                                      }
 426   3                              if(!RBC_Write(ThisFile.SectorPointer,step,pBuffer+CHRspBlock.len))
 427   3                                      {
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 8   

 428   4                                      CHRspBlock.errcode=ERC_DEVICEERR;
 429   4                                      return FALSE;
 430   4                                      }
 431   3                              ThisFile.OffsetofSector=len;
 432   3                              }
 433   2                       //if(ThisFile.OffsetofSector>DeviceInfo.BPB_BytesPerSec-1)
 434   2                       //     ThisFile.OffsetofSector-=DeviceInfo.BPB_BytesPerSec;
 435   2                         writeLength-=len;
 436   2                         CHRspBlock.len+=len;
 437   2                         //ThisFile.LengthInByte+=len;
 438   2                      /////////////更新文件指针 //////////////////////////////
 439   2                      //改变参数：OffsetofSector,SectorofCluster,SectorPointer,ClusterPointer
 440   2                        step=ThisFile.OffsetofSector/DeviceInfo.BPB_BytesPerSec;
 441   2      
 442   2                        if(step>0)
 443   2                         {
 444   3                              ThisFile.OffsetofSector-=step*DeviceInfo.BPB_BytesPerSec;
 445   3                              ThisFile.SectorofCluster+=step;
 446   3                              if(ThisFile.SectorofCluster>DeviceInfo.BPB_SecPerClus-1)
 447   3                              {
 448   4                                      ThisFile.SectorofCluster=0;
 449   4                                      if(ThisFile.pointer+CHRspBlock.len<ThisFile.LengthInByte)
 450   4                                              ThisFile.ClusterPointer=GetNextClusterNum(ThisFile.ClusterPointer);
 451   4                                      else
 452   4                                              ThisFile.ClusterPointer=CreateClusterLink(ThisFile.ClusterPointer);//GetNextClusterNum(ThisFile.Clu
             -sterPointer);
 453   4                                       if(ThisFile.ClusterPointer==0x00)
 454   4                                              {
 455   5                                       //        RspBlockReadFile.errcode=ERC_REACHEND;
 456   5                                              //   RspBlockReadFile.result=0x0;
 457   5                                              CHRspBlock.errcode=ERC_DEVICEERR;
 458   5                                              return FALSE;
 459   5                                              }
 460   4                                       ThisFile.SectorPointer=FirstSectorofCluster(ThisFile.ClusterPointer);
 461   4                              }
 462   3                              else
 463   3                                      ThisFile.SectorPointer=ThisFile.SectorPointer+step;
 464   3                          }
 465   2      
 466   2      
 467   2              }//end while
 468   1              ThisFile.pointer+=CHRspBlock.len;
 469   1              UpdateFat(FreeFat.SectorNum);
 470   1              ///////////更新文件目录信息/////////////////////////////
 471   1              if(bSuccess==1)
 472   1              {
 473   2      
 474   2                      for(sector=0;sector<DeviceInfo.BPB_RootEntCnt>>4;sector++)
 475   2                      {
 476   3                      if(!RBC_Read(DeviceInfo.RootStartSector+sector,1,DBUF))
 477   3                              {
 478   4                              CHRspBlock.errcode=ERC_DEVICEERR;
 479   4                              return FALSE;
 480   4                              }
 481   3                      for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+32)
 482   3                              {
 483   4                              pDirInfo=(PDIR_INFO)(DBUF+i);
 484   4      
 485   4                              if(pDirInfo->startCluster==SwapINT16(ThisFile.StartCluster))
 486   4                                      {
 487   5                                      if(ThisFile.pointer>ThisFile.LengthInByte)
 488   5                                              ThisFile.LengthInByte=ThisFile.pointer;
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 9   

 489   5                                      //else ?
 490   5                                      pDirInfo->length=SwapINT32(ThisFile.LengthInByte);
 491   5                                      if(!RBC_Write(DeviceInfo.RootStartSector+sector,1,DBUF))
 492   5                                      {
 493   6                                      CHRspBlock.errcode=ERC_DEVICEERR;
 494   6                                      return FALSE;
 495   6                                      }
 496   5                                       bStop=1;
 497   5                                       break;
 498   5                                      }
 499   4                              }
 500   3                      if(bStop==1)
 501   3                              break;
 502   3                     }
 503   2              }
 504   1              CHRspBlock.len=0;
 505   1              ThisFile.bFileOpen=1;
 506   1              return TRUE;
 507   1      #undef RspBlockWriteFile
 508   1      }
 509          
 510          unsigned char RemoveFile(unsigned char *pBuffer)   //删除文件
 511          {
 512   1      #define RspBlockRemoveFile CHRspBlock.RspBlock.Rsp_RemoveFile
 513   1              unsigned int sector,i;
 514   1              unsigned char bStop,j;
 515   1              PDIR_INFO pDirInfo;
 516   1      
 517   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 518   1              {
 519   2              CHRspBlock.errcode=ERC_NODEVICE;
 520   2              return FALSE;
 521   2              }
 522   1              //RspBlockRemoveFile.result=0x1;
 523   1              ////////////// 清除目录/////////////////////////////////////
 524   1              for(sector=0;sector<DeviceInfo.BPB_RootEntCnt>>4;sector++)
 525   1                      {
 526   2                      if(!RBC_Read(DeviceInfo.RootStartSector+sector,1,DBUF))
 527   2                              {
 528   3                              CHRspBlock.errcode=ERC_DEVICEERR;
 529   3                              return FALSE;
 530   3                              }
 531   2                      for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+32)
 532   2                              {
 533   3                              if(DBUF[i]==0x00)
 534   3                                      {
 535   4                                      CHRspBlock.errcode=ERC_FILENOTFOUND;
 536   4                                      return FALSE;
 537   4                                      }
 538   3                              j=0;
 539   3                              while(DBUF[i+j]==*(pBuffer+j))
 540   3                                      {
 541   4                                       j=j+1;
 542   4                                       if(j>10) break;
 543   4                                       }
 544   3                              if(j>10)
 545   3                                      {
 546   4                                      DBUF[i]=0xE5;
 547   4                                      pDirInfo=(PDIR_INFO)(DBUF+i);
 548   4                                      ThisFile.StartCluster=SwapINT16(pDirInfo->startCluster);
 549   4                                      //DelayMs(15);
 550   4                                      if(!RBC_Write(DeviceInfo.RootStartSector+sector,1,DBUF))
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 10  

 551   4                                              {
 552   5                                              CHRspBlock.errcode=ERC_DEVICEERR;
 553   5                                              return FALSE;
 554   5                                              }
 555   4                                      //////////////////// 清除FAT中的纪录////////////////////////
 556   4                                      //DelayMs(10);
 557   4                                      if(!DeleteClusterLink(ThisFile.StartCluster))
 558   4                                                      {
 559   5                                                      CHRspBlock.errcode=ERC_DEVICEERR;
 560   5                                                      return FALSE;
 561   5                                                      }
 562   4                                      bStop=1;
 563   4                                      break;
 564   4                                      }
 565   3      
 566   3                              }//end for
 567   2                      if(bStop==1)
 568   2                              break;
 569   2                     }//end search
 570   1              if(sector>=DeviceInfo.BPB_RootEntCnt>>4)
 571   1                      {
 572   2                      CHRspBlock.errcode=ERC_FILENOTFOUND;
 573   2                              return FALSE;
 574   2                      }
 575   1              return TRUE;
 576   1      #undef RspBlockRemoveFile
 577   1      }
 578          
 579          unsigned char GetCapacity(void)
 580          {
 581   1              unsigned int sectorNum,freesectorcnt,i;
 582   1      
 583   1      #define RspBlockGetCapacity CHRspBlock.RspBlock.Rsp_GetCapacity
 584   1              PREAD_CAPACITY_RSP pBuf;
 585   1      
 586   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 587   1              {
 588   2              CHRspBlock.errcode=ERC_NODEVICE;
 589   2              return FALSE;
 590   2              }
 591   1              if(!ReadCapacity())
 592   1              {
 593   2              CHRspBlock.errcode=ERC_DEVICEERR;
 594   2              return FALSE;
 595   2              }
 596   1              pBuf=(PREAD_CAPACITY_RSP)DBUF;
 597   1              RspBlockGetCapacity.disksize=SwapINT32((pBuf->LastLBA+1)*pBuf->BlockSize);
 598   1              sectorNum=DeviceInfo.FatStartSector;
 599   1              freesectorcnt=0;
 600   1              while(sectorNum<DeviceInfo.BPB_FATSz16+DeviceInfo.FatStartSector)
 601   1              {
 602   2      
 603   2                      if(RBC_Read(sectorNum,1,DBUF))
 604   2                      {
 605   3                        for(i=0;i<DeviceInfo.BPB_BytesPerSec;i=i+2)
 606   3                              {
 607   4                               if((DBUF[i]==0xff)&&(DBUF[i+1]==0xff))
 608   4                                      {
 609   5                                      freesectorcnt++;
 610   5                                      }
 611   4                              }
 612   3                      }
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 11  

 613   2                      else
 614   2                              {
 615   3                              CHRspBlock.errcode=ERC_DEVICEERR;
 616   3                              return FALSE;
 617   3                              }
 618   2                      sectorNum++;
 619   2              }
 620   1              RspBlockGetCapacity.freedisksize=DeviceInfo.BPB_BytesPerSec*DeviceInfo.BPB_SecPerClus;
 621   1              RspBlockGetCapacity.freedisksize=freesectorcnt*RspBlockGetCapacity.freedisksize;
 622   1              RspBlockGetCapacity.freedisksize=SwapINT32(RspBlockGetCapacity.disksize)-RspBlockGetCapacity.freedisksize
             -;
 623   1              RspBlockGetCapacity.freedisksize=SwapINT32(RspBlockGetCapacity.freedisksize);
 624   1              return TRUE;
 625   1      #undef RspBlockGetCapacity
 626   1      }
 627          
 628          unsigned char GetFreeCapacity(void)
 629          {
 630   1      #define RspBlockGetCapacity CHRspBlock.RspBlock.Rsp_GetFreeCapacity
 631   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 632   1              {
 633   2              CHRspBlock.errcode=ERC_NODEVICE;
 634   2              return FALSE;
 635   2              }
 636   1              return TRUE;
 637   1      #undef RspBlockGetFreeCapacity
 638   1      }
 639          
 640          unsigned char SetFilePointer(unsigned long pointer)
 641          {
 642   1      #define RspBlockSetFilePointer CHRspBlock.RspBlock.Rsp_SetFilePointer
 643   1      
 644   1              if(!bXXGFlags.bits.SLAVE_IS_ATTACHED)
 645   1              {
 646   2              CHRspBlock.errcode=ERC_NODEVICE;
 647   2              return FALSE;
 648   2              }
 649   1              if(!ThisFile.bFileOpen)
 650   1              {
 651   2              CHRspBlock.errcode=ERC_FILENOTOPENED;
 652   2              return FALSE;
 653   2              }
 654   1              ///////////////////////////////////////////////////////////
 655   1              ThisFile.pointer=pointer;
 656   1              if(ThisFile.pointer>ThisFile.LengthInByte)
 657   1              {
 658   2              CHRspBlock.errcode=ERC_LENGTHEXCEED;
 659   2              return FALSE;
 660   2              }
 661   1      
 662   1              if(!GoToPointer(ThisFile.pointer))
 663   1              {
 664   2              ThisFile.bFileOpen=0;
 665   2              CHRspBlock.errcode=ERC_DEVICEERR;
 666   2              return FALSE;
 667   2              }
 668   1              return TRUE;
 669   1      
 670   1      #undef RspBlockSetFilePointer
 671   1      }
 672          
 673          unsigned char GetFirmwareVersion(void)
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 12  

 674          {
 675   1         #define RspBlockGetVersion CHRspBlock.RspBlock.Rsp_GetVersion
 676   1         RspBlockGetVersion.version=0x0101;
 677   1         return TRUE;
 678   1         #undef RspBlockGetVersion
 679   1      }
 680          
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 13  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION EnumMassDev (BEGIN)
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
                                           ; SOURCE LINE # 19
0000 120000      E     LCALL   mInitDisk
0003 EF                MOV     A,R7
0004 7002              JNZ     ?C0001
                                           ; SOURCE LINE # 20
0006 FF                MOV     R7,A
0007 22                RET     
0008         ?C0001:
                                           ; SOURCE LINE # 21
0008 750001      R     MOV     pMBR,#01H
000B 750000      E     MOV     pMBR+01H,#HIGH DBUF
000E 750000      E     MOV     pMBR+02H,#LOW DBUF
                                           ; SOURCE LINE # 22
0011 900000      R     MOV     DPTR,#DeviceInfo+08H
0014 7402              MOV     A,#02H
0016 F0                MOVX    @DPTR,A
0017 A3                INC     DPTR
0018 E4                CLR     A
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 23
001A 120000      E     LCALL   SPC_LockMedia
001D EF                MOV     A,R7
001E 7002              JNZ     ?C0003
                                           ; SOURCE LINE # 24
0020 FF                MOV     R7,A
0021 22                RET     
0022         ?C0003:
                                           ; SOURCE LINE # 25
0022 120000      E     LCALL   SPC_RequestSense
0025 EF                MOV     A,R7
0026 7002              JNZ     ?C0004
                                           ; SOURCE LINE # 26
0028 FF                MOV     R7,A
0029 22                RET     
002A         ?C0004:
                                           ; SOURCE LINE # 27
002A 120000      E     LCALL   SPC_TestUnit
002D EF                MOV     A,R7
002E 7002              JNZ     ?C0005
                                           ; SOURCE LINE # 28
0030 FF                MOV     R7,A
0031 22                RET     
0032         ?C0005:
                                           ; SOURCE LINE # 29
0032 120000      E     LCALL   ReadCapacity
0035 EF                MOV     A,R7
0036 7002              JNZ     ?C0006
                                           ; SOURCE LINE # 30
0038 FF                MOV     R7,A
0039 22                RET     
003A         ?C0006:
                                           ; SOURCE LINE # 31
003A 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
003D 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
0040 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
0043 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 14  

0046 7F00              MOV     R7,#00H
0048 7E00              MOV     R6,#00H
004A 7D00              MOV     R5,#00H
004C 7C00              MOV     R4,#00H
004E 120000      E     LCALL   _RBC_Read
0051 EF                MOV     A,R7
0052 7002              JNZ     ?C0007
                                           ; SOURCE LINE # 32
0054 FF                MOV     R7,A
0055 22                RET     
0056         ?C0007:
                                           ; SOURCE LINE # 33
0056 900000      E     MOV     DPTR,#DBUF
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 64EB              XRL     A,#0EBH
005D 6004              JZ      ?C0009
005F EF                MOV     A,R7
0060 B4E90C            CJNE    A,#0E9H,?C0008
0063         ?C0009:
                                           ; SOURCE LINE # 34
0063 900000      R     MOV     DPTR,#DeviceInfo
0066 120000      E     LCALL   ?C?LSTKXDATA
0069 00                DB      00H
006A 00                DB      00H
006B 00                DB      00H
006C 00                DB      00H
                                           ; SOURCE LINE # 36
006D 8015              SJMP    ?C0010
006F         ?C0008:
                                           ; SOURCE LINE # 37
                                           ; SOURCE LINE # 38
006F AB00        R     MOV     R3,pMBR
0071 AA00        R     MOV     R2,pMBR+01H
0073 A900        R     MOV     R1,pMBR+02H
0075 9001C6            MOV     DPTR,#01C6H
0078 120000      E     LCALL   ?C?LLDOPTR
007B 120000      E     LCALL   _SwapINT32
007E 900000      R     MOV     DPTR,#DeviceInfo
0081 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 40
0084         ?C0010:
                                           ; SOURCE LINE # 41
0084 750001      R     MOV     pBPB,#01H
0087 750000      E     MOV     pBPB+01H,#HIGH DBUF
008A 750000      E     MOV     pBPB+02H,#LOW DBUF
                                           ; SOURCE LINE # 42
008D 900000      R     MOV     DPTR,#DeviceInfo
0090 E0                MOVX    A,@DPTR
0091 FC                MOV     R4,A
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 FD                MOV     R5,A
0095 A3                INC     DPTR
0096 E0                MOVX    A,@DPTR
0097 FE                MOV     R6,A
0098 A3                INC     DPTR
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
009E 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
00A1 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 15  

00A4 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
00A7 120000      E     LCALL   _RBC_Read
00AA EF                MOV     A,R7
00AB 7002              JNZ     ?C0011
                                           ; SOURCE LINE # 43
00AD FF                MOV     R7,A
00AE 22                RET     
00AF         ?C0011:
                                           ; SOURCE LINE # 44
00AF AB00        R     MOV     R3,pBPB
00B1 AA00        R     MOV     R2,pBPB+01H
00B3 A900        R     MOV     R1,pBPB+02H
00B5 90000B            MOV     DPTR,#0BH
00B8 120000      E     LCALL   ?C?ILDOPTR
00BB FF                MOV     R7,A
00BC AEF0              MOV     R6,B
00BE 120000      E     LCALL   _SwapINT16
00C1 900000      R     MOV     DPTR,#DeviceInfo+08H
00C4 EE                MOV     A,R6
00C5 F0                MOVX    @DPTR,A
00C6 A3                INC     DPTR
00C7 EF                MOV     A,R7
00C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
00C9 AB00        R     MOV     R3,pBPB
00CB AA00        R     MOV     R2,pBPB+01H
00CD A900        R     MOV     R1,pBPB+02H
00CF 90000D            MOV     DPTR,#0DH
00D2 120000      E     LCALL   ?C?CLDOPTR
00D5 900000      R     MOV     DPTR,#DeviceInfo+0AH
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 46
00D9 900010            MOV     DPTR,#010H
00DC 120000      E     LCALL   ?C?CLDOPTR
00DF 900000      R     MOV     DPTR,#DeviceInfo+0BH
00E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 47
00E3 900011            MOV     DPTR,#011H
00E6 120000      E     LCALL   ?C?ILDOPTR
00E9 FF                MOV     R7,A
00EA AEF0              MOV     R6,B
00EC 120000      E     LCALL   _SwapINT16
00EF 900000      R     MOV     DPTR,#DeviceInfo+0CH
00F2 EE                MOV     A,R6
00F3 F0                MOVX    @DPTR,A
00F4 A3                INC     DPTR
00F5 EF                MOV     A,R7
00F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 48
00F7 AB00        R     MOV     R3,pBPB
00F9 AA00        R     MOV     R2,pBPB+01H
00FB A900        R     MOV     R1,pBPB+02H
00FD 900013            MOV     DPTR,#013H
0100 120000      E     LCALL   ?C?ILDOPTR
0103 FF                MOV     R7,A
0104 AEF0              MOV     R6,B
0106 120000      E     LCALL   _SwapINT16
0109 900000      R     MOV     DPTR,#DeviceInfo+0EH
010C EE                MOV     A,R6
010D F0                MOVX    @DPTR,A
010E A3                INC     DPTR
010F EF                MOV     A,R7
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 16  

0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 49
0111 AB00        R     MOV     R3,pBPB
0113 AA00        R     MOV     R2,pBPB+01H
0115 A900        R     MOV     R1,pBPB+02H
0117 900016            MOV     DPTR,#016H
011A 120000      E     LCALL   ?C?ILDOPTR
011D FF                MOV     R7,A
011E AEF0              MOV     R6,B
0120 120000      E     LCALL   _SwapINT16
0123 900000      R     MOV     DPTR,#DeviceInfo+011H
0126 EE                MOV     A,R6
0127 F0                MOVX    @DPTR,A
0128 A3                INC     DPTR
0129 EF                MOV     A,R7
012A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
012B AB00        R     MOV     R3,pBPB
012D AA00        R     MOV     R2,pBPB+01H
012F A900        R     MOV     R1,pBPB+02H
0131 900020            MOV     DPTR,#020H
0134 120000      E     LCALL   ?C?LLDOPTR
0137 120000      E     LCALL   _SwapINT32
013A 900000      R     MOV     DPTR,#DeviceInfo+01BH
013D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 51
0140 AB00        R     MOV     R3,pBPB
0142 AA00        R     MOV     R2,pBPB+01H
0144 A900        R     MOV     R1,pBPB+02H
0146 90000E            MOV     DPTR,#0EH
0149 120000      E     LCALL   ?C?CLDOPTR
014C FF                MOV     R7,A
014D E4                CLR     A
014E FC                MOV     R4,A
014F FD                MOV     R5,A
0150 FE                MOV     R6,A
0151 900000      R     MOV     DPTR,#DeviceInfo
0154 E0                MOVX    A,@DPTR
0155 F8                MOV     R0,A
0156 A3                INC     DPTR
0157 E0                MOVX    A,@DPTR
0158 F9                MOV     R1,A
0159 A3                INC     DPTR
015A E0                MOVX    A,@DPTR
015B FA                MOV     R2,A
015C A3                INC     DPTR
015D E0                MOVX    A,@DPTR
015E 2F                ADD     A,R7
015F FF                MOV     R7,A
0160 EE                MOV     A,R6
0161 3A                ADDC    A,R2
0162 FE                MOV     R6,A
0163 ED                MOV     A,R5
0164 39                ADDC    A,R1
0165 FD                MOV     R5,A
0166 EC                MOV     A,R4
0167 38                ADDC    A,R0
0168 FC                MOV     R4,A
0169 900000      R     MOV     DPTR,#DeviceInfo+038H
016C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 52
016F AA00        R     MOV     R2,pBPB+01H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 17  

0171 A900        R     MOV     R1,pBPB+02H
0173 90000E            MOV     DPTR,#0EH
0176 120000      E     LCALL   ?C?CLDOPTR
0179 FF                MOV     R7,A
017A E4                CLR     A
017B FC                MOV     R4,A
017C FD                MOV     R5,A
017D FE                MOV     R6,A
017E C004              PUSH    AR4
0180 C005              PUSH    AR5
0182 C006              PUSH    AR6
0184 AB07              MOV     R3,AR7
0186 900000      R     MOV     DPTR,#DeviceInfo+012H
0189 E0                MOVX    A,@DPTR
018A 25E0              ADD     A,ACC
018C FF                MOV     R7,A
018D 900000      R     MOV     DPTR,#DeviceInfo+011H
0190 E0                MOVX    A,@DPTR
0191 33                RLC     A
0192 FE                MOV     R6,A
0193 900000      R     MOV     DPTR,#DeviceInfo
0196 E0                MOVX    A,@DPTR
0197 F8                MOV     R0,A
0198 A3                INC     DPTR
0199 E0                MOVX    A,@DPTR
019A F9                MOV     R1,A
019B A3                INC     DPTR
019C E0                MOVX    A,@DPTR
019D FA                MOV     R2,A
019E A3                INC     DPTR
019F E0                MOVX    A,@DPTR
01A0 2F                ADD     A,R7
01A1 FF                MOV     R7,A
01A2 EA                MOV     A,R2
01A3 3E                ADDC    A,R6
01A4 FE                MOV     R6,A
01A5 ED                MOV     A,R5
01A6 39                ADDC    A,R1
01A7 FD                MOV     R5,A
01A8 EC                MOV     A,R4
01A9 38                ADDC    A,R0
01AA FC                MOV     R4,A
01AB D002              POP     AR2
01AD D001              POP     AR1
01AF D000              POP     AR0
01B1 EF                MOV     A,R7
01B2 2B                ADD     A,R3
01B3 FF                MOV     R7,A
01B4 EE                MOV     A,R6
01B5 3A                ADDC    A,R2
01B6 FE                MOV     R6,A
01B7 ED                MOV     A,R5
01B8 39                ADDC    A,R1
01B9 FD                MOV     R5,A
01BA EC                MOV     A,R4
01BB 38                ADDC    A,R0
01BC FC                MOV     R4,A
01BD 900000      R     MOV     DPTR,#DeviceInfo+03CH
01C0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 53
01C3 900000      R     MOV     DPTR,#DeviceInfo+012H
01C6 E0                MOVX    A,@DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 18  

01C7 25E0              ADD     A,ACC
01C9 FF                MOV     R7,A
01CA 900000      R     MOV     DPTR,#DeviceInfo+011H
01CD E0                MOVX    A,@DPTR
01CE 33                RLC     A
01CF FE                MOV     R6,A
01D0 E4                CLR     A
01D1 FC                MOV     R4,A
01D2 FD                MOV     R5,A
01D3 900000      R     MOV     DPTR,#DeviceInfo+038H
01D6 E0                MOVX    A,@DPTR
01D7 F8                MOV     R0,A
01D8 A3                INC     DPTR
01D9 E0                MOVX    A,@DPTR
01DA F9                MOV     R1,A
01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD FA                MOV     R2,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 2F                ADD     A,R7
01E1 FF                MOV     R7,A
01E2 EA                MOV     A,R2
01E3 3E                ADDC    A,R6
01E4 FE                MOV     R6,A
01E5 ED                MOV     A,R5
01E6 39                ADDC    A,R1
01E7 FD                MOV     R5,A
01E8 EC                MOV     A,R4
01E9 38                ADDC    A,R0
01EA FC                MOV     R4,A
01EB EF                MOV     A,R7
01EC 2420              ADD     A,#020H
01EE FF                MOV     R7,A
01EF E4                CLR     A
01F0 3E                ADDC    A,R6
01F1 FE                MOV     R6,A
01F2 E4                CLR     A
01F3 3D                ADDC    A,R5
01F4 FD                MOV     R5,A
01F5 E4                CLR     A
01F6 3C                ADDC    A,R4
01F7 FC                MOV     R4,A
01F8 900000      R     MOV     DPTR,#DeviceInfo+040H
01FB 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 54
01FE E4                CLR     A
01FF 900000      R     MOV     DPTR,#ThisFile
0202 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 55
0203 AF00        E     MOV     R7,bXXGFlags
0205 EF                MOV     A,R7
0206 4410              ORL     A,#010H
0208 F500        E     MOV     bXXGFlags,A
                                           ; SOURCE LINE # 56
020A 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 57
020C         ?C0002:
020C 22                RET     
             ; FUNCTION EnumMassDev (END)

             ; FUNCTION DetectDevice (BEGIN)
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 19  

                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 63
0000 AF00        E     MOV     R7,bXXGFlags
0002 EF                MOV     A,R7
0003 C4                SWAP    A
0004 5401              ANL     A,#01H
0006 FF                MOV     R7,A
                                           ; SOURCE LINE # 66
0007         ?C0012:
0007 22                RET     
             ; FUNCTION DetectDevice (END)

             ; FUNCTION List (BEGIN)
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 73
0000 AF00        E     MOV     R7,bXXGFlags
0002 EF                MOV     A,R7
0003 C4                SWAP    A
0004 540F              ANL     A,#0FH
0006 20E009            JB      ACC.0,?C0013
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
0009 900000      R     MOV     DPTR,#CHRspBlock+02H
000C E4                CLR     A
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 04                INC     A
                                           ; SOURCE LINE # 76
0010 805C              SJMP    ?C0182
                                           ; SOURCE LINE # 77
0012         ?C0013:
                                           ; SOURCE LINE # 78
0012 E4                CLR     A
0013 F500        R     MOV     item,A
0015 F500        R     MOV     item+01H,A
                                           ; SOURCE LINE # 79
0017 F500        R     MOV     bstop,A
                                           ; SOURCE LINE # 81
0019 F500        R     MOV     sector,A
001B         ?C0015:
001B 900000      R     MOV     DPTR,#DeviceInfo+0CH
001E E0                MOVX    A,@DPTR
001F C4                SWAP    A
0020 F8                MOV     R0,A
0021 54F0              ANL     A,#0F0H
0023 C8                XCH     A,R0
0024 68                XRL     A,R0
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 C4                SWAP    A
0029 540F              ANL     A,#0FH
002B 48                ORL     A,R0
002C FF                MOV     R7,A
002D C3                CLR     C
002E E500        R     MOV     A,sector
0030 9F                SUBB    A,R7
0031 E4                CLR     A
0032 9E                SUBB    A,R6
0033 4003              JC      $ + 5H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 20  

0035 020000      R     LJMP    ?C0016
                                           ; SOURCE LINE # 82
                                           ; SOURCE LINE # 83
0038 E4                CLR     A
0039 FC                MOV     R4,A
003A FD                MOV     R5,A
003B FE                MOV     R6,A
003C 900000      R     MOV     DPTR,#DeviceInfo+03CH
003F E0                MOVX    A,@DPTR
0040 F8                MOV     R0,A
0041 A3                INC     DPTR
0042 E0                MOVX    A,@DPTR
0043 F9                MOV     R1,A
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FA                MOV     R2,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 2500        R     ADD     A,sector
004B FF                MOV     R7,A
004C EE                MOV     A,R6
004D 3A                ADDC    A,R2
004E FE                MOV     R6,A
004F ED                MOV     A,R5
0050 39                ADDC    A,R1
0051 FD                MOV     R5,A
0052 EC                MOV     A,R4
0053 38                ADDC    A,R0
0054 FC                MOV     R4,A
0055 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
0058 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
005B 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
005E 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
0061 120000      E     LCALL   _RBC_Read
0064 EF                MOV     A,R7
0065 700B              JNZ     ?C0018
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 85
0067 900000      R     MOV     DPTR,#CHRspBlock+02H
006A F0                MOVX    @DPTR,A
006B A3                INC     DPTR
006C 740A              MOV     A,#0AH
006E         ?C0182:
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 86
006F 7F00              MOV     R7,#00H
0071 22                RET     
                                           ; SOURCE LINE # 87
0072         ?C0018:
                                           ; SOURCE LINE # 88
0072 E4                CLR     A
0073 F500        R     MOV     i,A
0075 F500        R     MOV     i+01H,A
0077         ?C0019:
0077 D3                SETB    C
0078 900000      R     MOV     DPTR,#DeviceInfo+09H
007B E0                MOVX    A,@DPTR
007C 9500        R     SUBB    A,i+01H
007E 900000      R     MOV     DPTR,#DeviceInfo+08H
0081 E0                MOVX    A,@DPTR
0082 9500        R     SUBB    A,i
0084 5003              JNC     $ + 5H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 21  

0086 020000      R     LJMP    ?C0020
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
0089 7400        E     MOV     A,#LOW DBUF
008B 2500        R     ADD     A,i+01H
008D F582              MOV     DPL,A
008F 7400        E     MOV     A,#HIGH DBUF
0091 3500        R     ADDC    A,i
0093 F583              MOV     DPH,A
0095 E0                MOVX    A,@DPTR
0096 FF                MOV     R7,A
0097 7006              JNZ     ?C0022
                                           ; SOURCE LINE # 91
0099 750001      R     MOV     bstop,#01H
                                           ; SOURCE LINE # 92
009C 020000      R     LJMP    ?C0020
009F         ?C0022:
                                           ; SOURCE LINE # 93
009F EF                MOV     A,R7
00A0 64E5              XRL     A,#0E5H
00A2 7003              JNZ     $ + 5H
00A4 020000      R     LJMP    ?C0021
                                           ; SOURCE LINE # 94
00A7         ?C0024:
                                           ; SOURCE LINE # 95
00A7 EF                MOV     A,R7
00A8 20E003            JB      ACC.0,$ + 6H
00AB 020000      R     LJMP    ?C0026
00AE 7400        E     MOV     A,#LOW DBUF+0BH
00B0 2500        R     ADD     A,i+01H
00B2 F582              MOV     DPL,A
00B4 7400        E     MOV     A,#HIGH DBUF+0BH
00B6 3500        R     ADDC    A,i
00B8 F583              MOV     DPH,A
00BA E0                MOVX    A,@DPTR
00BB F4                CPL     A
00BC 6003              JZ      $ + 5H
00BE 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 96
                                           ; SOURCE LINE # 97
00C1 7400        E     MOV     A,#LOW DBUF
00C3 2500        R     ADD     A,i+01H
00C5 F582              MOV     DPL,A
00C7 7400        E     MOV     A,#HIGH DBUF
00C9 3500        R     ADDC    A,i
00CB F583              MOV     DPH,A
00CD E0                MOVX    A,@DPTR
00CE 540F              ANL     A,#0FH
;---- Variable 'j' assigned to Register 'R1' ----
00D0 F9                MOV     R1,A
                                           ; SOURCE LINE # 98
00D1 09                INC     R1
                                           ; SOURCE LINE # 99
00D2 E4                CLR     A
00D3 F500        R     MOV     k,A
00D5         ?C0027:
00D5 E9                MOV     A,R1
00D6 75F020            MOV     B,#020H
00D9 A4                MUL     AB
00DA FF                MOV     R7,A
00DB C3                CLR     C
00DC E500        R     MOV     A,k
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 22  

00DE 9F                SUBB    A,R7
00DF E5F0              MOV     A,B
00E1 6480              XRL     A,#080H
00E3 F8                MOV     R0,A
00E4 7480              MOV     A,#080H
00E6 98                SUBB    A,R0
00E7 503A              JNC     ?C0028
                                           ; SOURCE LINE # 100
00E9 E500        R     MOV     A,k
00EB FD                MOV     R5,A
00EC 7C00              MOV     R4,#00H
00EE 2500        R     ADD     A,i+01H
00F0 FF                MOV     R7,A
00F1 EC                MOV     A,R4
00F2 3500        R     ADDC    A,i
00F4 FE                MOV     R6,A
00F5 7400        E     MOV     A,#LOW DBUF
00F7 2F                ADD     A,R7
00F8 F582              MOV     DPL,A
00FA 7400        E     MOV     A,#HIGH DBUF
00FC 3E                ADDC    A,R6
00FD F583              MOV     DPH,A
00FF E0                MOVX    A,@DPTR
0100 FB                MOV     R3,A
0101 E500        R     MOV     A,item+01H
0103 AE00        R     MOV     R6,item
0105 7805              MOV     R0,#05H
0107         ?C0167:
0107 C3                CLR     C
0108 33                RLC     A
0109 CE                XCH     A,R6
010A 33                RLC     A
010B CE                XCH     A,R6
010C D8F9              DJNZ    R0,?C0167
010E 2D                ADD     A,R5
010F FF                MOV     R7,A
0110 EE                MOV     A,R6
0111 3C                ADDC    A,R4
0112 FE                MOV     R6,A
0113 7400        R     MOV     A,#LOW CHBUF
0115 2F                ADD     A,R7
0116 F582              MOV     DPL,A
0118 7400        R     MOV     A,#HIGH CHBUF
011A 3E                ADDC    A,R6
011B F583              MOV     DPH,A
011D EB                MOV     A,R3
011E F0                MOVX    @DPTR,A
011F 0500        R     INC     k
0121 80B2              SJMP    ?C0027
0123         ?C0028:
                                           ; SOURCE LINE # 101
0123 E9                MOV     A,R1
0124 24FF              ADD     A,#0FFH
0126 FF                MOV     R7,A
0127 E4                CLR     A
0128 34FF              ADDC    A,#0FFH
012A FE                MOV     R6,A
012B EF                MOV     A,R7
012C 7805              MOV     R0,#05H
012E         ?C0168:
012E C3                CLR     C
012F 33                RLC     A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 23  

0130 CE                XCH     A,R6
0131 33                RLC     A
0132 CE                XCH     A,R6
0133 D8F9              DJNZ    R0,?C0168
0135 2500        R     ADD     A,i+01H
0137 F500        R     MOV     i+01H,A
0139 EE                MOV     A,R6
013A 3500        R     ADDC    A,i
013C F500        R     MOV     i,A
                                           ; SOURCE LINE # 102
013E E9                MOV     A,R1
013F 2500        R     ADD     A,item+01H
0141 F500        R     MOV     item+01H,A
0143 E4                CLR     A
0144 3500        R     ADDC    A,item
0146 F500        R     MOV     item,A
                                           ; SOURCE LINE # 103
0148 8048              SJMP    ?C0021
014A         ?C0026:
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 106
014A E4                CLR     A
014B F500        R     MOV     k,A
014D         ?C0031:
                                           ; SOURCE LINE # 107
014D E500        R     MOV     A,k
014F FD                MOV     R5,A
0150 7C00              MOV     R4,#00H
0152 2500        R     ADD     A,i+01H
0154 FF                MOV     R7,A
0155 EC                MOV     A,R4
0156 3500        R     ADDC    A,i
0158 FE                MOV     R6,A
0159 7400        E     MOV     A,#LOW DBUF
015B 2F                ADD     A,R7
015C F582              MOV     DPL,A
015E 7400        E     MOV     A,#HIGH DBUF
0160 3E                ADDC    A,R6
0161 F583              MOV     DPH,A
0163 E0                MOVX    A,@DPTR
0164 FB                MOV     R3,A
0165 E500        R     MOV     A,item+01H
0167 AE00        R     MOV     R6,item
0169 7805              MOV     R0,#05H
016B         ?C0169:
016B C3                CLR     C
016C 33                RLC     A
016D CE                XCH     A,R6
016E 33                RLC     A
016F CE                XCH     A,R6
0170 D8F9              DJNZ    R0,?C0169
0172 2D                ADD     A,R5
0173 FF                MOV     R7,A
0174 EE                MOV     A,R6
0175 3C                ADDC    A,R4
0176 FE                MOV     R6,A
0177 7400        R     MOV     A,#LOW CHBUF
0179 2F                ADD     A,R7
017A F582              MOV     DPL,A
017C 7400        R     MOV     A,#HIGH CHBUF
017E 3E                ADDC    A,R6
017F F583              MOV     DPH,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 24  

0181 EB                MOV     A,R3
0182 F0                MOVX    @DPTR,A
0183 0500        R     INC     k
0185 E500        R     MOV     A,k
0187 B420C3            CJNE    A,#020H,?C0031
018A         ?C0032:
                                           ; SOURCE LINE # 108
018A 0500        R     INC     item+01H
018C E500        R     MOV     A,item+01H
018E 7002              JNZ     ?C0170
0190 0500        R     INC     item
0192         ?C0170:
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 110
0192         ?C0021:
0192 7420              MOV     A,#020H
0194 2500        R     ADD     A,i+01H
0196 F500        R     MOV     i+01H,A
0198 E4                CLR     A
0199 3500        R     ADDC    A,i
019B F500        R     MOV     i,A
019D 020000      R     LJMP    ?C0019
01A0         ?C0020:
                                           ; SOURCE LINE # 111
01A0 E500        R     MOV     A,bstop
01A2 6401              XRL     A,#01H
01A4 6005              JZ      ?C0016
                                           ; SOURCE LINE # 112
01A6         ?C0017:
01A6 0500        R     INC     sector
01A8 020000      R     LJMP    ?C0015
01AB         ?C0016:
                                           ; SOURCE LINE # 114
01AB E500        R     MOV     A,item+01H
01AD AE00        R     MOV     R6,item
01AF 7805              MOV     R0,#05H
01B1         ?C0171:
01B1 C3                CLR     C
01B2 33                RLC     A
01B3 CE                XCH     A,R6
01B4 33                RLC     A
01B5 CE                XCH     A,R6
01B6 D8F9              DJNZ    R0,?C0171
01B8 FF                MOV     R7,A
01B9 120000      E     LCALL   _SwapINT16
01BC 900000      R     MOV     DPTR,#CHRspBlock+04H
01BF EE                MOV     A,R6
01C0 F0                MOVX    @DPTR,A
01C1 A3                INC     DPTR
01C2 EF                MOV     A,R7
01C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 115
01C4 E500        R     MOV     A,item+01H
01C6 AE00        R     MOV     R6,item
01C8 7805              MOV     R0,#05H
01CA         ?C0172:
01CA C3                CLR     C
01CB 33                RLC     A
01CC CE                XCH     A,R6
01CD 33                RLC     A
01CE CE                XCH     A,R6
01CF D8F9              DJNZ    R0,?C0172
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 25  

01D1 900000      R     MOV     DPTR,#CHRspBlock+041H
01D4 F0                MOVX    @DPTR,A
01D5 EE                MOV     A,R6
01D6 900000      R     MOV     DPTR,#CHRspBlock+040H
01D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 116
01DA 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 120
01DC         ?C0014:
01DC 22                RET     
             ; FUNCTION List (END)

             ; FUNCTION _OpenFile (BEGIN)
                                           ; SOURCE LINE # 121
0000 8B00        R     MOV     pBuffer,R3
0002 8A00        R     MOV     pBuffer+01H,R2
0004 8900        R     MOV     pBuffer+02H,R1
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 128
0006 AF00        E     MOV     R7,bXXGFlags
0008 EF                MOV     A,R7
0009 C4                SWAP    A
000A 540F              ANL     A,#0FH
000C 20E00A            JB      ACC.0,?C0035
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
000F 900000      R     MOV     DPTR,#CHRspBlock+02H
0012 E4                CLR     A
0013 F0                MOVX    @DPTR,A
0014 A3                INC     DPTR
0015 04                INC     A
                                           ; SOURCE LINE # 131
0016 020000      R     LJMP    ?C0185
                                           ; SOURCE LINE # 132
0019         ?C0035:
                                           ; SOURCE LINE # 133
0019 E4                CLR     A
001A 900000      R     MOV     DPTR,#ThisFile
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 136
001E F500        R     MOV     sector,A
0020         ?C0037:
0020 900000      R     MOV     DPTR,#DeviceInfo+0CH
0023 E0                MOVX    A,@DPTR
0024 C4                SWAP    A
0025 F8                MOV     R0,A
0026 54F0              ANL     A,#0F0H
0028 C8                XCH     A,R0
0029 68                XRL     A,R0
002A FE                MOV     R6,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D C4                SWAP    A
002E 540F              ANL     A,#0FH
0030 48                ORL     A,R0
0031 FF                MOV     R7,A
0032 C3                CLR     C
0033 E500        R     MOV     A,sector
0035 9F                SUBB    A,R7
0036 E4                CLR     A
0037 9E                SUBB    A,R6
0038 4003              JC      $ + 5H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 26  

003A 020000      R     LJMP    ?C0038
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 138
003D E4                CLR     A
003E FC                MOV     R4,A
003F FD                MOV     R5,A
0040 FE                MOV     R6,A
0041 900000      R     MOV     DPTR,#DeviceInfo+03CH
0044 E0                MOVX    A,@DPTR
0045 F8                MOV     R0,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 F9                MOV     R1,A
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B FA                MOV     R2,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E 2500        R     ADD     A,sector
0050 FF                MOV     R7,A
0051 EE                MOV     A,R6
0052 3A                ADDC    A,R2
0053 FE                MOV     R6,A
0054 ED                MOV     A,R5
0055 39                ADDC    A,R1
0056 FD                MOV     R5,A
0057 EC                MOV     A,R4
0058 38                ADDC    A,R0
0059 FC                MOV     R4,A
005A 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
005D 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
0060 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
0063 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
0066 120000      E     LCALL   _RBC_Read
0069 EF                MOV     A,R7
006A 700A              JNZ     ?C0040
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
006C 900000      R     MOV     DPTR,#CHRspBlock+02H
006F F0                MOVX    @DPTR,A
0070 A3                INC     DPTR
0071 740A              MOV     A,#0AH
0073         ?C0183:
                                           ; SOURCE LINE # 141
0073 020000      R     LJMP    ?C0185
                                           ; SOURCE LINE # 143
0076         ?C0040:
                                           ; SOURCE LINE # 144
0076 E4                CLR     A
0077 F500        R     MOV     i,A
0079 F500        R     MOV     i+01H,A
007B         ?C0041:
007B D3                SETB    C
007C 900000      R     MOV     DPTR,#DeviceInfo+09H
007F E0                MOVX    A,@DPTR
0080 9500        R     SUBB    A,i+01H
0082 900000      R     MOV     DPTR,#DeviceInfo+08H
0085 E0                MOVX    A,@DPTR
0086 9500        R     SUBB    A,i
0088 5003              JNC     $ + 5H
008A 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 145
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 27  

                                           ; SOURCE LINE # 146
008D 7400        E     MOV     A,#LOW DBUF
008F 2500        R     ADD     A,i+01H
0091 F582              MOV     DPL,A
0093 7400        E     MOV     A,#HIGH DBUF
0095 3500        R     ADDC    A,i
0097 F583              MOV     DPH,A
0099 E0                MOVX    A,@DPTR
009A 700A              JNZ     ?C0044
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 148
009C 900000      R     MOV     DPTR,#CHRspBlock+02H
009F F0                MOVX    @DPTR,A
00A0 A3                INC     DPTR
00A1 7411              MOV     A,#011H
00A3         ?C0184:
                                           ; SOURCE LINE # 149
00A3 020000      R     LJMP    ?C0185
                                           ; SOURCE LINE # 150
00A6         ?C0044:
                                           ; SOURCE LINE # 151
00A6 E4                CLR     A
00A7 F500        R     MOV     j,A
00A9         ?C0045:
                                           ; SOURCE LINE # 152
00A9 AB00        R     MOV     R3,pBuffer
00AB AA00        R     MOV     R2,pBuffer+01H
00AD A900        R     MOV     R1,pBuffer+02H
00AF 850082      R     MOV     DPL,j
00B2 758300            MOV     DPH,#00H
00B5 120000      E     LCALL   ?C?CLDOPTR
00B8 FF                MOV     R7,A
00B9 E500        R     MOV     A,j
00BB 7C00              MOV     R4,#00H
00BD 2500        R     ADD     A,i+01H
00BF FD                MOV     R5,A
00C0 EC                MOV     A,R4
00C1 3500        R     ADDC    A,i
00C3 FC                MOV     R4,A
00C4 7400        E     MOV     A,#LOW DBUF
00C6 2D                ADD     A,R5
00C7 F582              MOV     DPL,A
00C9 7400        E     MOV     A,#HIGH DBUF
00CB 3C                ADDC    A,R4
00CC F583              MOV     DPH,A
00CE E0                MOVX    A,@DPTR
00CF B50709            CJNE    A,AR7,?C0046
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
00D2 0500        R     INC     j
                                           ; SOURCE LINE # 155
00D4 E500        R     MOV     A,j
00D6 D3                SETB    C
00D7 940A              SUBB    A,#0AH
00D9 40CE              JC      ?C0045
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 157
00DB         ?C0046:
                                           ; SOURCE LINE # 159
00DB E500        R     MOV     A,j
00DD D3                SETB    C
00DE 940A              SUBB    A,#0AH
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 28  

00E0 4038              JC      ?C0043
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 161
00E2 E4                CLR     A
00E3 F500        R     MOV     j,A
00E5         ?C0049:
                                           ; SOURCE LINE # 162
00E5 7E00              MOV     R6,#00H
00E7 E500        R     MOV     A,i+01H
00E9 2500        R     ADD     A,j
00EB FF                MOV     R7,A
00EC EE                MOV     A,R6
00ED 3500        R     ADDC    A,i
00EF FE                MOV     R6,A
00F0 7400        E     MOV     A,#LOW DBUF
00F2 2F                ADD     A,R7
00F3 F582              MOV     DPL,A
00F5 7400        E     MOV     A,#HIGH DBUF
00F7 3E                ADDC    A,R6
00F8 F583              MOV     DPH,A
00FA E0                MOVX    A,@DPTR
00FB FF                MOV     R7,A
00FC 7400        R     MOV     A,#LOW CHRspBlock+04H
00FE 2500        R     ADD     A,j
0100 F582              MOV     DPL,A
0102 E4                CLR     A
0103 3400        R     ADDC    A,#HIGH CHRspBlock+04H
0105 F583              MOV     DPH,A
0107 EF                MOV     A,R7
0108 F0                MOVX    @DPTR,A
0109 0500        R     INC     j
010B E500        R     MOV     A,j
010D B420D5            CJNE    A,#020H,?C0049
0110         ?C0050:
                                           ; SOURCE LINE # 164
0110 900000      R     MOV     DPTR,#ThisFile
0113 7401              MOV     A,#01H
0115 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 165
0116 F500        R     MOV     bstop,A
                                           ; SOURCE LINE # 166
0118 800E              SJMP    ?C0042
                                           ; SOURCE LINE # 168
011A         ?C0043:
011A 7420              MOV     A,#020H
011C 2500        R     ADD     A,i+01H
011E F500        R     MOV     i+01H,A
0120 E4                CLR     A
0121 3500        R     ADDC    A,i
0123 F500        R     MOV     i,A
0125 020000      R     LJMP    ?C0041
0128         ?C0042:
                                           ; SOURCE LINE # 169
0128 E500        R     MOV     A,bstop
012A 6401              XRL     A,#01H
012C 6005              JZ      ?C0038
                                           ; SOURCE LINE # 170
012E         ?C0039:
012E 0500        R     INC     sector
0130 020000      R     LJMP    ?C0037
0133         ?C0038:
                                           ; SOURCE LINE # 172
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 29  

0133 900000      R     MOV     DPTR,#DeviceInfo+0CH
0136 E0                MOVX    A,@DPTR
0137 C4                SWAP    A
0138 F8                MOV     R0,A
0139 54F0              ANL     A,#0F0H
013B C8                XCH     A,R0
013C 68                XRL     A,R0
013D FE                MOV     R6,A
013E A3                INC     DPTR
013F E0                MOVX    A,@DPTR
0140 C4                SWAP    A
0141 540F              ANL     A,#0FH
0143 48                ORL     A,R0
0144 FF                MOV     R7,A
0145 C3                CLR     C
0146 E500        R     MOV     A,sector
0148 9F                SUBB    A,R7
0149 E4                CLR     A
014A 9E                SUBB    A,R6
014B 400C              JC      ?C0053
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
014D 900000      R     MOV     DPTR,#CHRspBlock+02H
0150 E4                CLR     A
0151 F0                MOVX    @DPTR,A
0152 A3                INC     DPTR
0153 7411              MOV     A,#011H
0155         ?C0185:
0155 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0156 7F00              MOV     R7,#00H
0158 22                RET     
                                           ; SOURCE LINE # 176
0159         ?C0053:
                                           ; SOURCE LINE # 177
0159 7B01              MOV     R3,#01H
015B 7A00        R     MOV     R2,#HIGH CHRspBlock+04H
015D 7900        R     MOV     R1,#LOW CHRspBlock+04H
015F 8B00        R     MOV     pDirInfo,R3
0161 8A00        R     MOV     pDirInfo+01H,R2
0163 8900        R     MOV     pDirInfo+02H,R1
                                           ; SOURCE LINE # 178
0165 90001A            MOV     DPTR,#01AH
0168 120000      E     LCALL   ?C?ILDOPTR
016B FF                MOV     R7,A
016C AEF0              MOV     R6,B
016E 120000      E     LCALL   _SwapINT16
0171 900000      R     MOV     DPTR,#ThisFile+01H
0174 EE                MOV     A,R6
0175 F0                MOVX    @DPTR,A
0176 A3                INC     DPTR
0177 EF                MOV     A,R7
0178 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 179
0179 AB00        R     MOV     R3,pDirInfo
017B AA00        R     MOV     R2,pDirInfo+01H
017D A900        R     MOV     R1,pDirInfo+02H
017F 90001C            MOV     DPTR,#01CH
0182 120000      E     LCALL   ?C?LLDOPTR
0185 120000      E     LCALL   _SwapINT32
0188 900000      R     MOV     DPTR,#ThisFile+03H
018B 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 30  

                                           ; SOURCE LINE # 180
018E 900000      R     MOV     DPTR,#ThisFile+01H
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
0193 A3                INC     DPTR
0194 E0                MOVX    A,@DPTR
0195 900000      R     MOV     DPTR,#ThisFile+07H
0198 CF                XCH     A,R7
0199 F0                MOVX    @DPTR,A
019A A3                INC     DPTR
019B EF                MOV     A,R7
019C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 181
019D 900000      R     MOV     DPTR,#ThisFile+01H
01A0 E0                MOVX    A,@DPTR
01A1 FE                MOV     R6,A
01A2 A3                INC     DPTR
01A3 E0                MOVX    A,@DPTR
01A4 FF                MOV     R7,A
01A5 120000      E     LCALL   _FirstSectorofCluster
01A8 900000      R     MOV     DPTR,#ThisFile+09H
01AB 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 182
01AE E4                CLR     A
01AF 900000      R     MOV     DPTR,#ThisFile+0DH
01B2 F0                MOVX    @DPTR,A
01B3 A3                INC     DPTR
01B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 183
01B5 A3                INC     DPTR
01B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 184
01B7 900000      R     MOV     DPTR,#ThisFile+014H
01BA F0                MOVX    @DPTR,A
01BB A3                INC     DPTR
01BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 186
01BD 900000      R     MOV     DPTR,#ThisFile+010H
01C0 120000      E     LCALL   ?C?LSTKXDATA
01C3 00                DB      00H
01C4 00                DB      00H
01C5 00                DB      00H
01C6 00                DB      00H
                                           ; SOURCE LINE # 187
01C7 900000      R     MOV     DPTR,#DeviceInfo+038H
01CA E0                MOVX    A,@DPTR
01CB FC                MOV     R4,A
01CC A3                INC     DPTR
01CD E0                MOVX    A,@DPTR
01CE FD                MOV     R5,A
01CF A3                INC     DPTR
01D0 E0                MOVX    A,@DPTR
01D1 FE                MOV     R6,A
01D2 A3                INC     DPTR
01D3 E0                MOVX    A,@DPTR
01D4 FF                MOV     R7,A
01D5 900000      E     MOV     DPTR,#FreeFat
01D8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 188
01DB 900000      R     MOV     DPTR,#DeviceInfo+038H
01DE E0                MOVX    A,@DPTR
01DF FC                MOV     R4,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 31  

01E0 A3                INC     DPTR
01E1 E0                MOVX    A,@DPTR
01E2 FD                MOV     R5,A
01E3 A3                INC     DPTR
01E4 E0                MOVX    A,@DPTR
01E5 FE                MOV     R6,A
01E6 A3                INC     DPTR
01E7 E0                MOVX    A,@DPTR
01E8 FF                MOV     R7,A
01E9 900000      E     MOV     DPTR,#FreeFat+06H
01EC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 189
01EF 900000      E     MOV     DPTR,#FreeFat+04H
01F2 E4                CLR     A
01F3 F0                MOVX    @DPTR,A
01F4 A3                INC     DPTR
01F5 7402              MOV     A,#02H
01F7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 191
01F8 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 193
01FA         ?C0036:
01FA 22                RET     
             ; FUNCTION _OpenFile (END)

             ; FUNCTION _ReadFile (BEGIN)
                                           ; SOURCE LINE # 195
0000 8E00        R     MOV     readLength,R6
0002 8F00        R     MOV     readLength+01H,R7
0004 8B00        R     MOV     pBuffer,R3
0006 8A00        R     MOV     pBuffer+01H,R2
0008 8900        R     MOV     pBuffer+02H,R1
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 200
000A AF00        E     MOV     R7,bXXGFlags
000C EF                MOV     A,R7
000D C4                SWAP    A
000E 540F              ANL     A,#0FH
0010 20E00A            JB      ACC.0,?C0054
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
0013 900000      R     MOV     DPTR,#CHRspBlock+02H
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
0018 A3                INC     DPTR
0019 04                INC     A
                                           ; SOURCE LINE # 203
001A 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 204
001D         ?C0054:
                                           ; SOURCE LINE # 205
001D 900000      R     MOV     DPTR,#ThisFile
0020 E0                MOVX    A,@DPTR
0021 700A              JNZ     ?C0056
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 207
0023 900000      R     MOV     DPTR,#CHRspBlock+02H
0026 F0                MOVX    @DPTR,A
0027 A3                INC     DPTR
0028 7414              MOV     A,#014H
002A         ?C0186:
                                           ; SOURCE LINE # 208
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 32  

002A 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 209
002D         ?C0056:
                                           ; SOURCE LINE # 210
002D E4                CLR     A
002E 900000      R     MOV     DPTR,#ThisFile
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 211
0032 750001      R     MOV     bSuccess,#01H
                                           ; SOURCE LINE # 212
0035 900000      R     MOV     DPTR,#CHRspBlock+040H
0038 F0                MOVX    @DPTR,A
0039 A3                INC     DPTR
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 213
003B D3                SETB    C
003C E500        R     MOV     A,readLength+01H
003E 9400              SUBB    A,#00H
0040 E500        R     MOV     A,readLength
0042 9470              SUBB    A,#070H
0044 400B              JC      ?C0057
                                           ; SOURCE LINE # 214
                                           ; SOURCE LINE # 215
0046 900000      R     MOV     DPTR,#CHRspBlock+02H
0049 E4                CLR     A
004A F0                MOVX    @DPTR,A
004B A3                INC     DPTR
004C 7412              MOV     A,#012H
004E         ?C0187:
                                           ; SOURCE LINE # 216
004E 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 217
0051         ?C0057:
                                           ; SOURCE LINE # 218
0051 E4                CLR     A
0052 FC                MOV     R4,A
0053 FD                MOV     R5,A
0054 900000      R     MOV     DPTR,#ThisFile+010H
0057 E0                MOVX    A,@DPTR
0058 F8                MOV     R0,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B F9                MOV     R1,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FA                MOV     R2,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 2500        R     ADD     A,readLength+01H
0063 FF                MOV     R7,A
0064 EA                MOV     A,R2
0065 3500        R     ADDC    A,readLength
0067 FE                MOV     R6,A
0068 ED                MOV     A,R5
0069 39                ADDC    A,R1
006A FD                MOV     R5,A
006B EC                MOV     A,R4
006C 38                ADDC    A,R0
006D FC                MOV     R4,A
006E 900000      R     MOV     DPTR,#ThisFile+03H
0071 E0                MOVX    A,@DPTR
0072 F8                MOV     R0,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 33  

0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F9                MOV     R1,A
0076 A3                INC     DPTR
0077 E0                MOVX    A,@DPTR
0078 FA                MOV     R2,A
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B FB                MOV     R3,A
007C C3                CLR     C
007D 120000      E     LCALL   ?C?ULCMP
0080 500B              JNC     ?C0059
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
0082 900000      R     MOV     DPTR,#CHRspBlock+02H
0085 E4                CLR     A
0086 F0                MOVX    @DPTR,A
0087 A3                INC     DPTR
0088 7412              MOV     A,#012H
008A         ?C0188:
                                           ; SOURCE LINE # 221
008A 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 222
008D         ?C0059:
                                           ; SOURCE LINE # 223
008D D3                SETB    C
008E E500        R     MOV     A,readLength+01H
0090 9400              SUBB    A,#00H
0092 E500        R     MOV     A,readLength
0094 9400              SUBB    A,#00H
0096 5003              JNC     $ + 5H
0098 020000      R     LJMP    ?C0060
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
009B 900000      R     MOV     DPTR,#ThisFile+0EH
009E E0                MOVX    A,@DPTR
009F 2500        R     ADD     A,readLength+01H
00A1 FF                MOV     R7,A
00A2 900000      R     MOV     DPTR,#ThisFile+0DH
00A5 E0                MOVX    A,@DPTR
00A6 3500        R     ADDC    A,readLength
00A8 FE                MOV     R6,A
00A9 900000      R     MOV     DPTR,#DeviceInfo+08H
00AC E0                MOVX    A,@DPTR
00AD FC                MOV     R4,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 FD                MOV     R5,A
00B1 C3                CLR     C
00B2 9F                SUBB    A,R7
00B3 EC                MOV     A,R4
00B4 9E                SUBB    A,R6
00B5 7800        R     MOV     R0,#LOW len
00B7 5007              JNC     ?C0061
                                           ; SOURCE LINE # 226
00B9 A604              MOV     @R0,AR4
00BB 08                INC     R0
00BC A605              MOV     @R0,AR5
00BE 8005              SJMP    ?C0062
00C0         ?C0061:
                                           ; SOURCE LINE # 228
00C0 A606              MOV     @R0,AR6
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 34  

00C2 08                INC     R0
00C3 A607              MOV     @R0,AR7
00C5         ?C0062:
                                           ; SOURCE LINE # 229
00C5 D3                SETB    C
00C6 900000      R     MOV     DPTR,#ThisFile+0EH
00C9 E0                MOVX    A,@DPTR
00CA 9400              SUBB    A,#00H
00CC 900000      R     MOV     DPTR,#ThisFile+0DH
00CF E0                MOVX    A,@DPTR
00D0 9400              SUBB    A,#00H
00D2 5003              JNC     $ + 5H
00D4 020000      R     LJMP    ?C0063
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
00D7 900000      R     MOV     DPTR,#ThisFile+09H
00DA E0                MOVX    A,@DPTR
00DB FC                MOV     R4,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FD                MOV     R5,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FE                MOV     R6,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FF                MOV     R7,A
00E5 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
00E8 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
00EB 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
00EE 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
00F1 120000      E     LCALL   _RBC_Read
00F4 EF                MOV     A,R7
00F5 6073              JZ      ?C0064
                                           ; SOURCE LINE # 232
                                           ; SOURCE LINE # 233
00F7 900000      R     MOV     DPTR,#ThisFile+0DH
00FA E0                MOVX    A,@DPTR
00FB FE                MOV     R6,A
00FC A3                INC     DPTR
00FD E0                MOVX    A,@DPTR
00FE FF                MOV     R7,A
00FF C3                CLR     C
0100 7800        R     MOV     R0,#LOW len+01H
0102 E6                MOV     A,@R0
0103 9F                SUBB    A,R7
0104 F6                MOV     @R0,A
0105 18                DEC     R0
0106 E6                MOV     A,@R0
0107 9E                SUBB    A,R6
0108 F6                MOV     @R0,A
                                           ; SOURCE LINE # 234
0109 E4                CLR     A
010A 7800        R     MOV     R0,#LOW i
010C F6                MOV     @R0,A
010D 08                INC     R0
010E F6                MOV     @R0,A
010F         ?C0065:
010F 7800        R     MOV     R0,#LOW i
0111 E6                MOV     A,@R0
0112 FE                MOV     R6,A
0113 08                INC     R0
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 35  

0114 E6                MOV     A,@R0
0115 FF                MOV     R7,A
0116 C3                CLR     C
0117 7800        R     MOV     R0,#LOW len+01H
0119 96                SUBB    A,@R0
011A EE                MOV     A,R6
011B 18                DEC     R0
011C 96                SUBB    A,@R0
011D 5036              JNC     ?C0066
                                           ; SOURCE LINE # 235
011F 900000      R     MOV     DPTR,#ThisFile+0EH
0122 E0                MOVX    A,@DPTR
0123 2F                ADD     A,R7
0124 FF                MOV     R7,A
0125 900000      R     MOV     DPTR,#ThisFile+0DH
0128 E0                MOVX    A,@DPTR
0129 3E                ADDC    A,R6
012A FE                MOV     R6,A
012B 7400        E     MOV     A,#LOW DBUF
012D 2F                ADD     A,R7
012E F582              MOV     DPL,A
0130 7400        E     MOV     A,#HIGH DBUF
0132 3E                ADDC    A,R6
0133 F583              MOV     DPH,A
0135 E0                MOVX    A,@DPTR
0136 FF                MOV     R7,A
0137 AB00        R     MOV     R3,pBuffer
0139 AA00        R     MOV     R2,pBuffer+01H
013B A900        R     MOV     R1,pBuffer+02H
013D 7800        R     MOV     R0,#LOW i
013F E6                MOV     A,@R0
0140 FC                MOV     R4,A
0141 08                INC     R0
0142 E6                MOV     A,@R0
0143 F582              MOV     DPL,A
0145 8C83              MOV     DPH,R4
0147 EF                MOV     A,R7
0148 120000      E     LCALL   ?C?CSTOPTR
014B 7800        R     MOV     R0,#LOW i+01H
014D 06                INC     @R0
014E E6                MOV     A,@R0
014F 18                DEC     R0
0150 70BD              JNZ     ?C0065
0152 06                INC     @R0
0153         ?C0173:
0153 80BA              SJMP    ?C0065
0155         ?C0066:
                                           ; SOURCE LINE # 236
0155 7800        R     MOV     R0,#LOW len
0157 E6                MOV     A,@R0
0158 FE                MOV     R6,A
0159 08                INC     R0
015A E6                MOV     A,@R0
015B FF                MOV     R7,A
015C 900000      R     MOV     DPTR,#ThisFile+0EH
015F E0                MOVX    A,@DPTR
0160 2F                ADD     A,R7
0161 F0                MOVX    @DPTR,A
0162 900000      R     MOV     DPTR,#ThisFile+0DH
0165 E0                MOVX    A,@DPTR
0166 3E                ADDC    A,R6
0167 F0                MOVX    @DPTR,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 36  

                                           ; SOURCE LINE # 237
0168 804E              SJMP    ?C0069
016A         ?C0064:
                                           ; SOURCE LINE # 239
                                           ; SOURCE LINE # 240
016A 900000      R     MOV     DPTR,#CHRspBlock+02H
016D E4                CLR     A
016E F0                MOVX    @DPTR,A
016F A3                INC     DPTR
0170 740A              MOV     A,#0AH
0172         ?C0189:
                                           ; SOURCE LINE # 241
0172 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 242
                                           ; SOURCE LINE # 243
0175         ?C0063:
                                           ; SOURCE LINE # 245
                                           ; SOURCE LINE # 246
0175 900000      R     MOV     DPTR,#ThisFile+09H
0178 E0                MOVX    A,@DPTR
0179 FC                MOV     R4,A
017A A3                INC     DPTR
017B E0                MOVX    A,@DPTR
017C FD                MOV     R5,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F FE                MOV     R6,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FF                MOV     R7,A
0183 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
0186 900000      R     MOV     DPTR,#CHRspBlock+040H
0189 E0                MOVX    A,@DPTR
018A F8                MOV     R0,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D 2500        R     ADD     A,pBuffer+02H
018F F9                MOV     R1,A
0190 E500        R     MOV     A,pBuffer+01H
0192 38                ADDC    A,R0
0193 850000      E     MOV     ?_RBC_Read?BYTE+05H,pBuffer
0196 F500        E     MOV     ?_RBC_Read?BYTE+06H,A
0198 8900        E     MOV     ?_RBC_Read?BYTE+07H,R1
019A 120000      E     LCALL   _RBC_Read
019D EF                MOV     A,R7
019E 700A              JNZ     ?C0070
                                           ; SOURCE LINE # 247
                                           ; SOURCE LINE # 248
01A0 900000      R     MOV     DPTR,#CHRspBlock+02H
01A3 F0                MOVX    @DPTR,A
01A4 A3                INC     DPTR
01A5 740A              MOV     A,#0AH
01A7         ?C0190:
                                           ; SOURCE LINE # 249
01A7 020000      R     LJMP    ?C0191
                                           ; SOURCE LINE # 250
01AA         ?C0070:
                                           ; SOURCE LINE # 251
01AA 7800        R     MOV     R0,#LOW len
01AC E6                MOV     A,@R0
01AD FF                MOV     R7,A
01AE 08                INC     R0
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 37  

01AF E6                MOV     A,@R0
01B0 900000      R     MOV     DPTR,#ThisFile+0DH
01B3 CF                XCH     A,R7
01B4 F0                MOVX    @DPTR,A
01B5 A3                INC     DPTR
01B6 EF                MOV     A,R7
01B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
01B8         ?C0069:
                                           ; SOURCE LINE # 255
01B8 7800        R     MOV     R0,#LOW len
01BA E6                MOV     A,@R0
01BB FE                MOV     R6,A
01BC 08                INC     R0
01BD E6                MOV     A,@R0
01BE FF                MOV     R7,A
01BF C3                CLR     C
01C0 E500        R     MOV     A,readLength+01H
01C2 9F                SUBB    A,R7
01C3 F500        R     MOV     readLength+01H,A
01C5 E500        R     MOV     A,readLength
01C7 9E                SUBB    A,R6
01C8 F500        R     MOV     readLength,A
                                           ; SOURCE LINE # 256
01CA 900000      R     MOV     DPTR,#CHRspBlock+041H
01CD E0                MOVX    A,@DPTR
01CE 2F                ADD     A,R7
01CF F0                MOVX    @DPTR,A
01D0 900000      R     MOV     DPTR,#CHRspBlock+040H
01D3 E0                MOVX    A,@DPTR
01D4 3E                ADDC    A,R6
01D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 257
01D6 900000      R     MOV     DPTR,#DeviceInfo+09H
01D9 E0                MOVX    A,@DPTR
01DA 24FF              ADD     A,#0FFH
01DC FF                MOV     R7,A
01DD 900000      R     MOV     DPTR,#DeviceInfo+08H
01E0 E0                MOVX    A,@DPTR
01E1 34FF              ADDC    A,#0FFH
01E3 FE                MOV     R6,A
01E4 900000      R     MOV     DPTR,#ThisFile+0DH
01E7 E0                MOVX    A,@DPTR
01E8 FC                MOV     R4,A
01E9 A3                INC     DPTR
01EA E0                MOVX    A,@DPTR
01EB FD                MOV     R5,A
01EC D3                SETB    C
01ED 9F                SUBB    A,R7
01EE EC                MOV     A,R4
01EF 9E                SUBB    A,R6
01F0 5003              JNC     $ + 5H
01F2 020000      R     LJMP    ?C0059
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
01F5 900000      R     MOV     DPTR,#DeviceInfo+08H
01F8 E0                MOVX    A,@DPTR
01F9 FE                MOV     R6,A
01FA A3                INC     DPTR
01FB E0                MOVX    A,@DPTR
01FC FF                MOV     R7,A
01FD ED                MOV     A,R5
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 38  

01FE 9F                SUBB    A,R7
01FF FF                MOV     R7,A
0200 EC                MOV     A,R4
0201 9E                SUBB    A,R6
0202 900000      R     MOV     DPTR,#ThisFile+0DH
0205 F0                MOVX    @DPTR,A
0206 A3                INC     DPTR
0207 EF                MOV     A,R7
0208 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 260
0209 A3                INC     DPTR
020A E0                MOVX    A,@DPTR
020B 04                INC     A
020C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 261
020D 900000      R     MOV     DPTR,#DeviceInfo+0AH
0210 E0                MOVX    A,@DPTR
0211 14                DEC     A
0212 FF                MOV     R7,A
0213 900000      R     MOV     DPTR,#ThisFile+0FH
0216 E0                MOVX    A,@DPTR
0217 D3                SETB    C
0218 9F                SUBB    A,R7
0219 4036              JC      ?C0072
                                           ; SOURCE LINE # 262
                                           ; SOURCE LINE # 263
021B E4                CLR     A
021C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
021D 900000      R     MOV     DPTR,#ThisFile+07H
0220 E0                MOVX    A,@DPTR
0221 FE                MOV     R6,A
0222 A3                INC     DPTR
0223 E0                MOVX    A,@DPTR
0224 FF                MOV     R7,A
0225 120000      E     LCALL   _GetNextClusterNum
0228 900000      R     MOV     DPTR,#ThisFile+07H
022B EE                MOV     A,R6
022C F0                MOVX    @DPTR,A
022D A3                INC     DPTR
022E EF                MOV     A,R7
022F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 265
0230 D3                SETB    C
0231 94EF              SUBB    A,#0EFH
0233 EE                MOV     A,R6
0234 94FF              SUBB    A,#0FFH
0236 400C              JC      ?C0073
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 269
0238 900000      R     MOV     DPTR,#CHRspBlock+02H
023B E4                CLR     A
023C F0                MOVX    @DPTR,A
023D A3                INC     DPTR
023E 7413              MOV     A,#013H
0240         ?C0191:
0240 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 270
0241 7F00              MOV     R7,#00H
0243 22                RET     
                                           ; SOURCE LINE # 271
0244         ?C0073:
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 39  

                                           ; SOURCE LINE # 272
0244 900000      R     MOV     DPTR,#ThisFile+07H
0247 E0                MOVX    A,@DPTR
0248 FE                MOV     R6,A
0249 A3                INC     DPTR
024A E0                MOVX    A,@DPTR
024B FF                MOV     R7,A
024C 120000      E     LCALL   _FirstSectorofCluster
                                           ; SOURCE LINE # 273
024F 8019              SJMP    ?C0192
0251         ?C0072:
                                           ; SOURCE LINE # 275
0251 900000      R     MOV     DPTR,#ThisFile+09H
0254 E0                MOVX    A,@DPTR
0255 FC                MOV     R4,A
0256 A3                INC     DPTR
0257 E0                MOVX    A,@DPTR
0258 FD                MOV     R5,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B FE                MOV     R6,A
025C A3                INC     DPTR
025D E0                MOVX    A,@DPTR
025E 2401              ADD     A,#01H
0260 FF                MOV     R7,A
0261 E4                CLR     A
0262 3E                ADDC    A,R6
0263 FE                MOV     R6,A
0264 E4                CLR     A
0265 3D                ADDC    A,R5
0266 FD                MOV     R5,A
0267 E4                CLR     A
0268 3C                ADDC    A,R4
0269 FC                MOV     R4,A
026A         ?C0192:
026A 900000      R     MOV     DPTR,#ThisFile+09H
026D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 276
                                           ; SOURCE LINE # 277
0270 020000      R     LJMP    ?C0059
0273         ?C0060:
                                           ; SOURCE LINE # 278
0273 900000      R     MOV     DPTR,#ThisFile
0276 7401              MOV     A,#01H
0278 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
0279 900000      R     MOV     DPTR,#ThisFile+010H
027C E0                MOVX    A,@DPTR
027D F8                MOV     R0,A
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 F9                MOV     R1,A
0281 A3                INC     DPTR
0282 E0                MOVX    A,@DPTR
0283 FA                MOV     R2,A
0284 A3                INC     DPTR
0285 E0                MOVX    A,@DPTR
0286 FB                MOV     R3,A
0287 900000      R     MOV     DPTR,#CHRspBlock+040H
028A E0                MOVX    A,@DPTR
028B FE                MOV     R6,A
028C A3                INC     DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 40  

028D E0                MOVX    A,@DPTR
028E FF                MOV     R7,A
028F E4                CLR     A
0290 FC                MOV     R4,A
0291 FD                MOV     R5,A
0292 EB                MOV     A,R3
0293 2F                ADD     A,R7
0294 FF                MOV     R7,A
0295 EA                MOV     A,R2
0296 3E                ADDC    A,R6
0297 FE                MOV     R6,A
0298 ED                MOV     A,R5
0299 39                ADDC    A,R1
029A FD                MOV     R5,A
029B EC                MOV     A,R4
029C 38                ADDC    A,R0
029D FC                MOV     R4,A
029E 900000      R     MOV     DPTR,#ThisFile+010H
02A1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 280
02A4 900000      R     MOV     DPTR,#CHRspBlock+040H
02A7 E0                MOVX    A,@DPTR
02A8 FE                MOV     R6,A
02A9 A3                INC     DPTR
02AA E0                MOVX    A,@DPTR
02AB FF                MOV     R7,A
02AC 120000      E     LCALL   _SwapINT16
02AF 900000      R     MOV     DPTR,#CHRspBlock+04H
02B2 EE                MOV     A,R6
02B3 F0                MOVX    @DPTR,A
02B4 A3                INC     DPTR
02B5 EF                MOV     A,R7
02B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 281
02B7 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 283
02B9         ?C0055:
02B9 22                RET     
             ; FUNCTION _ReadFile (END)

             ; FUNCTION _CreateFile (BEGIN)
                                           ; SOURCE LINE # 285
0000 8B00        R     MOV     pBuffer,R3
0002 8A00        R     MOV     pBuffer+01H,R2
0004 8900        R     MOV     pBuffer+02H,R1
                                           ; SOURCE LINE # 286
                                           ; SOURCE LINE # 293
0006 AF00        E     MOV     R7,bXXGFlags
0008 EF                MOV     A,R7
0009 C4                SWAP    A
000A 540F              ANL     A,#0FH
000C 20E002            JB      ACC.0,?C0075
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
                                           ; SOURCE LINE # 296
000F 8042              SJMP    ?C0193
                                           ; SOURCE LINE # 297
0011         ?C0075:
                                           ; SOURCE LINE # 298
0011 AB00        R     MOV     R3,pBuffer
0013 AA00        R     MOV     R2,pBuffer+01H
0015 A900        R     MOV     R1,pBuffer+02H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 41  

0017 120000      R     LCALL   _OpenFile
001A EF                MOV     A,R7
001B 6009              JZ      ?C0077
001D AB00        R     MOV     R3,pBuffer
001F AA00        R     MOV     R2,pBuffer+01H
0021 A900        R     MOV     R1,pBuffer+02H
0023 120000      R     LCALL   _RemoveFile
0026         ?C0077:
                                           ; SOURCE LINE # 301
0026 850000      R     MOV     pDirInfo,pBuffer
0029 850000      R     MOV     pDirInfo+01H,pBuffer+01H
002C 850000      R     MOV     pDirInfo+02H,pBuffer+02H
                                           ; SOURCE LINE # 305
002F 120000      E     LCALL   GetFreeCusterNum
0032 120000      E     LCALL   _SwapINT16
0035 AB00        R     MOV     R3,pDirInfo
0037 AA00        R     MOV     R2,pDirInfo+01H
0039 A900        R     MOV     R1,pDirInfo+02H
003B 90001A            MOV     DPTR,#01AH
003E EE                MOV     A,R6
003F 8FF0              MOV     B,R7
0041 120000      E     LCALL   ?C?ISTOPTR
                                           ; SOURCE LINE # 307
0044 90001A            MOV     DPTR,#01AH
0047 120000      E     LCALL   ?C?ILDOPTR
004A C3                CLR     C
004B 9402              SUBB    A,#02H
004D E5F0              MOV     A,B
004F 9400              SUBB    A,#00H
0051 500A              JNC     ?C0078
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 309
0053         ?C0193:
0053 900000      R     MOV     DPTR,#CHRspBlock+02H
0056 E4                CLR     A
0057 F0                MOVX    @DPTR,A
0058 A3                INC     DPTR
0059 04                INC     A
                                           ; SOURCE LINE # 310
005A 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 311
005D         ?C0078:
                                           ; SOURCE LINE # 312
005D AB00        R     MOV     R3,pDirInfo
005F AA00        R     MOV     R2,pDirInfo+01H
0061 A900        R     MOV     R1,pDirInfo+02H
0063 90001C            MOV     DPTR,#01CH
0066 120000      E     LCALL   ?C?LSTKOPTR
0069 00                DB      00H
006A 00                DB      00H
006B 00                DB      00H
006C 00                DB      00H
                                           ; SOURCE LINE # 314
006D E4                CLR     A
006E 900000      R     MOV     DPTR,#ThisFile
0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 315
0072 F500        R     MOV     bstop,A
                                           ; SOURCE LINE # 316
0074 F500        R     MOV     sector,A
0076 F500        R     MOV     sector+01H,A
0078         ?C0079:
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 42  

0078 900000      R     MOV     DPTR,#DeviceInfo+0CH
007B E0                MOVX    A,@DPTR
007C C4                SWAP    A
007D F8                MOV     R0,A
007E 54F0              ANL     A,#0F0H
0080 C8                XCH     A,R0
0081 68                XRL     A,R0
0082 FE                MOV     R6,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 C4                SWAP    A
0086 540F              ANL     A,#0FH
0088 48                ORL     A,R0
0089 FF                MOV     R7,A
008A C3                CLR     C
008B E500        R     MOV     A,sector+01H
008D 9F                SUBB    A,R7
008E E500        R     MOV     A,sector
0090 9E                SUBB    A,R6
0091 4003              JC      $ + 5H
0093 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
0096 E4                CLR     A
0097 FC                MOV     R4,A
0098 FD                MOV     R5,A
0099 900000      R     MOV     DPTR,#DeviceInfo+03CH
009C E0                MOVX    A,@DPTR
009D F8                MOV     R0,A
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 F9                MOV     R1,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 FA                MOV     R2,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 2500        R     ADD     A,sector+01H
00A8 FF                MOV     R7,A
00A9 EA                MOV     A,R2
00AA 3500        R     ADDC    A,sector
00AC FE                MOV     R6,A
00AD ED                MOV     A,R5
00AE 39                ADDC    A,R1
00AF FD                MOV     R5,A
00B0 EC                MOV     A,R4
00B1 38                ADDC    A,R0
00B2 FC                MOV     R4,A
00B3 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
00B6 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
00B9 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
00BC 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
00BF 120000      E     LCALL   _RBC_Read
00C2 EF                MOV     A,R7
00C3 700A              JNZ     ?C0082
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 321
00C5 900000      R     MOV     DPTR,#CHRspBlock+02H
00C8 F0                MOVX    @DPTR,A
00C9 A3                INC     DPTR
00CA 740A              MOV     A,#0AH
00CC         ?C0194:
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 43  

                                           ; SOURCE LINE # 322
00CC 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 323
00CF         ?C0082:
                                           ; SOURCE LINE # 324
00CF E4                CLR     A
00D0 F500        R     MOV     i,A
00D2 F500        R     MOV     i+01H,A
00D4         ?C0083:
00D4 D3                SETB    C
00D5 900000      R     MOV     DPTR,#DeviceInfo+09H
00D8 E0                MOVX    A,@DPTR
00D9 9500        R     SUBB    A,i+01H
00DB 900000      R     MOV     DPTR,#DeviceInfo+08H
00DE E0                MOVX    A,@DPTR
00DF 9500        R     SUBB    A,i
00E1 5003              JNC     $ + 5H
00E3 020000      R     LJMP    ?C0084
                                           ; SOURCE LINE # 325
                                           ; SOURCE LINE # 326
00E6 7400        E     MOV     A,#LOW DBUF
00E8 2500        R     ADD     A,i+01H
00EA F582              MOV     DPL,A
00EC 7400        E     MOV     A,#HIGH DBUF
00EE 3500        R     ADDC    A,i
00F0 F583              MOV     DPH,A
00F2 E0                MOVX    A,@DPTR
00F3 6004              JZ      ?C0087
00F5 64E5              XRL     A,#0E5H
00F7 7078              JNZ     ?C0085
00F9         ?C0087:
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
00F9 E4                CLR     A
00FA F500        R     MOV     j,A
00FC F500        R     MOV     j+01H,A
00FE         ?C0088:
                                           ; SOURCE LINE # 329
00FE AB00        R     MOV     R3,pBuffer
0100 AA00        R     MOV     R2,pBuffer+01H
0102 A900        R     MOV     R1,pBuffer+02H
0104 850082      R     MOV     DPL,j+01H
0107 850083      R     MOV     DPH,j
010A 120000      E     LCALL   ?C?CLDOPTR
010D FF                MOV     R7,A
010E E500        R     MOV     A,i+01H
0110 2500        R     ADD     A,j+01H
0112 FD                MOV     R5,A
0113 E500        R     MOV     A,i
0115 3500        R     ADDC    A,j
0117 FC                MOV     R4,A
0118 7400        E     MOV     A,#LOW DBUF
011A 2D                ADD     A,R5
011B F582              MOV     DPL,A
011D 7400        E     MOV     A,#HIGH DBUF
011F 3C                ADDC    A,R4
0120 F583              MOV     DPH,A
0122 EF                MOV     A,R7
0123 F0                MOVX    @DPTR,A
0124 0500        R     INC     j+01H
0126 E500        R     MOV     A,j+01H
0128 7002              JNZ     ?C0174
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 44  

012A 0500        R     INC     j
012C         ?C0174:
012C 6420              XRL     A,#020H
012E 4500        R     ORL     A,j
0130 70CC              JNZ     ?C0088
0132         ?C0089:
                                           ; SOURCE LINE # 330
0132 E4                CLR     A
0133 FC                MOV     R4,A
0134 FD                MOV     R5,A
0135 900000      R     MOV     DPTR,#DeviceInfo+03CH
0138 E0                MOVX    A,@DPTR
0139 F8                MOV     R0,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C F9                MOV     R1,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FA                MOV     R2,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 2500        R     ADD     A,sector+01H
0144 FF                MOV     R7,A
0145 EA                MOV     A,R2
0146 3500        R     ADDC    A,sector
0148 FE                MOV     R6,A
0149 ED                MOV     A,R5
014A 39                ADDC    A,R1
014B FD                MOV     R5,A
014C EC                MOV     A,R4
014D 38                ADDC    A,R0
014E FC                MOV     R4,A
014F 750001      E     MOV     ?_RBC_Write?BYTE+04H,#01H
0152 750001      E     MOV     ?_RBC_Write?BYTE+05H,#01H
0155 750000      E     MOV     ?_RBC_Write?BYTE+06H,#HIGH DBUF
0158 750000      E     MOV     ?_RBC_Write?BYTE+07H,#LOW DBUF
015B 120000      E     LCALL   _RBC_Write
015E EF                MOV     A,R7
015F 700B              JNZ     ?C0091
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
0161 900000      R     MOV     DPTR,#CHRspBlock+02H
0164 F0                MOVX    @DPTR,A
0165 A3                INC     DPTR
0166 740A              MOV     A,#0AH
0168         ?C0195:
0168 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 333
0169 7F00              MOV     R7,#00H
016B 22                RET     
                                           ; SOURCE LINE # 334
016C         ?C0091:
                                           ; SOURCE LINE # 335
016C 750001      R     MOV     bstop,#01H
                                           ; SOURCE LINE # 336
016F 800E              SJMP    ?C0084
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 338
0171         ?C0085:
0171 7420              MOV     A,#020H
0173 2500        R     ADD     A,i+01H
0175 F500        R     MOV     i+01H,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 45  

0177 E4                CLR     A
0178 3500        R     ADDC    A,i
017A F500        R     MOV     i,A
017C 020000      R     LJMP    ?C0083
017F         ?C0084:
                                           ; SOURCE LINE # 339
017F E500        R     MOV     A,bstop
0181 6401              XRL     A,#01H
0183 600B              JZ      ?C0080
                                           ; SOURCE LINE # 340
0185         ?C0081:
0185 0500        R     INC     sector+01H
0187 E500        R     MOV     A,sector+01H
0189 7002              JNZ     ?C0175
018B 0500        R     INC     sector
018D         ?C0175:
018D 020000      R     LJMP    ?C0079
0190         ?C0080:
                                           ; SOURCE LINE # 342
0190 AB00        R     MOV     R3,pDirInfo
0192 AA00        R     MOV     R2,pDirInfo+01H
0194 A900        R     MOV     R1,pDirInfo+02H
0196 90001A            MOV     DPTR,#01AH
0199 120000      E     LCALL   ?C?ILDOPTR
019C FF                MOV     R7,A
019D AEF0              MOV     R6,B
019F 120000      E     LCALL   _SwapINT16
01A2 900000      R     MOV     DPTR,#ThisFile+01H
01A5 EE                MOV     A,R6
01A6 F0                MOVX    @DPTR,A
01A7 A3                INC     DPTR
01A8 EF                MOV     A,R7
01A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 343
01AA A3                INC     DPTR
01AB 120000      E     LCALL   ?C?LSTKXDATA
01AE 00                DB      00H
01AF 00                DB      00H
01B0 00                DB      00H
01B1 00                DB      00H
                                           ; SOURCE LINE # 344
01B2 900000      R     MOV     DPTR,#ThisFile+01H
01B5 E0                MOVX    A,@DPTR
01B6 FF                MOV     R7,A
01B7 A3                INC     DPTR
01B8 E0                MOVX    A,@DPTR
01B9 900000      R     MOV     DPTR,#ThisFile+07H
01BC CF                XCH     A,R7
01BD F0                MOVX    @DPTR,A
01BE A3                INC     DPTR
01BF EF                MOV     A,R7
01C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 345
01C1 900000      R     MOV     DPTR,#ThisFile+01H
01C4 E0                MOVX    A,@DPTR
01C5 FE                MOV     R6,A
01C6 A3                INC     DPTR
01C7 E0                MOVX    A,@DPTR
01C8 FF                MOV     R7,A
01C9 120000      E     LCALL   _FirstSectorofCluster
01CC 900000      R     MOV     DPTR,#ThisFile+09H
01CF 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 46  

                                           ; SOURCE LINE # 346
01D2 E4                CLR     A
01D3 900000      R     MOV     DPTR,#ThisFile+0DH
01D6 F0                MOVX    @DPTR,A
01D7 A3                INC     DPTR
01D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 347
01D9 A3                INC     DPTR
01DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 348
01DB 900000      R     MOV     DPTR,#ThisFile
01DE 04                INC     A
01DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 349
01E0 900000      R     MOV     DPTR,#ThisFile+010H
01E3 120000      E     LCALL   ?C?LSTKXDATA
01E6 00                DB      00H
01E7 00                DB      00H
01E8 00                DB      00H
01E9 00                DB      00H
                                           ; SOURCE LINE # 350
01EA E4                CLR     A
01EB 900000      R     MOV     DPTR,#ThisFile+014H
01EE F0                MOVX    @DPTR,A
01EF A3                INC     DPTR
01F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 351
01F1 900000      R     MOV     DPTR,#DeviceInfo+038H
01F4 E0                MOVX    A,@DPTR
01F5 FC                MOV     R4,A
01F6 A3                INC     DPTR
01F7 E0                MOVX    A,@DPTR
01F8 FD                MOV     R5,A
01F9 A3                INC     DPTR
01FA E0                MOVX    A,@DPTR
01FB FE                MOV     R6,A
01FC A3                INC     DPTR
01FD E0                MOVX    A,@DPTR
01FE FF                MOV     R7,A
01FF 900000      E     MOV     DPTR,#FreeFat
0202 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 352
0205 900000      R     MOV     DPTR,#DeviceInfo+038H
0208 E0                MOVX    A,@DPTR
0209 FC                MOV     R4,A
020A A3                INC     DPTR
020B E0                MOVX    A,@DPTR
020C FD                MOV     R5,A
020D A3                INC     DPTR
020E E0                MOVX    A,@DPTR
020F FE                MOV     R6,A
0210 A3                INC     DPTR
0211 E0                MOVX    A,@DPTR
0212 FF                MOV     R7,A
0213 900000      E     MOV     DPTR,#FreeFat+06H
0216 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 353
0219 900000      E     MOV     DPTR,#FreeFat+04H
021C E4                CLR     A
021D F0                MOVX    @DPTR,A
021E A3                INC     DPTR
021F 7402              MOV     A,#02H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 47  

0221 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 355
0222 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 357
0224         ?C0076:
0224 22                RET     
             ; FUNCTION _CreateFile (END)

             ; FUNCTION _WriteFile (BEGIN)
                                           ; SOURCE LINE # 359
0000 8E00        R     MOV     writeLength,R6
0002 8F00        R     MOV     writeLength+01H,R7
0004 8B00        R     MOV     pBuffer,R3
0006 8A00        R     MOV     pBuffer+01H,R2
0008 8900        R     MOV     pBuffer+02H,R1
                                           ; SOURCE LINE # 360
                                           ; SOURCE LINE # 366
000A AF00        E     MOV     R7,bXXGFlags
000C EF                MOV     A,R7
000D C4                SWAP    A
000E 540F              ANL     A,#0FH
0010 20E00A            JB      ACC.0,?C0093
                                           ; SOURCE LINE # 367
                                           ; SOURCE LINE # 368
0013 900000      R     MOV     DPTR,#CHRspBlock+02H
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
0018 A3                INC     DPTR
0019 04                INC     A
                                           ; SOURCE LINE # 369
001A 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 370
001D         ?C0093:
                                           ; SOURCE LINE # 371
001D 900000      R     MOV     DPTR,#ThisFile
0020 E0                MOVX    A,@DPTR
0021 700A              JNZ     ?C0095
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
0023 900000      R     MOV     DPTR,#CHRspBlock+02H
0026 F0                MOVX    @DPTR,A
0027 A3                INC     DPTR
0028 7414              MOV     A,#014H
002A         ?C0198:
                                           ; SOURCE LINE # 374
002A 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 375
002D         ?C0095:
                                           ; SOURCE LINE # 376
002D E4                CLR     A
002E 900000      R     MOV     DPTR,#ThisFile
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 377
0032 750001      R     MOV     bSuccess,#01H
                                           ; SOURCE LINE # 378
0035 F500        R     MOV     bStop,A
                                           ; SOURCE LINE # 380
0037 900000      R     MOV     DPTR,#CHRspBlock+040H
003A F0                MOVX    @DPTR,A
003B A3                INC     DPTR
003C F0                MOVX    @DPTR,A
003D         ?C0096:
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 48  

                                           ; SOURCE LINE # 382
003D D3                SETB    C
003E E500        R     MOV     A,writeLength+01H
0040 9400              SUBB    A,#00H
0042 E500        R     MOV     A,writeLength
0044 9400              SUBB    A,#00H
0046 5003              JNC     $ + 5H
0048 020000      R     LJMP    ?C0097
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 384
004B 900000      R     MOV     DPTR,#ThisFile+0DH
004E E0                MOVX    A,@DPTR
004F FE                MOV     R6,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 D3                SETB    C
0054 9400              SUBB    A,#00H
0056 EE                MOV     A,R6
0057 9400              SUBB    A,#00H
0059 5003              JNC     $ + 5H
005B 020000      R     LJMP    ?C0098
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
005E E500        R     MOV     A,writeLength+01H
0060 2F                ADD     A,R7
0061 FF                MOV     R7,A
0062 E500        R     MOV     A,writeLength
0064 3E                ADDC    A,R6
0065 FE                MOV     R6,A
0066 900000      R     MOV     DPTR,#DeviceInfo+08H
0069 E0                MOVX    A,@DPTR
006A FC                MOV     R4,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FD                MOV     R5,A
006E C3                CLR     C
006F 9F                SUBB    A,R7
0070 EC                MOV     A,R4
0071 9E                SUBB    A,R6
0072 5006              JNC     ?C0099
                                           ; SOURCE LINE # 387
0074 8C00        R     MOV     len,R4
0076 8D00        R     MOV     len+01H,R5
0078 8004              SJMP    ?C0100
007A         ?C0099:
                                           ; SOURCE LINE # 389
007A 8E00        R     MOV     len,R6
007C 8F00        R     MOV     len+01H,R7
007E         ?C0100:
                                           ; SOURCE LINE # 390
007E 900000      R     MOV     DPTR,#ThisFile+09H
0081 E0                MOVX    A,@DPTR
0082 FC                MOV     R4,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FD                MOV     R5,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 FE                MOV     R6,A
0089 A3                INC     DPTR
008A E0                MOVX    A,@DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 49  

008B FF                MOV     R7,A
008C 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
008F 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
0092 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
0095 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
0098 120000      E     LCALL   _RBC_Read
009B EF                MOV     A,R7
009C 700A              JNZ     ?C0101
                                           ; SOURCE LINE # 391
                                           ; SOURCE LINE # 392
009E 900000      R     MOV     DPTR,#CHRspBlock+02H
00A1 F0                MOVX    @DPTR,A
00A2 A3                INC     DPTR
00A3 740A              MOV     A,#0AH
00A5         ?C0199:
                                           ; SOURCE LINE # 393
00A5 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 394
00A8         ?C0101:
                                           ; SOURCE LINE # 395
00A8 900000      R     MOV     DPTR,#ThisFile+0DH
00AB E0                MOVX    A,@DPTR
00AC FE                MOV     R6,A
00AD A3                INC     DPTR
00AE E0                MOVX    A,@DPTR
00AF FF                MOV     R7,A
00B0 C3                CLR     C
00B1 E500        R     MOV     A,len+01H
00B3 9F                SUBB    A,R7
00B4 F500        R     MOV     len+01H,A
00B6 E500        R     MOV     A,len
00B8 9E                SUBB    A,R6
00B9 F500        R     MOV     len,A
                                           ; SOURCE LINE # 396
00BB E4                CLR     A
00BC F500        R     MOV     i,A
00BE F500        R     MOV     i+01H,A
00C0         ?C0102:
00C0 C3                CLR     C
00C1 E500        R     MOV     A,i+01H
00C3 9500        R     SUBB    A,len+01H
00C5 E500        R     MOV     A,i
00C7 9500        R     SUBB    A,len
00C9 5034              JNC     ?C0103
                                           ; SOURCE LINE # 397
00CB AB00        R     MOV     R3,pBuffer
00CD AA00        R     MOV     R2,pBuffer+01H
00CF A900        R     MOV     R1,pBuffer+02H
00D1 850082      R     MOV     DPL,i+01H
00D4 850083      R     MOV     DPH,i
00D7 120000      E     LCALL   ?C?CLDOPTR
00DA FF                MOV     R7,A
00DB 900000      R     MOV     DPTR,#ThisFile+0EH
00DE E0                MOVX    A,@DPTR
00DF 2500        R     ADD     A,i+01H
00E1 FD                MOV     R5,A
00E2 900000      R     MOV     DPTR,#ThisFile+0DH
00E5 E0                MOVX    A,@DPTR
00E6 3500        R     ADDC    A,i
00E8 FC                MOV     R4,A
00E9 7400        E     MOV     A,#LOW DBUF
00EB 2D                ADD     A,R5
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 50  

00EC F582              MOV     DPL,A
00EE 7400        E     MOV     A,#HIGH DBUF
00F0 3C                ADDC    A,R4
00F1 F583              MOV     DPH,A
00F3 EF                MOV     A,R7
00F4 F0                MOVX    @DPTR,A
00F5 0500        R     INC     i+01H
00F7 E500        R     MOV     A,i+01H
00F9 70C5              JNZ     ?C0102
00FB 0500        R     INC     i
00FD         ?C0176:
00FD 80C1              SJMP    ?C0102
00FF         ?C0103:
                                           ; SOURCE LINE # 398
00FF 900000      R     MOV     DPTR,#ThisFile+09H
0102 E0                MOVX    A,@DPTR
0103 FC                MOV     R4,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 FD                MOV     R5,A
0107 A3                INC     DPTR
0108 E0                MOVX    A,@DPTR
0109 FE                MOV     R6,A
010A A3                INC     DPTR
010B E0                MOVX    A,@DPTR
010C FF                MOV     R7,A
010D 750001      E     MOV     ?_RBC_Write?BYTE+04H,#01H
0110 750001      E     MOV     ?_RBC_Write?BYTE+05H,#01H
0113 750000      E     MOV     ?_RBC_Write?BYTE+06H,#HIGH DBUF
0116 750000      E     MOV     ?_RBC_Write?BYTE+07H,#LOW DBUF
0119 120000      E     LCALL   _RBC_Write
011C EF                MOV     A,R7
011D 700A              JNZ     ?C0105
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
011F 900000      R     MOV     DPTR,#CHRspBlock+02H
0122 F0                MOVX    @DPTR,A
0123 A3                INC     DPTR
0124 740A              MOV     A,#0AH
0126         ?C0200:
                                           ; SOURCE LINE # 401
0126 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 402
0129         ?C0105:
                                           ; SOURCE LINE # 403
0129 900000      R     MOV     DPTR,#ThisFile+0EH
012C E0                MOVX    A,@DPTR
012D 2500        R     ADD     A,len+01H
012F F0                MOVX    @DPTR,A
0130 900000      R     MOV     DPTR,#ThisFile+0DH
0133 E0                MOVX    A,@DPTR
0134 3500        R     ADDC    A,len
0136 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 404
0137 020000      R     LJMP    ?C0106
013A         ?C0098:
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
013A 900000      R     MOV     DPTR,#DeviceInfo+08H
013D E0                MOVX    A,@DPTR
013E FC                MOV     R4,A
013F A3                INC     DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 51  

0140 E0                MOVX    A,@DPTR
0141 FD                MOV     R5,A
0142 C3                CLR     C
0143 9500        R     SUBB    A,writeLength+01H
0145 EC                MOV     A,R4
0146 9500        R     SUBB    A,writeLength
0148 5036              JNC     ?C0107
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
014A AE00        R     MOV     R6,writeLength
014C AF00        R     MOV     R7,writeLength+01H
014E 120000      E     LCALL   ?C?UIDIV
0151 8F00        R     MOV     step,R7
                                           ; SOURCE LINE # 410
0153 A3                INC     DPTR
0154 E0                MOVX    A,@DPTR
0155 FF                MOV     R7,A
0156 E500        R     MOV     A,step
0158 D3                SETB    C
0159 9F                SUBB    A,R7
015A 900000      R     MOV     DPTR,#ThisFile+0FH
015D E0                MOVX    A,@DPTR
015E 4005              JC      ?C0108
                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 412
0160 FE                MOV     R6,A
0161 EF                MOV     A,R7
0162 9E                SUBB    A,R6
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
0163 8005              SJMP    ?C0196
0165         ?C0108:
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
0165 FF                MOV     R7,A
0166 C3                CLR     C
0167 E500        R     MOV     A,step
0169 9F                SUBB    A,R7
016A         ?C0196:
016A F500        R     MOV     step,A
                                           ; SOURCE LINE # 418
016C FF                MOV     R7,A
016D 7E00              MOV     R6,#00H
016F 900000      R     MOV     DPTR,#DeviceInfo+08H
0172 E0                MOVX    A,@DPTR
0173 FC                MOV     R4,A
0174 A3                INC     DPTR
0175 E0                MOVX    A,@DPTR
0176 FD                MOV     R5,A
0177 120000      E     LCALL   ?C?IMUL
017A 8E00        R     MOV     len,R6
017C 8F00        R     MOV     len+01H,R7
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
017E 8009              SJMP    ?C0110
0180         ?C0107:
                                           ; SOURCE LINE # 422
                                           ; SOURCE LINE # 423
0180 750001      R     MOV     step,#01H
                                           ; SOURCE LINE # 424
0183 850000      R     MOV     len,writeLength
0186 850000      R     MOV     len+01H,writeLength+01H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 52  

                                           ; SOURCE LINE # 425
0189         ?C0110:
                                           ; SOURCE LINE # 426
0189 900000      R     MOV     DPTR,#ThisFile+09H
018C E0                MOVX    A,@DPTR
018D FC                MOV     R4,A
018E A3                INC     DPTR
018F E0                MOVX    A,@DPTR
0190 FD                MOV     R5,A
0191 A3                INC     DPTR
0192 E0                MOVX    A,@DPTR
0193 FE                MOV     R6,A
0194 A3                INC     DPTR
0195 E0                MOVX    A,@DPTR
0196 FF                MOV     R7,A
0197 850000      E     MOV     ?_RBC_Write?BYTE+04H,step
019A 900000      R     MOV     DPTR,#CHRspBlock+040H
019D E0                MOVX    A,@DPTR
019E F8                MOV     R0,A
019F A3                INC     DPTR
01A0 E0                MOVX    A,@DPTR
01A1 2500        R     ADD     A,pBuffer+02H
01A3 F9                MOV     R1,A
01A4 E500        R     MOV     A,pBuffer+01H
01A6 38                ADDC    A,R0
01A7 850000      E     MOV     ?_RBC_Write?BYTE+05H,pBuffer
01AA F500        E     MOV     ?_RBC_Write?BYTE+06H,A
01AC 8900        E     MOV     ?_RBC_Write?BYTE+07H,R1
01AE 120000      E     LCALL   _RBC_Write
01B1 EF                MOV     A,R7
01B2 700A              JNZ     ?C0111
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
01B4 900000      R     MOV     DPTR,#CHRspBlock+02H
01B7 F0                MOVX    @DPTR,A
01B8 A3                INC     DPTR
01B9 740A              MOV     A,#0AH
01BB         ?C0201:
                                           ; SOURCE LINE # 429
01BB 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 430
01BE         ?C0111:
                                           ; SOURCE LINE # 431
01BE 900000      R     MOV     DPTR,#ThisFile+0DH
01C1 E500        R     MOV     A,len
01C3 F0                MOVX    @DPTR,A
01C4 A3                INC     DPTR
01C5 E500        R     MOV     A,len+01H
01C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 432
01C8         ?C0106:
                                           ; SOURCE LINE # 435
01C8 C3                CLR     C
01C9 E500        R     MOV     A,writeLength+01H
01CB 9500        R     SUBB    A,len+01H
01CD F500        R     MOV     writeLength+01H,A
01CF E500        R     MOV     A,writeLength
01D1 9500        R     SUBB    A,len
01D3 F500        R     MOV     writeLength,A
                                           ; SOURCE LINE # 436
01D5 900000      R     MOV     DPTR,#CHRspBlock+041H
01D8 E0                MOVX    A,@DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 53  

01D9 2500        R     ADD     A,len+01H
01DB F0                MOVX    @DPTR,A
01DC 900000      R     MOV     DPTR,#CHRspBlock+040H
01DF E0                MOVX    A,@DPTR
01E0 3500        R     ADDC    A,len
01E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 440
01E3 900000      R     MOV     DPTR,#DeviceInfo+08H
01E6 E0                MOVX    A,@DPTR
01E7 FC                MOV     R4,A
01E8 A3                INC     DPTR
01E9 E0                MOVX    A,@DPTR
01EA FD                MOV     R5,A
01EB 900000      R     MOV     DPTR,#ThisFile+0DH
01EE E0                MOVX    A,@DPTR
01EF FE                MOV     R6,A
01F0 A3                INC     DPTR
01F1 E0                MOVX    A,@DPTR
01F2 FF                MOV     R7,A
01F3 120000      E     LCALL   ?C?UIDIV
01F6 8F00        R     MOV     step,R7
                                           ; SOURCE LINE # 442
01F8 E500        R     MOV     A,step
01FA D3                SETB    C
01FB 9400              SUBB    A,#00H
01FD 5003              JNC     $ + 5H
01FF 020000      R     LJMP    ?C0096
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 444
0202 7E00              MOV     R6,#00H
0204 900000      R     MOV     DPTR,#DeviceInfo+08H
0207 E0                MOVX    A,@DPTR
0208 FC                MOV     R4,A
0209 A3                INC     DPTR
020A E0                MOVX    A,@DPTR
020B FD                MOV     R5,A
020C 120000      E     LCALL   ?C?IMUL
020F C3                CLR     C
0210 900000      R     MOV     DPTR,#ThisFile+0EH
0213 E0                MOVX    A,@DPTR
0214 9F                SUBB    A,R7
0215 F0                MOVX    @DPTR,A
0216 900000      R     MOV     DPTR,#ThisFile+0DH
0219 E0                MOVX    A,@DPTR
021A 9E                SUBB    A,R6
021B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
021C 900000      R     MOV     DPTR,#ThisFile+0FH
021F E0                MOVX    A,@DPTR
0220 2500        R     ADD     A,step
0222 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 446
0223 900000      R     MOV     DPTR,#DeviceInfo+0AH
0226 E0                MOVX    A,@DPTR
0227 14                DEC     A
0228 FF                MOV     R7,A
0229 900000      R     MOV     DPTR,#ThisFile+0FH
022C E0                MOVX    A,@DPTR
022D D3                SETB    C
022E 9F                SUBB    A,R7
022F 406F              JC      ?C0113
                                           ; SOURCE LINE # 447
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 54  

                                           ; SOURCE LINE # 448
0231 E4                CLR     A
0232 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 449
0233 900000      R     MOV     DPTR,#CHRspBlock+040H
0236 E0                MOVX    A,@DPTR
0237 FE                MOV     R6,A
0238 A3                INC     DPTR
0239 E0                MOVX    A,@DPTR
023A FF                MOV     R7,A
023B E4                CLR     A
023C FC                MOV     R4,A
023D FD                MOV     R5,A
023E 900000      R     MOV     DPTR,#ThisFile+010H
0241 E0                MOVX    A,@DPTR
0242 F8                MOV     R0,A
0243 A3                INC     DPTR
0244 E0                MOVX    A,@DPTR
0245 F9                MOV     R1,A
0246 A3                INC     DPTR
0247 E0                MOVX    A,@DPTR
0248 FA                MOV     R2,A
0249 A3                INC     DPTR
024A E0                MOVX    A,@DPTR
024B 2F                ADD     A,R7
024C FF                MOV     R7,A
024D EA                MOV     A,R2
024E 3E                ADDC    A,R6
024F FE                MOV     R6,A
0250 ED                MOV     A,R5
0251 39                ADDC    A,R1
0252 FD                MOV     R5,A
0253 EC                MOV     A,R4
0254 38                ADDC    A,R0
0255 FC                MOV     R4,A
0256 900000      R     MOV     DPTR,#ThisFile+03H
0259 E0                MOVX    A,@DPTR
025A F8                MOV     R0,A
025B A3                INC     DPTR
025C E0                MOVX    A,@DPTR
025D F9                MOV     R1,A
025E A3                INC     DPTR
025F E0                MOVX    A,@DPTR
0260 FA                MOV     R2,A
0261 A3                INC     DPTR
0262 E0                MOVX    A,@DPTR
0263 FB                MOV     R3,A
0264 D3                SETB    C
0265 120000      E     LCALL   ?C?ULCMP
0268 900000      R     MOV     DPTR,#ThisFile+07H
026B E0                MOVX    A,@DPTR
026C FE                MOV     R6,A
026D A3                INC     DPTR
026E E0                MOVX    A,@DPTR
026F FF                MOV     R7,A
0270 4005              JC      ?C0114
                                           ; SOURCE LINE # 450
0272 120000      E     LCALL   _GetNextClusterNum
0275 8003              SJMP    ?C0197
0277         ?C0114:
                                           ; SOURCE LINE # 452
0277 120000      E     LCALL   _CreateClusterLink
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 55  

027A         ?C0197:
027A 900000      R     MOV     DPTR,#ThisFile+07H
027D EE                MOV     A,R6
027E F0                MOVX    @DPTR,A
027F A3                INC     DPTR
0280 EF                MOV     A,R7
0281 F0                MOVX    @DPTR,A
0282         ?C0115:
                                           ; SOURCE LINE # 453
0282 900000      R     MOV     DPTR,#ThisFile+07H
0285 E0                MOVX    A,@DPTR
0286 FC                MOV     R4,A
0287 A3                INC     DPTR
0288 E0                MOVX    A,@DPTR
0289 FD                MOV     R5,A
028A 4C                ORL     A,R4
028B 700A              JNZ     ?C0116
                                           ; SOURCE LINE # 454
                                           ; SOURCE LINE # 457
028D 900000      R     MOV     DPTR,#CHRspBlock+02H
0290 F0                MOVX    @DPTR,A
0291 A3                INC     DPTR
0292 740A              MOV     A,#0AH
0294         ?C0202:
                                           ; SOURCE LINE # 458
0294 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 459
0297         ?C0116:
                                           ; SOURCE LINE # 460
0297 AF05              MOV     R7,AR5
0299 AE04              MOV     R6,AR4
029B 120000      E     LCALL   _FirstSectorofCluster
                                           ; SOURCE LINE # 461
029E 801F              SJMP    ?C0204
02A0         ?C0113:
                                           ; SOURCE LINE # 463
02A0 900000      R     MOV     DPTR,#ThisFile+09H
02A3 E0                MOVX    A,@DPTR
02A4 F8                MOV     R0,A
02A5 A3                INC     DPTR
02A6 E0                MOVX    A,@DPTR
02A7 F9                MOV     R1,A
02A8 A3                INC     DPTR
02A9 E0                MOVX    A,@DPTR
02AA FA                MOV     R2,A
02AB A3                INC     DPTR
02AC E0                MOVX    A,@DPTR
02AD FB                MOV     R3,A
02AE E4                CLR     A
02AF FC                MOV     R4,A
02B0 FD                MOV     R5,A
02B1 FE                MOV     R6,A
02B2 EB                MOV     A,R3
02B3 2500        R     ADD     A,step
02B5 FF                MOV     R7,A
02B6 EE                MOV     A,R6
02B7 3A                ADDC    A,R2
02B8 FE                MOV     R6,A
02B9 ED                MOV     A,R5
02BA 39                ADDC    A,R1
02BB FD                MOV     R5,A
02BC EC                MOV     A,R4
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 56  

02BD 38                ADDC    A,R0
02BE FC                MOV     R4,A
02BF         ?C0204:
02BF 900000      R     MOV     DPTR,#ThisFile+09H
02C2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 467
02C5 020000      R     LJMP    ?C0096
02C8         ?C0097:
                                           ; SOURCE LINE # 468
02C8 900000      R     MOV     DPTR,#ThisFile+010H
02CB E0                MOVX    A,@DPTR
02CC F8                MOV     R0,A
02CD A3                INC     DPTR
02CE E0                MOVX    A,@DPTR
02CF F9                MOV     R1,A
02D0 A3                INC     DPTR
02D1 E0                MOVX    A,@DPTR
02D2 FA                MOV     R2,A
02D3 A3                INC     DPTR
02D4 E0                MOVX    A,@DPTR
02D5 FB                MOV     R3,A
02D6 900000      R     MOV     DPTR,#CHRspBlock+040H
02D9 E0                MOVX    A,@DPTR
02DA FE                MOV     R6,A
02DB A3                INC     DPTR
02DC E0                MOVX    A,@DPTR
02DD FF                MOV     R7,A
02DE E4                CLR     A
02DF FC                MOV     R4,A
02E0 FD                MOV     R5,A
02E1 EB                MOV     A,R3
02E2 2F                ADD     A,R7
02E3 FF                MOV     R7,A
02E4 EA                MOV     A,R2
02E5 3E                ADDC    A,R6
02E6 FE                MOV     R6,A
02E7 ED                MOV     A,R5
02E8 39                ADDC    A,R1
02E9 FD                MOV     R5,A
02EA EC                MOV     A,R4
02EB 38                ADDC    A,R0
02EC FC                MOV     R4,A
02ED 900000      R     MOV     DPTR,#ThisFile+010H
02F0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 469
02F3 900000      E     MOV     DPTR,#FreeFat
02F6 E0                MOVX    A,@DPTR
02F7 FC                MOV     R4,A
02F8 A3                INC     DPTR
02F9 E0                MOVX    A,@DPTR
02FA FD                MOV     R5,A
02FB A3                INC     DPTR
02FC E0                MOVX    A,@DPTR
02FD FE                MOV     R6,A
02FE A3                INC     DPTR
02FF E0                MOVX    A,@DPTR
0300 FF                MOV     R7,A
0301 120000      E     LCALL   _UpdateFat
                                           ; SOURCE LINE # 471
0304 E500        R     MOV     A,bSuccess
0306 6401              XRL     A,#01H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 57  

0308 6003              JZ      $ + 5H
030A 020000      R     LJMP    ?C0118
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 474
030D F500        R     MOV     sector,A
030F F500        R     MOV     sector+01H,A
0311         ?C0119:
0311 900000      R     MOV     DPTR,#DeviceInfo+0CH
0314 E0                MOVX    A,@DPTR
0315 C4                SWAP    A
0316 F8                MOV     R0,A
0317 54F0              ANL     A,#0F0H
0319 C8                XCH     A,R0
031A 68                XRL     A,R0
031B FE                MOV     R6,A
031C A3                INC     DPTR
031D E0                MOVX    A,@DPTR
031E C4                SWAP    A
031F 540F              ANL     A,#0FH
0321 48                ORL     A,R0
0322 FF                MOV     R7,A
0323 C3                CLR     C
0324 E500        R     MOV     A,sector+01H
0326 9F                SUBB    A,R7
0327 E500        R     MOV     A,sector
0329 9E                SUBB    A,R6
032A 4003              JC      $ + 5H
032C 020000      R     LJMP    ?C0118
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
032F E4                CLR     A
0330 FC                MOV     R4,A
0331 FD                MOV     R5,A
0332 900000      R     MOV     DPTR,#DeviceInfo+03CH
0335 E0                MOVX    A,@DPTR
0336 F8                MOV     R0,A
0337 A3                INC     DPTR
0338 E0                MOVX    A,@DPTR
0339 F9                MOV     R1,A
033A A3                INC     DPTR
033B E0                MOVX    A,@DPTR
033C FA                MOV     R2,A
033D A3                INC     DPTR
033E E0                MOVX    A,@DPTR
033F 2500        R     ADD     A,sector+01H
0341 FF                MOV     R7,A
0342 EA                MOV     A,R2
0343 3500        R     ADDC    A,sector
0345 FE                MOV     R6,A
0346 ED                MOV     A,R5
0347 39                ADDC    A,R1
0348 FD                MOV     R5,A
0349 EC                MOV     A,R4
034A 38                ADDC    A,R0
034B FC                MOV     R4,A
034C 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
034F 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
0352 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
0355 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
0358 120000      E     LCALL   _RBC_Read
035B EF                MOV     A,R7
035C 700A              JNZ     ?C0122
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 58  

                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
035E 900000      R     MOV     DPTR,#CHRspBlock+02H
0361 F0                MOVX    @DPTR,A
0362 A3                INC     DPTR
0363 740A              MOV     A,#0AH
0365         ?C0203:
                                           ; SOURCE LINE # 479
0365 020000      R     LJMP    ?C0205
                                           ; SOURCE LINE # 480
0368         ?C0122:
                                           ; SOURCE LINE # 481
0368 E4                CLR     A
0369 F500        R     MOV     i,A
036B F500        R     MOV     i+01H,A
036D         ?C0123:
036D D3                SETB    C
036E 900000      R     MOV     DPTR,#DeviceInfo+09H
0371 E0                MOVX    A,@DPTR
0372 9500        R     SUBB    A,i+01H
0374 900000      R     MOV     DPTR,#DeviceInfo+08H
0377 E0                MOVX    A,@DPTR
0378 9500        R     SUBB    A,i
037A 5003              JNC     $ + 5H
037C 020000      R     LJMP    ?C0124
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
037F 7400        E     MOV     A,#LOW DBUF
0381 2500        R     ADD     A,i+01H
0383 F9                MOV     R1,A
0384 7400        E     MOV     A,#HIGH DBUF
0386 3500        R     ADDC    A,i
0388 750001      R     MOV     pDirInfo,#01H
038B F500        R     MOV     pDirInfo+01H,A
038D 8900        R     MOV     pDirInfo+02H,R1
                                           ; SOURCE LINE # 485
038F 900000      R     MOV     DPTR,#ThisFile+01H
0392 E0                MOVX    A,@DPTR
0393 FE                MOV     R6,A
0394 A3                INC     DPTR
0395 E0                MOVX    A,@DPTR
0396 FF                MOV     R7,A
0397 120000      E     LCALL   _SwapINT16
039A AB00        R     MOV     R3,pDirInfo
039C AA00        R     MOV     R2,pDirInfo+01H
039E A900        R     MOV     R1,pDirInfo+02H
03A0 90001A            MOV     DPTR,#01AH
03A3 120000      E     LCALL   ?C?ILDOPTR
03A6 6F                XRL     A,R7
03A7 7003              JNZ     ?C0177
03A9 EE                MOV     A,R6
03AA 65F0              XRL     A,B
03AC         ?C0177:
03AC 6003              JZ      $ + 5H
03AE 020000      R     LJMP    ?C0125
                                           ; SOURCE LINE # 486
                                           ; SOURCE LINE # 487
03B1 900000      R     MOV     DPTR,#ThisFile+03H
03B4 E0                MOVX    A,@DPTR
03B5 FC                MOV     R4,A
03B6 A3                INC     DPTR
03B7 E0                MOVX    A,@DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 59  

03B8 FD                MOV     R5,A
03B9 A3                INC     DPTR
03BA E0                MOVX    A,@DPTR
03BB FE                MOV     R6,A
03BC A3                INC     DPTR
03BD E0                MOVX    A,@DPTR
03BE FF                MOV     R7,A
03BF 900000      R     MOV     DPTR,#ThisFile+010H
03C2 E0                MOVX    A,@DPTR
03C3 F8                MOV     R0,A
03C4 A3                INC     DPTR
03C5 E0                MOVX    A,@DPTR
03C6 F9                MOV     R1,A
03C7 A3                INC     DPTR
03C8 E0                MOVX    A,@DPTR
03C9 FA                MOV     R2,A
03CA A3                INC     DPTR
03CB E0                MOVX    A,@DPTR
03CC FB                MOV     R3,A
03CD D3                SETB    C
03CE 120000      E     LCALL   ?C?ULCMP
03D1 4014              JC      ?C0127
                                           ; SOURCE LINE # 488
03D3 900000      R     MOV     DPTR,#ThisFile+010H
03D6 E0                MOVX    A,@DPTR
03D7 FC                MOV     R4,A
03D8 A3                INC     DPTR
03D9 E0                MOVX    A,@DPTR
03DA FD                MOV     R5,A
03DB A3                INC     DPTR
03DC E0                MOVX    A,@DPTR
03DD FE                MOV     R6,A
03DE A3                INC     DPTR
03DF E0                MOVX    A,@DPTR
03E0 FF                MOV     R7,A
03E1 900000      R     MOV     DPTR,#ThisFile+03H
03E4 120000      E     LCALL   ?C?LSTXDATA
03E7         ?C0127:
                                           ; SOURCE LINE # 490
03E7 900000      R     MOV     DPTR,#ThisFile+03H
03EA E0                MOVX    A,@DPTR
03EB FC                MOV     R4,A
03EC A3                INC     DPTR
03ED E0                MOVX    A,@DPTR
03EE FD                MOV     R5,A
03EF A3                INC     DPTR
03F0 E0                MOVX    A,@DPTR
03F1 FE                MOV     R6,A
03F2 A3                INC     DPTR
03F3 E0                MOVX    A,@DPTR
03F4 FF                MOV     R7,A
03F5 120000      E     LCALL   _SwapINT32
03F8 AB00        R     MOV     R3,pDirInfo
03FA AA00        R     MOV     R2,pDirInfo+01H
03FC A900        R     MOV     R1,pDirInfo+02H
03FE 90001C            MOV     DPTR,#01CH
0401 120000      E     LCALL   ?C?LSTOPTR
                                           ; SOURCE LINE # 491
0404 E4                CLR     A
0405 FC                MOV     R4,A
0406 FD                MOV     R5,A
0407 900000      R     MOV     DPTR,#DeviceInfo+03CH
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 60  

040A E0                MOVX    A,@DPTR
040B F8                MOV     R0,A
040C A3                INC     DPTR
040D E0                MOVX    A,@DPTR
040E F9                MOV     R1,A
040F A3                INC     DPTR
0410 E0                MOVX    A,@DPTR
0411 FA                MOV     R2,A
0412 A3                INC     DPTR
0413 E0                MOVX    A,@DPTR
0414 2500        R     ADD     A,sector+01H
0416 FF                MOV     R7,A
0417 EA                MOV     A,R2
0418 3500        R     ADDC    A,sector
041A FE                MOV     R6,A
041B ED                MOV     A,R5
041C 39                ADDC    A,R1
041D FD                MOV     R5,A
041E EC                MOV     A,R4
041F 38                ADDC    A,R0
0420 FC                MOV     R4,A
0421 750001      E     MOV     ?_RBC_Write?BYTE+04H,#01H
0424 750001      E     MOV     ?_RBC_Write?BYTE+05H,#01H
0427 750000      E     MOV     ?_RBC_Write?BYTE+06H,#HIGH DBUF
042A 750000      E     MOV     ?_RBC_Write?BYTE+07H,#LOW DBUF
042D 120000      E     LCALL   _RBC_Write
0430 EF                MOV     A,R7
0431 700B              JNZ     ?C0128
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 493
0433 900000      R     MOV     DPTR,#CHRspBlock+02H
0436 F0                MOVX    @DPTR,A
0437 A3                INC     DPTR
0438 740A              MOV     A,#0AH
043A         ?C0205:
043A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
043B 7F00              MOV     R7,#00H
043D 22                RET     
                                           ; SOURCE LINE # 495
043E         ?C0128:
                                           ; SOURCE LINE # 496
043E 750001      R     MOV     bStop,#01H
                                           ; SOURCE LINE # 497
0441 800E              SJMP    ?C0124
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
0443         ?C0125:
0443 7420              MOV     A,#020H
0445 2500        R     ADD     A,i+01H
0447 F500        R     MOV     i+01H,A
0449 E4                CLR     A
044A 3500        R     ADDC    A,i
044C F500        R     MOV     i,A
044E 020000      R     LJMP    ?C0123
0451         ?C0124:
                                           ; SOURCE LINE # 500
0451 E500        R     MOV     A,bStop
0453 6401              XRL     A,#01H
0455 600B              JZ      ?C0118
                                           ; SOURCE LINE # 501
                                           ; SOURCE LINE # 502
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 61  

0457         ?C0121:
0457 0500        R     INC     sector+01H
0459 E500        R     MOV     A,sector+01H
045B 7002              JNZ     ?C0178
045D 0500        R     INC     sector
045F         ?C0178:
045F 020000      R     LJMP    ?C0119
                                           ; SOURCE LINE # 503
0462         ?C0118:
                                           ; SOURCE LINE # 504
0462 E4                CLR     A
0463 900000      R     MOV     DPTR,#CHRspBlock+040H
0466 F0                MOVX    @DPTR,A
0467 A3                INC     DPTR
0468 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 505
0469 900000      R     MOV     DPTR,#ThisFile
046C 04                INC     A
046D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 506
046E FF                MOV     R7,A
                                           ; SOURCE LINE # 508
046F         ?C0094:
046F 22                RET     
             ; FUNCTION _WriteFile (END)

             ; FUNCTION _RemoveFile (BEGIN)
                                           ; SOURCE LINE # 510
0000 8B00        R     MOV     pBuffer,R3
0002 8A00        R     MOV     pBuffer+01H,R2
0004 8900        R     MOV     pBuffer+02H,R1
                                           ; SOURCE LINE # 511
                                           ; SOURCE LINE # 517
0006 AF00        E     MOV     R7,bXXGFlags
0008 EF                MOV     A,R7
0009 C4                SWAP    A
000A 540F              ANL     A,#0FH
000C 20E00A            JB      ACC.0,?C0130
                                           ; SOURCE LINE # 518
                                           ; SOURCE LINE # 519
000F 900000      R     MOV     DPTR,#CHRspBlock+02H
0012 E4                CLR     A
0013 F0                MOVX    @DPTR,A
0014 A3                INC     DPTR
0015 04                INC     A
                                           ; SOURCE LINE # 520
0016 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 521
0019         ?C0130:
                                           ; SOURCE LINE # 524
0019 E4                CLR     A
001A F500        R     MOV     sector,A
001C F500        R     MOV     sector+01H,A
001E         ?C0132:
001E 900000      R     MOV     DPTR,#DeviceInfo+0CH
0021 E0                MOVX    A,@DPTR
0022 C4                SWAP    A
0023 F8                MOV     R0,A
0024 54F0              ANL     A,#0F0H
0026 C8                XCH     A,R0
0027 68                XRL     A,R0
0028 FE                MOV     R6,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 62  

0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B C4                SWAP    A
002C 540F              ANL     A,#0FH
002E 48                ORL     A,R0
002F FF                MOV     R7,A
0030 C3                CLR     C
0031 E500        R     MOV     A,sector+01H
0033 9F                SUBB    A,R7
0034 E500        R     MOV     A,sector
0036 9E                SUBB    A,R6
0037 4003              JC      $ + 5H
0039 020000      R     LJMP    ?C0133
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 526
003C E4                CLR     A
003D FC                MOV     R4,A
003E FD                MOV     R5,A
003F 900000      R     MOV     DPTR,#DeviceInfo+03CH
0042 E0                MOVX    A,@DPTR
0043 F8                MOV     R0,A
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 F9                MOV     R1,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FA                MOV     R2,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C 2500        R     ADD     A,sector+01H
004E FF                MOV     R7,A
004F EA                MOV     A,R2
0050 3500        R     ADDC    A,sector
0052 FE                MOV     R6,A
0053 ED                MOV     A,R5
0054 39                ADDC    A,R1
0055 FD                MOV     R5,A
0056 EC                MOV     A,R4
0057 38                ADDC    A,R0
0058 FC                MOV     R4,A
0059 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
005C 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
005F 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
0062 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
0065 120000      E     LCALL   _RBC_Read
0068 EF                MOV     A,R7
0069 700A              JNZ     ?C0135
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 528
006B 900000      R     MOV     DPTR,#CHRspBlock+02H
006E F0                MOVX    @DPTR,A
006F A3                INC     DPTR
0070 740A              MOV     A,#0AH
0072         ?C0206:
                                           ; SOURCE LINE # 529
0072 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 530
0075         ?C0135:
                                           ; SOURCE LINE # 531
0075 E4                CLR     A
0076 F500        R     MOV     i,A
0078 F500        R     MOV     i+01H,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 63  

007A         ?C0136:
007A D3                SETB    C
007B 900000      R     MOV     DPTR,#DeviceInfo+09H
007E E0                MOVX    A,@DPTR
007F 9500        R     SUBB    A,i+01H
0081 900000      R     MOV     DPTR,#DeviceInfo+08H
0084 E0                MOVX    A,@DPTR
0085 9500        R     SUBB    A,i
0087 5003              JNC     $ + 5H
0089 020000      R     LJMP    ?C0137
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
008C 7400        E     MOV     A,#LOW DBUF
008E 2500        R     ADD     A,i+01H
0090 F582              MOV     DPL,A
0092 7400        E     MOV     A,#HIGH DBUF
0094 3500        R     ADDC    A,i
0096 F583              MOV     DPH,A
0098 E0                MOVX    A,@DPTR
0099 700A              JNZ     ?C0139
                                           ; SOURCE LINE # 534
                                           ; SOURCE LINE # 535
009B 900000      R     MOV     DPTR,#CHRspBlock+02H
009E F0                MOVX    @DPTR,A
009F A3                INC     DPTR
00A0 7411              MOV     A,#011H
00A2         ?C0207:
                                           ; SOURCE LINE # 536
00A2 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 537
00A5         ?C0139:
                                           ; SOURCE LINE # 538
00A5 E4                CLR     A
00A6 F500        R     MOV     j,A
00A8         ?C0140:
                                           ; SOURCE LINE # 539
00A8 AB00        R     MOV     R3,pBuffer
00AA AA00        R     MOV     R2,pBuffer+01H
00AC A900        R     MOV     R1,pBuffer+02H
00AE 850082      R     MOV     DPL,j
00B1 758300            MOV     DPH,#00H
00B4 120000      E     LCALL   ?C?CLDOPTR
00B7 FF                MOV     R7,A
00B8 E500        R     MOV     A,j
00BA 7C00              MOV     R4,#00H
00BC 2500        R     ADD     A,i+01H
00BE FD                MOV     R5,A
00BF EC                MOV     A,R4
00C0 3500        R     ADDC    A,i
00C2 FC                MOV     R4,A
00C3 7400        E     MOV     A,#LOW DBUF
00C5 2D                ADD     A,R5
00C6 F582              MOV     DPL,A
00C8 7400        E     MOV     A,#HIGH DBUF
00CA 3C                ADDC    A,R4
00CB F583              MOV     DPH,A
00CD E0                MOVX    A,@DPTR
00CE B50709            CJNE    A,AR7,?C0141
                                           ; SOURCE LINE # 540
                                           ; SOURCE LINE # 541
00D1 0500        R     INC     j
                                           ; SOURCE LINE # 542
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 64  

00D3 E500        R     MOV     A,j
00D5 D3                SETB    C
00D6 940A              SUBB    A,#0AH
00D8 40CE              JC      ?C0140
                                           ; SOURCE LINE # 543
00DA         ?C0141:
                                           ; SOURCE LINE # 544
00DA E500        R     MOV     A,j
00DC D3                SETB    C
00DD 940A              SUBB    A,#0AH
00DF 5003              JNC     $ + 5H
00E1 020000      R     LJMP    ?C0138
                                           ; SOURCE LINE # 545
                                           ; SOURCE LINE # 546
00E4 7400        E     MOV     A,#LOW DBUF
00E6 2500        R     ADD     A,i+01H
00E8 F582              MOV     DPL,A
00EA 7400        E     MOV     A,#HIGH DBUF
00EC 3500        R     ADDC    A,i
00EE F583              MOV     DPH,A
00F0 74E5              MOV     A,#0E5H
00F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 547
00F3 7400        E     MOV     A,#LOW DBUF
00F5 2500        R     ADD     A,i+01H
00F7 F9                MOV     R1,A
00F8 7400        E     MOV     A,#HIGH DBUF
00FA 3500        R     ADDC    A,i
00FC FA                MOV     R2,A
00FD 7B01              MOV     R3,#01H
;---- Variable 'pDirInfo' assigned to Register 'R1/R2/R3' ----
                                           ; SOURCE LINE # 548
00FF 90001A            MOV     DPTR,#01AH
0102 120000      E     LCALL   ?C?ILDOPTR
0105 FF                MOV     R7,A
0106 AEF0              MOV     R6,B
0108 120000      E     LCALL   _SwapINT16
010B 900000      R     MOV     DPTR,#ThisFile+01H
010E EE                MOV     A,R6
010F F0                MOVX    @DPTR,A
0110 A3                INC     DPTR
0111 EF                MOV     A,R7
0112 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 550
0113 E4                CLR     A
0114 FC                MOV     R4,A
0115 FD                MOV     R5,A
0116 900000      R     MOV     DPTR,#DeviceInfo+03CH
0119 E0                MOVX    A,@DPTR
011A F8                MOV     R0,A
011B A3                INC     DPTR
011C E0                MOVX    A,@DPTR
011D F9                MOV     R1,A
011E A3                INC     DPTR
011F E0                MOVX    A,@DPTR
0120 FA                MOV     R2,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 2500        R     ADD     A,sector+01H
0125 FF                MOV     R7,A
0126 EA                MOV     A,R2
0127 3500        R     ADDC    A,sector
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 65  

0129 FE                MOV     R6,A
012A ED                MOV     A,R5
012B 39                ADDC    A,R1
012C FD                MOV     R5,A
012D EC                MOV     A,R4
012E 38                ADDC    A,R0
012F FC                MOV     R4,A
0130 750001      E     MOV     ?_RBC_Write?BYTE+04H,#01H
0133 750001      E     MOV     ?_RBC_Write?BYTE+05H,#01H
0136 750000      E     MOV     ?_RBC_Write?BYTE+06H,#HIGH DBUF
0139 750000      E     MOV     ?_RBC_Write?BYTE+07H,#LOW DBUF
013C 120000      E     LCALL   _RBC_Write
013F EF                MOV     A,R7
0140 7009              JNZ     ?C0144
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
0142 900000      R     MOV     DPTR,#CHRspBlock+02H
0145 F0                MOVX    @DPTR,A
0146 A3                INC     DPTR
0147 740A              MOV     A,#0AH
0149         ?C0208:
                                           ; SOURCE LINE # 553
0149 805E              SJMP    ?C0210
                                           ; SOURCE LINE # 554
014B         ?C0144:
                                           ; SOURCE LINE # 557
014B 900000      R     MOV     DPTR,#ThisFile+01H
014E E0                MOVX    A,@DPTR
014F FE                MOV     R6,A
0150 A3                INC     DPTR
0151 E0                MOVX    A,@DPTR
0152 FF                MOV     R7,A
0153 120000      E     LCALL   _DeleteClusterLink
0156 EF                MOV     A,R7
0157 7009              JNZ     ?C0145
                                           ; SOURCE LINE # 558
                                           ; SOURCE LINE # 559
0159 900000      R     MOV     DPTR,#CHRspBlock+02H
015C F0                MOVX    @DPTR,A
015D A3                INC     DPTR
015E 740A              MOV     A,#0AH
0160         ?C0209:
                                           ; SOURCE LINE # 560
0160 8047              SJMP    ?C0210
                                           ; SOURCE LINE # 561
0162         ?C0145:
                                           ; SOURCE LINE # 562
0162 750001      R     MOV     bStop,#01H
                                           ; SOURCE LINE # 563
0165 800E              SJMP    ?C0137
                                           ; SOURCE LINE # 564
                                           ; SOURCE LINE # 566
0167         ?C0138:
0167 7420              MOV     A,#020H
0169 2500        R     ADD     A,i+01H
016B F500        R     MOV     i+01H,A
016D E4                CLR     A
016E 3500        R     ADDC    A,i
0170 F500        R     MOV     i,A
0172 020000      R     LJMP    ?C0136
0175         ?C0137:
                                           ; SOURCE LINE # 567
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 66  

0175 E500        R     MOV     A,bStop
0177 6401              XRL     A,#01H
0179 600B              JZ      ?C0133
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
017B         ?C0134:
017B 0500        R     INC     sector+01H
017D E500        R     MOV     A,sector+01H
017F 7002              JNZ     ?C0179
0181 0500        R     INC     sector
0183         ?C0179:
0183 020000      R     LJMP    ?C0132
0186         ?C0133:
                                           ; SOURCE LINE # 570
0186 900000      R     MOV     DPTR,#DeviceInfo+0CH
0189 E0                MOVX    A,@DPTR
018A C4                SWAP    A
018B F8                MOV     R0,A
018C 54F0              ANL     A,#0F0H
018E C8                XCH     A,R0
018F 68                XRL     A,R0
0190 FE                MOV     R6,A
0191 A3                INC     DPTR
0192 E0                MOVX    A,@DPTR
0193 C4                SWAP    A
0194 540F              ANL     A,#0FH
0196 48                ORL     A,R0
0197 FF                MOV     R7,A
0198 C3                CLR     C
0199 E500        R     MOV     A,sector+01H
019B 9F                SUBB    A,R7
019C E500        R     MOV     A,sector
019E 9E                SUBB    A,R6
019F 400C              JC      ?C0147
                                           ; SOURCE LINE # 571
                                           ; SOURCE LINE # 572
01A1 900000      R     MOV     DPTR,#CHRspBlock+02H
01A4 E4                CLR     A
01A5 F0                MOVX    @DPTR,A
01A6 A3                INC     DPTR
01A7 7411              MOV     A,#011H
01A9         ?C0210:
01A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 573
01AA 7F00              MOV     R7,#00H
01AC 22                RET     
                                           ; SOURCE LINE # 574
01AD         ?C0147:
                                           ; SOURCE LINE # 575
01AD 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 577
01AF         ?C0131:
01AF 22                RET     
             ; FUNCTION _RemoveFile (END)

             ; FUNCTION GetCapacity (BEGIN)
                                           ; SOURCE LINE # 579
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 586
0000 AF00        E     MOV     R7,bXXGFlags
0002 EF                MOV     A,R7
0003 C4                SWAP    A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 67  

0004 540F              ANL     A,#0FH
0006 20E00A            JB      ACC.0,?C0148
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 588
0009 900000      R     MOV     DPTR,#CHRspBlock+02H
000C E4                CLR     A
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 04                INC     A
                                           ; SOURCE LINE # 589
0010 020000      R     LJMP    ?C0212
                                           ; SOURCE LINE # 590
0013         ?C0148:
                                           ; SOURCE LINE # 591
0013 120000      E     LCALL   ReadCapacity
0016 EF                MOV     A,R7
0017 700A              JNZ     ?C0150
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
0019 900000      R     MOV     DPTR,#CHRspBlock+02H
001C F0                MOVX    @DPTR,A
001D A3                INC     DPTR
001E 740A              MOV     A,#0AH
0020         ?C0211:
                                           ; SOURCE LINE # 594
0020 020000      R     LJMP    ?C0212
                                           ; SOURCE LINE # 595
0023         ?C0150:
                                           ; SOURCE LINE # 596
0023 7B01              MOV     R3,#01H
0025 7A00        E     MOV     R2,#HIGH DBUF
0027 7900        E     MOV     R1,#LOW DBUF
0029 8B00        R     MOV     pBuf,R3
002B 8A00        R     MOV     pBuf+01H,R2
002D 8900        R     MOV     pBuf+02H,R1
                                           ; SOURCE LINE # 597
002F 900004            MOV     DPTR,#04H
0032 120000      E     LCALL   ?C?LLDOPTR0
0035 C000              PUSH    AR0
0037 C001              PUSH    AR1
0039 C002              PUSH    AR2
003B C003              PUSH    AR3
003D AB00        R     MOV     R3,pBuf
003F AA00        R     MOV     R2,pBuf+01H
0041 A900        R     MOV     R1,pBuf+02H
0043 120000      E     LCALL   ?C?LLDPTR
0046 EF                MOV     A,R7
0047 2401              ADD     A,#01H
0049 FF                MOV     R7,A
004A E4                CLR     A
004B 3E                ADDC    A,R6
004C FE                MOV     R6,A
004D E4                CLR     A
004E 3D                ADDC    A,R5
004F FD                MOV     R5,A
0050 E4                CLR     A
0051 3C                ADDC    A,R4
0052 FC                MOV     R4,A
0053 D003              POP     AR3
0055 D002              POP     AR2
0057 D001              POP     AR1
0059 D000              POP     AR0
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 68  

005B 120000      E     LCALL   ?C?LMUL
005E 120000      E     LCALL   _SwapINT32
0061 900000      R     MOV     DPTR,#CHRspBlock+04H
0064 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 598
0067 900000      R     MOV     DPTR,#DeviceInfo+03AH
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E 8E00        R     MOV     sectorNum,R6
0070 F500        R     MOV     sectorNum+01H,A
                                           ; SOURCE LINE # 599
0072 E4                CLR     A
0073 F500        R     MOV     freesectorcnt,A
0075 F500        R     MOV     freesectorcnt+01H,A
0077         ?C0151:
                                           ; SOURCE LINE # 600
0077 900000      R     MOV     DPTR,#DeviceInfo+011H
007A E0                MOVX    A,@DPTR
007B FE                MOV     R6,A
007C A3                INC     DPTR
007D E0                MOVX    A,@DPTR
007E FF                MOV     R7,A
007F E4                CLR     A
0080 FC                MOV     R4,A
0081 FD                MOV     R5,A
0082 900000      R     MOV     DPTR,#DeviceInfo+038H
0085 E0                MOVX    A,@DPTR
0086 F8                MOV     R0,A
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 F9                MOV     R1,A
008A A3                INC     DPTR
008B E0                MOVX    A,@DPTR
008C FA                MOV     R2,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F 2F                ADD     A,R7
0090 FB                MOV     R3,A
0091 EA                MOV     A,R2
0092 3E                ADDC    A,R6
0093 FA                MOV     R2,A
0094 ED                MOV     A,R5
0095 39                ADDC    A,R1
0096 F9                MOV     R1,A
0097 EC                MOV     A,R4
0098 38                ADDC    A,R0
0099 F8                MOV     R0,A
009A AE00        R     MOV     R6,sectorNum
009C AF00        R     MOV     R7,sectorNum+01H
009E E4                CLR     A
009F D3                SETB    C
00A0 120000      E     LCALL   ?C?ULCMP
00A3 406D              JC      ?C0152
                                           ; SOURCE LINE # 601
                                           ; SOURCE LINE # 603
00A5 AE00        R     MOV     R6,sectorNum
00A7 AF00        R     MOV     R7,sectorNum+01H
00A9 E4                CLR     A
00AA FC                MOV     R4,A
00AB FD                MOV     R5,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 69  

00AC 750001      E     MOV     ?_RBC_Read?BYTE+04H,#01H
00AF 750001      E     MOV     ?_RBC_Read?BYTE+05H,#01H
00B2 750000      E     MOV     ?_RBC_Read?BYTE+06H,#HIGH DBUF
00B5 750000      E     MOV     ?_RBC_Read?BYTE+07H,#LOW DBUF
00B8 120000      E     LCALL   _RBC_Read
00BB EF                MOV     A,R7
00BC 603D              JZ      ?C0153
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
;---- Variable 'i' assigned to Register 'R6/R7' ----
00BE E4                CLR     A
00BF FF                MOV     R7,A
00C0 FE                MOV     R6,A
00C1         ?C0154:
00C1 D3                SETB    C
00C2 900000      R     MOV     DPTR,#DeviceInfo+09H
00C5 E0                MOVX    A,@DPTR
00C6 9F                SUBB    A,R7
00C7 900000      R     MOV     DPTR,#DeviceInfo+08H
00CA E0                MOVX    A,@DPTR
00CB 9E                SUBB    A,R6
00CC 4039              JC      ?C0158
                                           ; SOURCE LINE # 606
                                           ; SOURCE LINE # 607
00CE 7400        E     MOV     A,#LOW DBUF
00D0 2F                ADD     A,R7
00D1 F582              MOV     DPL,A
00D3 7400        E     MOV     A,#HIGH DBUF
00D5 3E                ADDC    A,R6
00D6 F583              MOV     DPH,A
00D8 E0                MOVX    A,@DPTR
00D9 B4FF16            CJNE    A,#0FFH,?C0156
00DC 7400        E     MOV     A,#LOW DBUF+01H
00DE 2F                ADD     A,R7
00DF F582              MOV     DPL,A
00E1 7400        E     MOV     A,#HIGH DBUF+01H
00E3 3E                ADDC    A,R6
00E4 F583              MOV     DPH,A
00E6 E0                MOVX    A,@DPTR
00E7 B4FF08            CJNE    A,#0FFH,?C0156
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
00EA 0500        R     INC     freesectorcnt+01H
00EC E500        R     MOV     A,freesectorcnt+01H
00EE 7002              JNZ     ?C0180
00F0 0500        R     INC     freesectorcnt
00F2         ?C0180:
                                           ; SOURCE LINE # 610
                                           ; SOURCE LINE # 611
00F2         ?C0156:
00F2 7402              MOV     A,#02H
00F4 2F                ADD     A,R7
00F5 FF                MOV     R7,A
00F6 E4                CLR     A
00F7 3E                ADDC    A,R6
00F8 FE                MOV     R6,A
00F9 80C6              SJMP    ?C0154
                                           ; SOURCE LINE # 612
00FB         ?C0153:
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 615
00FB 900000      R     MOV     DPTR,#CHRspBlock+02H
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 70  

00FE E4                CLR     A
00FF F0                MOVX    @DPTR,A
0100 A3                INC     DPTR
0101 740A              MOV     A,#0AH
0103         ?C0212:
0103 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 616
0104 7F00              MOV     R7,#00H
0106 22                RET     
                                           ; SOURCE LINE # 617
0107         ?C0158:
                                           ; SOURCE LINE # 618
0107 0500        R     INC     sectorNum+01H
0109 E500        R     MOV     A,sectorNum+01H
010B 7002              JNZ     ?C0181
010D 0500        R     INC     sectorNum
010F         ?C0181:
                                           ; SOURCE LINE # 619
010F 020000      R     LJMP    ?C0151
0112         ?C0152:
                                           ; SOURCE LINE # 620
0112 900000      R     MOV     DPTR,#DeviceInfo+0AH
0115 E0                MOVX    A,@DPTR
0116 FF                MOV     R7,A
0117 7E00              MOV     R6,#00H
0119 900000      R     MOV     DPTR,#DeviceInfo+08H
011C E0                MOVX    A,@DPTR
011D FC                MOV     R4,A
011E A3                INC     DPTR
011F E0                MOVX    A,@DPTR
0120 FD                MOV     R5,A
0121 120000      E     LCALL   ?C?IMUL
0124 E4                CLR     A
0125 FC                MOV     R4,A
0126 FD                MOV     R5,A
0127 900000      R     MOV     DPTR,#CHRspBlock+08H
012A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 621
012D AE00        R     MOV     R6,freesectorcnt
012F AF00        R     MOV     R7,freesectorcnt+01H
0131 E4                CLR     A
0132 FC                MOV     R4,A
0133 FD                MOV     R5,A
0134 900000      R     MOV     DPTR,#CHRspBlock+08H
0137 E0                MOVX    A,@DPTR
0138 F8                MOV     R0,A
0139 A3                INC     DPTR
013A E0                MOVX    A,@DPTR
013B F9                MOV     R1,A
013C A3                INC     DPTR
013D E0                MOVX    A,@DPTR
013E FA                MOV     R2,A
013F A3                INC     DPTR
0140 E0                MOVX    A,@DPTR
0141 FB                MOV     R3,A
0142 120000      E     LCALL   ?C?LMUL
0145 900000      R     MOV     DPTR,#CHRspBlock+08H
0148 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 622
014B 900000      R     MOV     DPTR,#CHRspBlock+04H
014E E0                MOVX    A,@DPTR
014F FC                MOV     R4,A
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 71  

0150 A3                INC     DPTR
0151 E0                MOVX    A,@DPTR
0152 FD                MOV     R5,A
0153 A3                INC     DPTR
0154 E0                MOVX    A,@DPTR
0155 FE                MOV     R6,A
0156 A3                INC     DPTR
0157 E0                MOVX    A,@DPTR
0158 FF                MOV     R7,A
0159 120000      E     LCALL   _SwapINT32
015C 900000      R     MOV     DPTR,#CHRspBlock+08H
015F E0                MOVX    A,@DPTR
0160 F8                MOV     R0,A
0161 A3                INC     DPTR
0162 E0                MOVX    A,@DPTR
0163 F9                MOV     R1,A
0164 A3                INC     DPTR
0165 E0                MOVX    A,@DPTR
0166 FA                MOV     R2,A
0167 A3                INC     DPTR
0168 E0                MOVX    A,@DPTR
0169 FB                MOV     R3,A
016A C3                CLR     C
016B EF                MOV     A,R7
016C 9B                SUBB    A,R3
016D FF                MOV     R7,A
016E EE                MOV     A,R6
016F 9A                SUBB    A,R2
0170 FE                MOV     R6,A
0171 ED                MOV     A,R5
0172 99                SUBB    A,R1
0173 FD                MOV     R5,A
0174 EC                MOV     A,R4
0175 98                SUBB    A,R0
0176 FC                MOV     R4,A
0177 900000      R     MOV     DPTR,#CHRspBlock+08H
017A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 623
017D 900000      R     MOV     DPTR,#CHRspBlock+08H
0180 E0                MOVX    A,@DPTR
0181 FC                MOV     R4,A
0182 A3                INC     DPTR
0183 E0                MOVX    A,@DPTR
0184 FD                MOV     R5,A
0185 A3                INC     DPTR
0186 E0                MOVX    A,@DPTR
0187 FE                MOV     R6,A
0188 A3                INC     DPTR
0189 E0                MOVX    A,@DPTR
018A FF                MOV     R7,A
018B 120000      E     LCALL   _SwapINT32
018E 900000      R     MOV     DPTR,#CHRspBlock+08H
0191 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 624
0194 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 626
0196         ?C0149:
0196 22                RET     
             ; FUNCTION GetCapacity (END)

             ; FUNCTION GetFreeCapacity (BEGIN)
                                           ; SOURCE LINE # 628
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 72  

                                           ; SOURCE LINE # 629
                                           ; SOURCE LINE # 631
0000 AF00        E     MOV     R7,bXXGFlags
0002 EF                MOV     A,R7
0003 C4                SWAP    A
0004 540F              ANL     A,#0FH
0006 20E00B            JB      ACC.0,?C0159
                                           ; SOURCE LINE # 632
                                           ; SOURCE LINE # 633
0009 900000      R     MOV     DPTR,#CHRspBlock+02H
000C E4                CLR     A
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 04                INC     A
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 634
0011 7F00              MOV     R7,#00H
0013 22                RET     
                                           ; SOURCE LINE # 635
0014         ?C0159:
                                           ; SOURCE LINE # 636
0014 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 638
0016         ?C0160:
0016 22                RET     
             ; FUNCTION GetFreeCapacity (END)

             ; FUNCTION _SetFilePointer (BEGIN)
                                           ; SOURCE LINE # 640
0000 8F00        R     MOV     pointer+03H,R7
0002 8E00        R     MOV     pointer+02H,R6
0004 8D00        R     MOV     pointer+01H,R5
0006 8C00        R     MOV     pointer,R4
                                           ; SOURCE LINE # 641
                                           ; SOURCE LINE # 644
0008 AF00        E     MOV     R7,bXXGFlags
000A EF                MOV     A,R7
000B C4                SWAP    A
000C 540F              ANL     A,#0FH
000E 20E009            JB      ACC.0,?C0161
                                           ; SOURCE LINE # 645
                                           ; SOURCE LINE # 646
0011 900000      R     MOV     DPTR,#CHRspBlock+02H
0014 E4                CLR     A
0015 F0                MOVX    @DPTR,A
0016 A3                INC     DPTR
0017 04                INC     A
                                           ; SOURCE LINE # 647
0018 8068              SJMP    ?C0215
                                           ; SOURCE LINE # 648
001A         ?C0161:
                                           ; SOURCE LINE # 649
001A 900000      R     MOV     DPTR,#ThisFile
001D E0                MOVX    A,@DPTR
001E 7009              JNZ     ?C0163
                                           ; SOURCE LINE # 650
                                           ; SOURCE LINE # 651
0020 900000      R     MOV     DPTR,#CHRspBlock+02H
0023 F0                MOVX    @DPTR,A
0024 A3                INC     DPTR
0025 7414              MOV     A,#014H
0027         ?C0213:
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 73  

                                           ; SOURCE LINE # 652
0027 8059              SJMP    ?C0215
                                           ; SOURCE LINE # 653
0029         ?C0163:
                                           ; SOURCE LINE # 655
0029 AF00        R     MOV     R7,pointer+03H
002B AE00        R     MOV     R6,pointer+02H
002D AD00        R     MOV     R5,pointer+01H
002F AC00        R     MOV     R4,pointer
0031 900000      R     MOV     DPTR,#ThisFile+010H
0034 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 656
0037 900000      R     MOV     DPTR,#ThisFile+03H
003A E0                MOVX    A,@DPTR
003B FC                MOV     R4,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E FD                MOV     R5,A
003F A3                INC     DPTR
0040 E0                MOVX    A,@DPTR
0041 FE                MOV     R6,A
0042 A3                INC     DPTR
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
0045 900000      R     MOV     DPTR,#ThisFile+010H
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
0054 120000      E     LCALL   ?C?ULCMP
0057 400A              JC      ?C0164
                                           ; SOURCE LINE # 657
                                           ; SOURCE LINE # 658
0059 900000      R     MOV     DPTR,#CHRspBlock+02H
005C E4                CLR     A
005D F0                MOVX    @DPTR,A
005E A3                INC     DPTR
005F 7412              MOV     A,#012H
0061         ?C0214:
                                           ; SOURCE LINE # 659
0061 801F              SJMP    ?C0215
                                           ; SOURCE LINE # 660
0063         ?C0164:
                                           ; SOURCE LINE # 662
0063 900000      R     MOV     DPTR,#ThisFile+010H
0066 E0                MOVX    A,@DPTR
0067 FC                MOV     R4,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FD                MOV     R5,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FE                MOV     R6,A
006E A3                INC     DPTR
C51 COMPILER V7.06   HPI                                                                   02/24/2005 15:49:34 PAGE 74  

006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 120000      E     LCALL   _GoToPointer
0074 EF                MOV     A,R7
0075 700F              JNZ     ?C0165
                                           ; SOURCE LINE # 663
                                           ; SOURCE LINE # 664
0077 900000      R     MOV     DPTR,#ThisFile
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 665
007B 900000      R     MOV     DPTR,#CHRspBlock+02H
007E F0                MOVX    @DPTR,A
007F A3                INC     DPTR
0080 740A              MOV     A,#0AH
0082         ?C0215:
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 666
0083 7F00              MOV     R7,#00H
0085 22                RET     
                                           ; SOURCE LINE # 667
0086         ?C0165:
                                           ; SOURCE LINE # 668
0086 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 671
0088         ?C0162:
0088 22                RET     
             ; FUNCTION _SetFilePointer (END)

             ; FUNCTION GetFirmwareVersion (BEGIN)
                                           ; SOURCE LINE # 673
                                           ; SOURCE LINE # 674
                                           ; SOURCE LINE # 676
0000 7401              MOV     A,#01H
0002 900000      R     MOV     DPTR,#CHRspBlock+04H
0005 F0                MOVX    @DPTR,A
0006 A3                INC     DPTR
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
0008 FF                MOV     R7,A
                                           ; SOURCE LINE # 679
0009         ?C0166:
0009 22                RET     
             ; FUNCTION GetFirmwareVersion (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4909    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =  28904    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      80
   IDATA SIZE       =   ----       4
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
